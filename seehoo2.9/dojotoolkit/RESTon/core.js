define(["./common/context","jquery/jquery"],function(e,t){if(!dojo.isIE&&!dojo.isFF&&!dojo.isChrome&&!dojo.isSafari){var r=navigator.userAgent.toLowerCase();var n=/(msie\s|trident.*rv:)([\w.]+)/;var a=n.exec(r);if(a)dojo.isIE=a[2]-0;else dojo.isIE=undefined}var i=e.at("RESTon");var o=dojo.baseUrl.replace(/\/[^\/]+\/[^\/]+\/$/,"/");function c(){var e=i.get("ServerTimeCorrect");if(e==undefined){t.ajax({url:dojo.baseUrl+"../../reston/common/serverTime.jjs",type:"POST",cache:false,async:false,success:function(t){var r=(new Date).getTime();e=t-r;i.set("ServerTimeCorrect",e)},error:function(){i.set("ServerTimeCorrect",0)}})}return e||0}var u={yyyy:function(e){return e.getFullYear()},yy:function(e){var t=e.getFullYear();return String(t).substring(2,4)},MM:function(e){var t=e.getMonth()+1;if(t<10)t="0"+t;return t},dd:function(e){var t=e.getDate();if(t<10)t="0"+t;return t},HH:function(e){var t=e.getHours();if(t<10)t="0"+t;return t},mm:function(e){var t=e.getMinutes();if(t<10)t="0"+t;return t},ss:function(e){var t=e.getSeconds();if(t<10)t="0"+t;return t},SSS:function(e){var t=e.getMilliseconds();if(t<100)t="0"+t;if(t<10)t="0"+t;return t}};function s(e,t){var r=t;for(var n in u){var a=u[n];var i=new RegExp(n);var o=a(e);r=r.replace(i,o)}return r}function f(e){var t=new Date;if(e)return s(t,e);else return t}function v(e){var t=(new Date).getTime();var r=t+c();var n=new Date(r);if(e)return s(n,e);else return n}function l(){var e;t.ajax({url:C.rootPath("/reston/common/org/org.jjs"),type:"POST",cache:false,async:false,success:function(t){var r={};var n=t;(function(e){for(var t=0;t<e.length;t++){var n=e[t];r[n.id]=n;if(n.children)arguments.callee(n.children)}})(t);e={root:t,hash:r};i.set("Org",e)}});return e}function d(){var e=i.get("Org");if(!e)e=l();return e.root}function m(e){var t=i.get("Org");if(!t)t=l();return t.hash[e]}function g(e){var r=i.get("Dict");if(!r){t.ajax({url:C.rootPath("reston/common/dictType.jjs"),type:"POST",cache:false,async:false,success:function(e){var t={};for(var n=0;n<e.length;n++){var a=e[n];t[a.type]={name:a.name}}i.set("Dict",r=t)},error:function(e,t,r){alert("错误："+r)}})}var n=r[e];if(n){if(!n.arrays){t.ajax({type:"POST",url:C.rootPath("/reston/common/dict.jjs"),data:{typeid:e},cache:false,async:false,success:function(e){n.arrays=e;n.value2text={};n.text2value={};for(var t=0;t<e.length;t++){var r=e[t];n.value2text[r.value]=r;n.text2value[r.text]=r}},error:function(e,t,r){alert("错误："+r)}})}}return n}function h(e,t){var r=g(e);if(r){var n=r.value2text[t];if(n)return n.text;else return t}}function y(e,t){var r=g(e);if(r){var n=r.text2value[t];if(n)return n.value;else return t}}function j(e){var t=g(e);if(t)return t.arrays}function S(e){var t=g(e);if(t)return function(e,r,n){var a=t.value2text[e];if(a)return a.text;else return e}}var x={send:function(t,r){var n=e.at("RTMS");var a=n.get("socket");a.send(JSON.stringify({type:t,data:r}))},on:function(t,r){var n=e.at("RTMS");n.on(t,r)}};function p(e){var t=i.get("Role");var r=t.auths;if(!r)return false;return e in r}function T(e,t,r){var n=arguments;var a;require(["dojo/cookie"],function(e){a=e.apply(this,n)});return a}function E(e){e=e.replace(/^\/+/,"");return o+e}function w(e){e=e.replace(/^\/+/,"");var t=i.get("THEMES");if(!t)t="default";var r=o+"themes/"+t+"/";return r+e}function O(e){t.getScript(e)}function b(e){if(document.body){var t=document.createElement("link");t.rel="stylesheet";t.type="text/css";t.href=e;document.body.appendChild(t)}else{document.write('<link rel="stylesheet" type="text/css" href="'+e+'">')}}function D(e){b(w(e))}function F(e){O(w(e))}function M(e){i.set("THEMES",e)}if(dojo.isIE){if(window==i.container){i.set("DictFunc",{dictText:h,dictValue:y,dictList:j,dictFormatter:S})}else{var P=i.get("DictFunc");h=P.dictText;y=P.dictValue;j=P.dictList;S=P.dictFormatter}}var C={ajax:t.ajax,queue:e.queue,at:e.at,assemble:e.assemble,disassemble:e.disassemble,ready:e.ready,fire:e.fire,once:e.once,on:e.on,set:e.set,remove:e.remove,get:e.get,rootPath:E,themesPath:w,getScript:O,getCSS:b,themesCSS:D,themesScript:F,themes:M,auth:p,formatTime:s,localTime:f,serverTime:v,rootOrg:d,getOrg:m,dictText:h,dictValue:y,dictList:j,dictFormatter:S,cookie:T,rtms:x};return C});