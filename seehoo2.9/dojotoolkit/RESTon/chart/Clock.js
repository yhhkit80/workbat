define(["dojo/_base/declare","../gfx/Axis","dojox/gfx"],function(i,t,e){return i(null,{constructor:function(i,r){this.config=i;this.config.width=this.config.width||480;this.config.height=this.config.height||480;this.surface=e.createSurface(r,this.config.width,this.config.height);var s={x:this.config.width/2,y:this.config.height/2};this.axis=new t(s);this.radius=Math.min(this.config.width,this.config.height)/2-20;this.dashboard();if(!this.config.time)this.config.time=function(){return new Date};var a=this;var o=false;setTimeout(function(){a.showTime(a.config.time());if(a.alarmSwitch){if(o=!o){a.board.setFill("red");setTimeout(arguments.callee,50)}else{a.board.setFill("#f0f0f0");setTimeout(arguments.callee,950)}}else setTimeout(arguments.callee,1e3)})},dashboard:function(){this.group=this.surface.createGroup();var i=this.axis.x;var t=this.axis.y;var e=this.config.width/2-5;var r=this.config.width/100;var s=e-r*3;var a=e-r*5;var o=e-r*8;var h=e-r*10;var n=e-r*13;var c=e-r*25;this.board=this.group.createCircle({cx:i,cy:t,r:e}).setStroke({color:"#666666",style:"solid",cap:"round",width:e/50}).setFill("#f0f0f0");for(var l=0;l<360;l+=6){var f=this.axis.forAngle(l,e);var d=s;if(l%30==0)d=a;if(l%90==0)d=o;var u=this.axis.forAngle(l,d);this.group.createLine({x1:f.x,y1:f.y,x2:u.x,y2:u.y}).setStroke({color:"#666666",style:"solid",cap:"round",width:(e-d)/10})}{this.clockwise=this.group.createGroup();this.clockwise.createCircle({cx:i,cy:t,r:r*2}).setFill("#555555");var v=c;var g=r*1.2;var x=r/2;var T=v/5;if(g<.5)g=.5;if(x<.5)x=.5;if(T<.5)T=.5;this.clockwise.createPath().moveTo(i,t-v-g).lineTo(i-x,t-v).lineTo(i-g,t+T).lineTo(i+g,t+T).lineTo(i+x,t-v).lineTo(i,t-v-g).setFill("#555555")}{this.minutehand=this.group.createGroup();this.minutehand.createCircle({cx:i,cy:t,r:r*1.5}).setFill("#000000");var v=n;var g=r*1;var x=r/2.5;var T=v/5;if(g<.5)g=.5;if(x<.5)x=.5;if(T<.5)T=.5;this.minutehand.createPath().moveTo(i,t-v-g).lineTo(i-x,t-v).lineTo(i-g,t+T).lineTo(i+g,t+T).lineTo(i+x,t-v).lineTo(i,t-v-g).setFill("#000000")}{this.secondhand=this.group.createGroup();this.secondhand.createCircle({cx:i,cy:t,r:r*1.2}).setFill("red");var v=h;var g=r*.75;var x=r/4;var T=v/5;if(g<.5)g=.5;if(x<.5)x=.5;if(T<.5)T=.5;this.secondhand.createPath().moveTo(i,t-v-g).lineTo(i-x,t-v).lineTo(i-g,t+T).lineTo(i+g,t+T).lineTo(i+x,t-v).lineTo(i,t-v-g).setFill("red")}},showTime:function(i,t){var r=i.getHours();var s=i.getMinutes();var a=i.getSeconds();var o=a*6;var h=s*6+o/60;var n=r*30+h/12;this.clockwise.setTransform([e.matrix.rotategAt(n,this.axis.x,this.axis.y)]);this.minutehand.setTransform([e.matrix.rotategAt(h,this.axis.x,this.axis.y)]);this.secondhand.setTransform([e.matrix.rotategAt(o,this.axis.x,this.axis.y)])},alarm:function(i,t){if(t)if(t!=this.alarmTitle)return;this.alarmTitle=t;this.alarmSwitch=i;if(!i)this.board.setFill("#f0f0f0")}})});