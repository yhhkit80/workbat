define(["dojo/_base/declare","../gfx/Axis","dojox/gfx","../gfx/Rotate"],function(t,e,i,s){var r={color:[80,80,80,.3],style:"solid",cap:"round",width:1};var a=[80,80,80,.1];var o={color:"gray",style:"dot",cap:"round",width:1};var n={color:"#08b180",style:"solid",cap:"round",width:1};var h=[5,201,144,.5];return t(null,{constructor:function(t,s){this.config=t;this.config.width=this.config.width||480;this.config.height=this.config.height||480;this.surface=i.createSurface(s,this.config.width,this.config.height);this.center={x:this.config.width/2,y:this.config.height/2};this.axis=new e(this.center);this.radius=Math.min(this.config.width,this.config.height)/2-20;this.pointers=[];this._init()},_init:function(){var t=this;this.group=this.surface.createGroup();this.rotate=new s(this.group,this.center.x,this.center.y);this.rotate.onRotate=function(e){e=(540-e)%360;if(e<0)e+=360;var i=360;var s;for(var r=0;r<t.pointers.length;r++){var a=t.pointers[r];var o=t.axis.angleLessAbs(a.angle,e);if(o<i){i=o;s=r}}if(t.selected!=undefined){if(t.selected!=s){t.pointers[t.selected].text.setFill("#a8a8a8");t.selected=s;t.pointers[s].text.setFill("#f1770a");var n=t.config.bottomPointer;if(n)n(s)}}else{t.selected=s;t.pointers[s].text.setFill("#f1770a");var n=t.config.bottomPointer;if(n)n(s)}};this.rotate.onRotateStop=function(e){var i=540-t.pointers[t.selected].angle;var s=this;var r=t.axis.angleLess(i,e);if(Math.abs(r)<2)return;var a=r/20;setTimeout(function(){e+=a;s.rotateg(e);var r=t.axis.angleLessAbs(i,e);if(r<1)return;setTimeout(arguments.callee,10)},0)};var e=this.config.data;if(e){var i=e();this.load(i)}},load:function(t){this.pointers=[];this.group.clear();var e=t.length;var s=360/e;var l=e%2==0?s/2:0;var f=[],c=[];var g,u;for(var d=0;d<e;d++){var v=t[d];var x=l+s*d;var p=this.axis.forAngle(x,this.radius+20);var m=this.axis.forAngle(x,this.radius*v.value/v.max);var y=this.axis.forAngle(x,this.radius);var T=this.axis.forAngle(x,this.radius*v.value/v.max);c.push(y);f.push(T);this.group.createLine({x1:y.x,y1:y.y,x2:this.center.x,y2:this.center.y}).setStroke(o);var w=this.group.createText({x:0,y:-4,align:"middle",text:v.title}).setFill("#a8a8a8").setFont({size:14,family:"微软雅黑"}).setTransform([i.matrix.rotateg(x+180)]).applyLeftTransform({dx:p.x,dy:p.y});this.pointers.push({angle:x,text:w});this.group.createText({x:0,y:10,align:"middle",text:v.value+" / "+v.max}).setFill("#f1770a").setFont({size:12,family:"微软雅黑"}).setTransform([i.matrix.rotateg(x-90)]).applyLeftTransform({dx:m.x,dy:m.y})}c.push(c[0]);f.push(f[0]);this.group.createPolyline(c).setStroke(r).setFill(a).moveToBack();this.group.createPolyline(f).setStroke(n).setFill(h).moveToFront;this.pos()},pos:function(){var t=0;var e=this;setTimeout(function(){t+=5;if(t>360)t=360;e.rotate.rotateg(t);if(t>=360){e.rotate.onRotate(0);e.rotate.onRotateStop(0);return}setTimeout(arguments.callee,10)},0)}})});