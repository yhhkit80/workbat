define(["dojo/_base/declare","../gfx/Axis","dojox/gfx","dojox/gfx/Moveable","../gfx/Fan"],function(e,i,t,s,a){var r=["#d52808","#d52808","#d52808","#d52808","#d52808","#d52808","#d52808","#d52808","#d52808","#d62a09","#d72e0b","#d9330d","#db3910","#de4213","#e14916","#e45119","#e85a1d","#eb6221","#ef6c25","#f37429","#f8802e","#fa8a32","#fc8e35","#fe9437","#ff9b3a","#ffa13d","#ffa740","#ffac42","#ffb445","#ffb848","#ffbe4a","#ffc34d","#ffc850","#ffcc51","#ffd254","#ffd657","#ffd959","#ffdd5b","#ffe15e","#ffe35f","#fee561","#fbe562","#f8e564","#f4e565","#f1e566","#eee567","#e9e568","#e3e56a","#dee56b","#d9e56d","#d4e56e","#cfe56e","#c8e570","#c3e571","#bce572","#b7e574","#afe575","#a9e575","#a2e577","#9ae578","#94e579","#8ce57a","#84e57b","#7de57c","#74e57d","#6ae57e","#62e57f","#59e581","#50e581","#48e582","#40e384","#37e284","#30e185","#26e086","#20df87","#1ade88","#14de88","#13de88","#0edd89","#09dc8a"];var h=2.8;var n=2.5;var o=360-h*r.length/2;var f=360+h*r.length/2;var c=510/r.length;return e(null,{constructor:function(e,s){this.config=e;this.config.width=this.config.width||480;this.config.height=this.config.height||480;this.surface=t.createSurface(s,this.config.width,this.config.height);var a={x:this.config.width/2,y:this.config.height/2};this.axis=new i(a);this.radius=Math.min(this.config.width,this.config.height)/2-20;this._init()},_init:function(){this.group=this.surface.createGroup();var e=this.config.axis;if(e){this.setAxis(e());var i=this.config.score;if(i)this.setScore(i())}},score2Angle:function(e){return o+(f-o)*(e-this.min)/(this.max-this.min)},setScore:function(e){var i=this;this.data=e;this.scoreText.setShape({text:e.score});this.levelText.setShape({text:e.level});if(e.time)this.timeText.setShape({text:"评估时间："+e.time});var t=this.score2Angle(e.score);var s=this.score2Angle(this.min);var a=this.score2Angle(this.max);var r=this.angle%360;if(r<180)r+=360;var h=0;setTimeout(function(){if(i.MoveStarted)return;var e=t-r;if(Math.abs(e)<.1&&Math.abs(h)<.5)return;r+=h;h*=.96;if(r<s){r=s;h*=-1}if(r>a){r=a;h*=-1}i._setPointer(r);h+=e/150;setTimeout(arguments.callee,10)},0)},_setPointer:function(e){this.angle=e;this.pointer.setTransform([t.matrix.rotategAt(e,this.axis.x,this.axis.y)])},setAxis:function(e){var i=parseInt(this.config.width/15);var c=this;this.group.clear();var x=this.min=e[0];var d=this.max=e[e.length-1];for(var l=0;l<r.length;l++){a.create(this.group,{cx:this.axis.x,cy:this.axis.y,r1:this.radius-i,r2:this.radius,a1:o+h*l,a2:o+h*l+n}).setFill(r[l])}a.create(this.group,{cx:this.axis.x,cy:this.axis.y,r1:this.radius-49,r2:this.radius-53,a1:o,a2:360}).setFill("#e8e8e8");a.create(this.group,{cx:this.axis.x,cy:this.axis.y,r1:this.radius-49,r2:this.radius-53,a1:0,a2:f}).setFill("#e8e8e8");var g=[];for(var l in e){var u=e[l];l=parseInt(l);if(typeof u=="number")g[l]=o+(f-o)*(u-x)/(d-x)}for(var l in e){var u=e[l];l=parseInt(l);if(typeof u=="string"&&l>0&&e.length>l+1)g[l]=(g[l-1]+g[l+1])/2}for(var l in e){var u=e[l];var v=g[l];if(v==undefined)continue;var m=this.axis.forAngle(v,this.radius-i);this.group.createText({x:0,y:parseInt(this.config.width/50)+8,align:"middle",text:u}).setFont({size:parseInt(this.config.width/30),weight:"normal",family:"微软雅黑"}).setFill([170,170,170]).setTransform([t.matrix.rotateg(v)]).applyLeftTransform({dx:m.x,dy:m.y})}var y=this.group.createPath();y.moveTo(this.axis.x,i+40).lineTo(this.axis.x-1,i+41).lineTo(this.axis.x-6,this.axis.y).lineTo(this.axis.x-7,this.axis.y+i+10).lineTo(this.axis.x+7,this.axis.y+i+10).lineTo(this.axis.x+6,this.axis.y).lineTo(this.axis.x+1,i+41).lineTo(this.axis.x,i+40).setFill("#05c990");this.container=this.surface._parent;var p=new s(y);p.onMoveStart=function(e,i){c.MoveStarted=true};p.onMove=function(e,i){var t=dojo.position(c.container);var s=c.axis.getAngle(e.lastX+i.dx-t.x,e.lastY+i.dy-t.y);s%=360;if(s<180)s+=360;var a=c.score2Angle(c.min);var r=c.score2Angle(c.max);if(a>s)s=a;if(r<s)s=r;c._setPointer(s)};p.onMoveStop=function(e,i){c.MoveStarted=false;c.setScore(c.data)};this.pointer=y;this._setPointer(this.score2Angle(x));this.group.createCircle({cx:this.axis.x,cy:this.axis.y,r:12}).setFill("#05c990");this.group.createCircle({cx:this.axis.x,cy:this.axis.y,r:7}).setStroke({color:"#ebebec",style:"solid",cap:"round",width:2});this.scoreText=this.group.createText({x:this.axis.x,y:this.axis.y+86,align:"middle",text:""}).setFont({size:60,weight:"normal",family:"微软雅黑"}).setFill("#05c990");this.levelText=this.group.createText({x:this.axis.x,y:this.axis.y+125,align:"middle",text:""}).setFont({size:32,weight:"normal",family:"微软雅黑"}).setFill("#05c990");this.timeText=this.group.createText({x:this.axis.x,y:this.axis.y+150,align:"middle",text:""}).setFont({size:14,weight:"normal",family:"微软雅黑"}).setFill("#8e8e8e")}})});