jQuery.extend({createUploadIframe:function(e,t){var r="jUploadFrame"+e;var o='<iframe id="'+r+'" name="'+r+'" style="position:absolute; top:-9999px; left:-9999px"';if(window.ActiveXObject){if(typeof t=="boolean"){o+=' src="'+"javascript:false"+'"'}else if(typeof t=="string"){o+=' src="'+t+'"'}}o+=" />";jQuery(o).appendTo(document.body);return jQuery("#"+r).get(0)},createUploadForm:function(e,t,r){var o="jUploadForm"+e;var n="jUploadFile"+e;var a=jQuery('<form  action="" method="POST" name="'+o+'" id="'+o+'" enctype="multipart/form-data"></form>');if(r){for(var u in r){jQuery('<input type="hidden" name="'+u+'" value="'+r[u]+'" />').appendTo(a)}}var c=jQuery("#"+t);var i=jQuery(c).clone();jQuery(c).attr("id",n);jQuery(c).before(i);jQuery(c).appendTo(a);jQuery(a).css("position","absolute");jQuery(a).css("top","-1200px");jQuery(a).css("left","-1200px");jQuery(a).appendTo("body");return a},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime();var r=jQuery.createUploadForm(t,e.fileElementId,typeof e.data=="undefined"?false:e.data);var o=jQuery.createUploadIframe(t,e.secureuri);var n="jUploadFrame"+t;var a="jUploadForm"+t;if(e.global&&!jQuery.active++){jQuery.event.trigger("ajaxStart")}var u=false;var c={};if(e.global)jQuery.event.trigger("ajaxSend",[c,e]);var i=function(t){var o=document.getElementById(n);try{if(o.contentWindow){c.responseText=o.contentWindow.document.body?o.contentWindow.document.body.innerHTML:null;c.responseXML=o.contentWindow.document.XMLDocument?o.contentWindow.document.XMLDocument:o.contentWindow.document}else if(o.contentDocument){c.responseText=o.contentDocument.document.body?o.contentDocument.document.body.innerHTML:null;c.responseXML=o.contentDocument.document.XMLDocument?o.contentDocument.document.XMLDocument:o.contentDocument.document}}catch(a){jQuery.handleError(e,c,null,a)}if(c||t=="timeout"){u=true;var i;try{i=t!="timeout"?"success":"error";if(i!="error"){var l=jQuery.uploadHttpData(c,e.dataType);if(e.success)e.success(l,i);if(e.global)jQuery.event.trigger("ajaxSuccess",[c,e])}else{jQuery.handleError(e,c,i)}}catch(a){i="error";jQuery.handleError(e,c,i,a)}if(e.global)jQuery.event.trigger("ajaxComplete",[c,e]);if(e.global&&!--jQuery.active)jQuery.event.trigger("ajaxStop");if(e.complete)e.complete(c,i);jQuery(o).unbind();setTimeout(function(){try{jQuery(o).remove();jQuery(r).remove()}catch(t){jQuery.handleError(e,c,null,t)}},100);c=null}};if(e.timeout>0){setTimeout(function(){if(!u)i("timeout")},e.timeout)}try{var r=jQuery("#"+a);jQuery(r).attr("action",e.url);jQuery(r).attr("method","POST");jQuery(r).attr("target",n);if(r.encoding){jQuery(r).attr("encoding","multipart/form-data")}else{jQuery(r).attr("enctype","multipart/form-data")}jQuery(r).submit()}catch(l){jQuery.handleError(e,c,null,l)}jQuery("#"+n).load(i);return{abort:function(){}}},uploadHttpData:function(e,t){var r=!t;r=t=="xml"||r?e.responseXML:e.responseText;if(t=="json"){if(jQuery(r).text()=="")r="";else r=jQuery.parseJSON(jQuery(r).text())}return r},handleError:function(e,t,r,o){if(e.error){e.error.call(e.context||e,t,r,o)}if(e.global){(e.context?jQuery(e.context):jQuery.event).trigger("ajaxError",[t,e,o])}}});