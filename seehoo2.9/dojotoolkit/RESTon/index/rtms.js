define(["../core","jquery/jquery","../common/context","dojox/socket","dojox/socket/Reconnect","dojo/_base/unload"],function(o,e,n,t,c,a){var s=n.at("RTMS");var r;if(window.WebSocket)r="reston/websocket";else r="reston/comet";var d=t(r);s.set("socket",d);c(d,1e3);d.on("open",function(){});d.on("close",function(){});d.on("message",function(o){var e=JSON.parse(o.data);s.fire(e.type,e.data)});a.addOnUnload(function(){d.close()});return o});