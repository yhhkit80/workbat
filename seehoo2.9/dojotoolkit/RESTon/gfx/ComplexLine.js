define(["dojo/_base/declare","dojox/gfx/Moveable","./IndentLine"],function(t,e,i){var o={color:"green",width:6,style:"solid",cap:"round"};var r={color:"blue",width:6,style:"solid",cap:"round"};var s={color:"red",width:5,style:"solid",cap:"round"};return t(i,{constructor:function(t){},_show:function(){this.inherited(arguments);var t=this.shape;if(!t.line)return;var e={x1:t.line.toX+Math.cos(t.line.toRadian+Math.PI/5)*15,y1:t.line.toY+Math.sin(t.line.toRadian+Math.PI/5)*15,x2:t.line.toX,y2:t.line.toY};var i={x1:t.line.toX+Math.cos(t.line.toRadian-Math.PI/5)*15,y1:t.line.toY+Math.sin(t.line.toRadian-Math.PI/5)*15,x2:t.line.toX,y2:t.line.toY};if(this.leftArrow)this.leftArrow.setShape(e);else this.leftArrow=this.surface.createLine(e).setStroke(this._getStroke());if(this.rightArrow)this.rightArrow.setShape(i);else this.rightArrow=this.surface.createLine(i).setStroke(this._getStroke())},onClick:function(){this.select(true)},isSelected:function(){this.selected},_createFromPoint:function(){if(this.fromPoint)return;var t=this.shape;this.fromPoint=this.surface.createCircle({cx:t.from.x,cy:t.from.y,r:8}).setFill("red");this.fromPoint.data=this;var i=new e(this.fromPoint);i.onMove=function(t,e){var i=t.shape.getParent().getDimensions();this.onMoving(t,e);this.shape.applyLeftTransform(e);this.onMoved(t,e)};i.onMoved=function(t,e){var i=t.shape.getShape();var o=t.shape.getTransform()||{dx:0,dy:0};var r=i.cx+o.dx;var s=i.cy+o.dy;t.shape.data.from(r,s,10);t.shape.data.onFromMoved(r,s)};i.onMoveStop=function(t,e){var i=t.shape.getParent().getDimensions();var o=t.shape.data.shape.from;if(o.x<o.r)o.x=o.r;if(o.x>i.width-o.r)o.x=i.width-o.r;if(o.y<o.r)o.y=o.r;if(o.y>i.height-o.r)o.y=i.height-o.r;t.shape.data.paint();t.shape.data.select(true)}},_createToPoint:function(){if(this.toPoint)return;var t=this.shape;this.toPoint=this.surface.createCircle({cx:t.to.x,cy:t.to.y,r:8}).setFill("red");this.toPoint.data=this;var i=new e(this.toPoint);i.onMove=function(t,e){var i=t.shape.getParent().getDimensions();this.onMoving(t,e);this.shape.applyLeftTransform(e);this.onMoved(t,e)};i.onMoved=function(t,e){var i=t.shape.getShape();var o=t.shape.getTransform()||{dx:0,dy:0};var r=i.cx+o.dx;var s=i.cy+o.dy;t.shape.data.to(r,s,10);t.shape.data.onToMoved(r,s)};i.onMoveStop=function(t,e){var i=t.shape.getParent().getDimensions();var o=t.shape.data.shape.to;if(o.x<o.r)o.x=o.r;if(o.x>i.width-o.r)o.x=i.width-o.r;if(o.y<o.r)o.y=o.r;if(o.y>i.height-o.r)o.y=i.height-o.r;t.shape.data.paint();t.shape.data.select(true)}},select:function(t){this.selected=t;if(t){this.line.moveToFront();this.setStroke(s);this.leftArrow.setStroke(s);this.rightArrow.setStroke(s);if(this.fromPoint){this.fromPoint.setShape({cx:this.shape.from.x,cy:this.shape.from.y,r:8}).setTransform({dx:0,dy:0});this.surface.add(this.fromPoint)}else this._createFromPoint();if(this.toPoint){this.toPoint.setShape({cx:this.shape.to.x,cy:this.shape.to.y,r:8}).setTransform({dx:0,dy:0});this.surface.add(this.toPoint)}else this._createToPoint()}else{this.line.moveToBack();this.setStroke(this._getStroke());this.leftArrow.setStroke(this._getStroke());this.rightArrow.setStroke(this._getStroke());if(this.fromPoint)this.surface.remove(this.fromPoint);if(this.toPoint)this.surface.remove(this.toPoint)}this.onSelect(t)},toggleSelect:function(){this.select(!this.selected)},onSelect:function(t){},onFromMoved:function(t,e){},onToMoved:function(t,e){}})});