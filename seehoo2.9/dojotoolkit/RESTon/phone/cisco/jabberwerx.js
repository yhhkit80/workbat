(function(e,t){var r=function(e,t){return new r.fn.init(e,t)},n=e.jQuery,i=e.$,a=e.document,s,o=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,l=/^.[^:#\[\.,]*$/,u=/\S/,c=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,f=navigator.userAgent,d,b=false,p=[],m,g=Object.prototype.toString,v=Object.prototype.hasOwnProperty,w=Array.prototype.push,x=Array.prototype.slice,y=Array.prototype.indexOf;r.fn=r.prototype={init:function(e,n){var i,l,u,c;if(!e){return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(e==="body"&&!n){this.context=a;this[0]=a.body;this.selector="body";this.length=1;return this}if(typeof e==="string"){i=o.exec(e);if(i&&(i[1]||!n)){if(i[1]){c=n?n.ownerDocument||n:a;u=h.exec(e);if(u){if(r.isPlainObject(n)){e=[a.createElement(u[1])];r.fn.attr.call(e,n,true)}else{e=[c.createElement(u[1])]}}else{u=pe([i[1]],[c]);e=(u.cacheable?u.fragment.cloneNode(true):u.fragment).childNodes}return r.merge(this,e)}else{l=a.getElementById(i[2]);if(l){if(l.id!==i[2]){return s.find(e)}this.length=1;this[0]=l}this.context=a;this.selector=e;return this}}else if(!n&&/^\w+$/.test(e)){this.selector=e;this.context=a;e=a.getElementsByTagName(e);return r.merge(this,e)}else if(!n||n.jquery){return(n||s).find(e)}else{return r(n).find(e)}}else if(r.isFunction(e)){return s.ready(e)}if(e.selector!==t){this.selector=e.selector;this.context=e.context}return r.makeArray(e,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return x.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this.slice(e)[0]:this[e]},pushStack:function(e,t,n){var i=r();if(r.isArray(e)){w.apply(i,e)}else{r.merge(i,e)}i.prevObject=this;i.context=this.context;if(t==="find"){i.selector=this.selector+(this.selector?" ":"")+n}else if(t){i.selector=this.selector+"."+t+"("+n+")"}return i},each:function(e,t){return r.each(this,e,t)},ready:function(e){r.bindReady();if(r.isReady){e.call(a,r)}else if(p){p.push(e)}return this},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(x.apply(this,arguments),"slice",x.call(arguments).join(","))},map:function(e){return this.pushStack(r.map(this,function(t,r){return e.call(t,r,t)}))},end:function(){return this.prevObject||r(null)},push:w,sort:[].sort,splice:[].splice};r.fn.init.prototype=r.fn;r.extend=r.fn.extend=function(){var e=arguments[0]||{},n=1,i=arguments.length,a=false,s,o,l,u;if(typeof e==="boolean"){a=e;e=arguments[1]||{};n=2}if(typeof e!=="object"&&!r.isFunction(e)){e={}}if(i===n){e=this;--n}for(;n<i;n++){if((s=arguments[n])!=null){for(o in s){l=e[o];u=s[o];if(e===u){continue}if(a&&u&&(r.isPlainObject(u)||r.isArray(u))){var c=l&&(r.isPlainObject(l)||r.isArray(l))?l:r.isArray(u)?[]:{};e[o]=r.extend(a,c,u)}else if(u!==t){e[o]=u}}}}return e};r.extend({noConflict:function(t){e.$=i;if(t){e.jQuery=n}return r},isReady:false,ready:function(){if(!r.isReady){if(!a.body){return setTimeout(r.ready,13)}r.isReady=true;if(p){var e,t=0;while(e=p[t++]){e.call(a,r)}p=null}if(r.fn.triggerHandler){r(a).triggerHandler("ready")}}},bindReady:function(){if(b){return}b=true;if(a.readyState==="complete"){return r.ready()}if(a.addEventListener){a.addEventListener("DOMContentLoaded",m,false);e.addEventListener("load",r.ready,false)}else if(a.attachEvent){a.attachEvent("onreadystatechange",m);e.attachEvent("onload",r.ready);var t=false;try{t=e.frameElement==null}catch(n){}if(a.documentElement.doScroll&&t){j()}}},isFunction:function(e){return g.call(e)==="[object Function]"},isArray:function(e){return g.call(e)==="[object Array]"},isPlainObject:function(e){if(!e||g.call(e)!=="[object Object]"||e.nodeType||e.setInterval){return false}if(e.constructor&&!v.call(e,"constructor")&&!v.call(e.constructor.prototype,"isPrototypeOf")){return false}var r;for(r in e){}return r===t||v.call(e,r)},isEmptyObject:function(e){for(var t in e){return false}return true},error:function(e){throw e},parseJSON:function(t){if(typeof t!=="string"||!t){return null}t=r.trim(t);if(/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return e.JSON&&e.JSON.parse?e.JSON.parse(t):new Function("return "+t)()}else{r.error("Invalid JSON: "+t)}},noop:function(){},globalEval:function(e){if(e&&u.test(e)){var t=a.getElementsByTagName("head")[0]||a.documentElement,n=a.createElement("script");n.type="text/javascript";if(r.support.scriptEval){n.appendChild(a.createTextNode(e))}else{n.text=e}t.insertBefore(n,t.firstChild);t.removeChild(n)}},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,i){var a,s=0,o=e.length,l=o===t||r.isFunction(e);if(i){if(l){for(a in e){if(n.apply(e[a],i)===false){break}}}else{for(;s<o;){if(n.apply(e[s++],i)===false){break}}}}else{if(l){for(a in e){if(n.call(e[a],a,e[a])===false){break}}}else{for(var u=e[0];s<o&&n.call(u,s,u)!==false;u=e[++s]){}}}return e},trim:function(e){return(e||"").replace(c,"")},makeArray:function(e,t){var n=t||[];if(e!=null){if(e.length==null||typeof e==="string"||r.isFunction(e)||typeof e!=="function"&&e.setInterval){w.call(n,e)}else{r.merge(n,e)}}return n},inArray:function(e,t){if(t.indexOf){return t.indexOf(e)}for(var r=0,n=t.length;r<n;r++){if(t[r]===e){return r}}return-1},merge:function(e,r){var n=e.length,i=0;if(typeof r.length==="number"){for(var a=r.length;i<a;i++){e[n++]=r[i]}}else{while(r[i]!==t){e[n++]=r[i++]}}e.length=n;return e},grep:function(e,t,r){var n=[];for(var i=0,a=e.length;i<a;i++){if(!r!==!t(e[i],i)){n.push(e[i])}}return n},map:function(e,t,r){var n=[],i;for(var a=0,s=e.length;a<s;a++){i=t(e[a],a,r);if(i!=null){n[n.length]=i}}return n.concat.apply([],n)},guid:1,proxy:function(e,n,i){if(arguments.length===2){if(typeof n==="string"){i=e;e=i[n];n=t}else if(n&&!r.isFunction(n)){i=n;n=t}}if(!n&&e){n=function(){return e.apply(i||this,arguments)}}if(e){n.guid=e.guid=e.guid||n.guid||r.guid++}return n},uaMatch:function(e){e=e.toLowerCase();var t=/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||!/compatible/.test(e)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},browser:{}});d=r.uaMatch(f);if(d.browser){r.browser[d.browser]=true;r.browser.version=d.version}if(r.browser.webkit){r.browser.safari=true}if(y){r.inArray=function(e,t){return y.call(t,e)}}s=r(a);if(a.addEventListener){m=function(){a.removeEventListener("DOMContentLoaded",m,false);r.ready()}}else if(a.attachEvent){m=function(){if(a.readyState==="complete"){a.detachEvent("onreadystatechange",m);r.ready()}}}function j(){if(r.isReady){return}try{a.documentElement.doScroll("left")}catch(e){setTimeout(j,1);return}r.ready()}function _(e,t){if(t.src){r.ajax({url:t.src,async:false,dataType:"script"})}else{r.globalEval(t.text||t.textContent||t.innerHTML||"")}if(t.parentNode){t.parentNode.removeChild(t)}}function S(e,n,i,a,s,o){var l=e.length;if(typeof n==="object"){for(var u in n){S(e,u,n[u],a,s,i)}return e}if(i!==t){a=!o&&a&&r.isFunction(i);for(var c=0;c<l;c++){s(e[c],n,a?i.call(e[c],c,s(e[c],n)):i,o)}return e}return l?s(e[0],n):t}function E(){return(new Date).getTime()}(function(){r.support={};var t=a.documentElement,n=a.createElement("script"),i=a.createElement("div"),s="script"+E();i.style.display="none";i.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var o=i.getElementsByTagName("*"),l=i.getElementsByTagName("a")[0];if(!o||!o.length||!l){return}r.support={leadingWhitespace:i.firstChild.nodeType===3,tbody:!i.getElementsByTagName("tbody").length,htmlSerialize:!!i.getElementsByTagName("link").length,style:/red/.test(l.getAttribute("style")),hrefNormalized:l.getAttribute("href")==="/a",opacity:/^0.55$/.test(l.style.opacity),cssFloat:!!l.style.cssFloat,checkOn:i.getElementsByTagName("input")[0].value==="on",optSelected:a.createElement("select").appendChild(a.createElement("option")).selected,parentNode:i.removeChild(i.appendChild(a.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};n.type="text/javascript";try{n.appendChild(a.createTextNode("window."+s+"=1;"))}catch(u){}t.insertBefore(n,t.firstChild);if(e[s]){r.support.scriptEval=true;delete e[s]}try{delete n.test}catch(u){r.support.deleteExpando=false}t.removeChild(n);if(i.attachEvent&&i.fireEvent){i.attachEvent("onclick",function f(){r.support.noCloneEvent=false;i.detachEvent("onclick",f)});i.cloneNode(true).fireEvent("onclick")}i=a.createElement("div");i.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";var c=a.createDocumentFragment();c.appendChild(i.firstChild);r.support.checkClone=c.cloneNode(true).cloneNode(true).lastChild.checked;r(function(){var e=a.createElement("div");e.style.width=e.style.paddingLeft="1px";a.body.appendChild(e);r.boxModel=r.support.boxModel=e.offsetWidth===2;a.body.removeChild(e).style.display="none";e=null});var h=function(e){var t=a.createElement("div");e="on"+e;var r=e in t;if(!r){t.setAttribute(e,"return;");r=typeof t[e]==="function"}t=null;return r};r.support.submitBubbles=h("submit");r.support.changeBubbles=h("change");t=n=i=o=l=null})();r.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var C="jQuery"+E(),T=0,I={};r.extend({cache:{},expando:C,noData:{embed:true,object:true,applet:true},data:function(n,i,a){if(n.nodeName&&r.noData[n.nodeName.toLowerCase()]){return}n=n==e?I:n;var s=n[C],o=r.cache,l;if(!s&&typeof i==="string"&&a===t){return null}if(!s){s=++T}if(typeof i==="object"){n[C]=s;l=o[s]=r.extend(true,{},i)}else if(!o[s]){n[C]=s;o[s]={}}l=o[s];if(a!==t){l[i]=a}return typeof i==="string"?l[i]:l},removeData:function(t,n){if(t.nodeName&&r.noData[t.nodeName.toLowerCase()]){return}t=t==e?I:t;var i=t[C],a=r.cache,s=a[i];if(n){if(s){delete s[n];if(r.isEmptyObject(s)){r.removeData(t)}}}else{if(r.support.deleteExpando){delete t[r.expando]}else if(t.removeAttribute){t.removeAttribute(r.expando)}delete a[i]}}});r.fn.extend({data:function(e,n){if(typeof e==="undefined"&&this.length){return r.data(this[0])}else if(typeof e==="object"){return this.each(function(){r.data(this,e)})}var i=e.split(".");i[1]=i[1]?"."+i[1]:"";if(n===t){var a=this.triggerHandler("getData"+i[1]+"!",[i[0]]);if(a===t&&this.length){a=r.data(this[0],e)}return a===t&&i[1]?this.data(i[0]):a}else{return this.trigger("setData"+i[1]+"!",[i[0],n]).each(function(){r.data(this,e,n)})}},removeData:function(e){return this.each(function(){r.removeData(this,e)})}});r.extend({queue:function(e,t,n){if(!e){return}t=(t||"fx")+"queue";var i=r.data(e,t);if(!n){return i||[]}if(!i||r.isArray(n)){i=r.data(e,t,r.makeArray(n))}else{i.push(n)}return i},dequeue:function(e,t){t=t||"fx";var n=r.queue(e,t),i=n.shift();if(i==="inprogress"){i=n.shift()}if(i){if(t==="fx"){n.unshift("inprogress")}i.call(e,function(){r.dequeue(e,t)})}}});r.fn.extend({queue:function(e,n){if(typeof e!=="string"){n=e;e="fx"}if(n===t){return r.queue(this[0],e)}return this.each(function(t,i){var a=r.queue(this,e,n);if(e==="fx"&&a[0]!=="inprogress"){r.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){r.dequeue(this,e)})},delay:function(e,t){e=r.fx?r.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(){var n=this;setTimeout(function(){r.dequeue(n,t)},e)})},clearQueue:function(e){return this.queue(e||"fx",[])}});var N=/[\n\t]/g,D=/\s+/,R=/\r/g,A=/href|src|style/,P=/(button|input)/i,F=/(button|input|object|select|textarea)/i,M=/^(a|area)$/i,L=/radio|checkbox/;r.fn.extend({attr:function(e,t){return S(this,e,t,true,r.attr)},removeAttr:function(e,t){return this.each(function(){r.attr(this,e,"");if(this.nodeType===1){this.removeAttribute(e)}})},addClass:function(e){if(r.isFunction(e)){return this.each(function(t){var n=r(this);n.addClass(e.call(this,t,n.attr("class")))})}if(e&&typeof e==="string"){var t=(e||"").split(D);for(var n=0,i=this.length;n<i;n++){var a=this[n];if(a.nodeType===1){if(!a.className){a.className=e}else{var s=" "+a.className+" ",o=a.className;for(var l=0,u=t.length;l<u;l++){if(s.indexOf(" "+t[l]+" ")<0){o+=" "+t[l]}}a.className=r.trim(o)}}}}return this},removeClass:function(e){if(r.isFunction(e)){return this.each(function(t){var n=r(this);n.removeClass(e.call(this,t,n.attr("class")))})}if(e&&typeof e==="string"||e===t){var n=(e||"").split(D);for(var i=0,a=this.length;i<a;i++){var s=this[i];if(s.nodeType===1&&s.className){if(e){var o=(" "+s.className+" ").replace(N," ");for(var l=0,u=n.length;l<u;l++){o=o.replace(" "+n[l]+" "," ")}s.className=r.trim(o)}else{s.className=""}}}}return this},toggleClass:function(e,t){var n=typeof e,i=typeof t==="boolean";if(r.isFunction(e)){return this.each(function(n){var i=r(this);i.toggleClass(e.call(this,n,i.attr("class"),t),t)})}return this.each(function(){if(n==="string"){var a,s=0,o=r(this),l=t,u=e.split(D);while(a=u[s++]){l=i?l:!o.hasClass(a);o[l?"addClass":"removeClass"](a)}}else if(n==="undefined"||n==="boolean"){if(this.className){r.data(this,"__className__",this.className)}this.className=this.className||e===false?"":r.data(this,"__className__")||""}})},hasClass:function(e){var t=" "+e+" ";for(var r=0,n=this.length;r<n;r++){if((" "+this[r].className+" ").replace(N," ").indexOf(t)>-1){return true}}return false},val:function(e){if(e===t){var n=this[0];if(n){if(r.nodeName(n,"option")){return(n.attributes.value||{}).specified?n.value:n.text}if(r.nodeName(n,"select")){var i=n.selectedIndex,a=[],s=n.options,o=n.type==="select-one";if(i<0){return null}for(var l=o?i:0,u=o?i+1:s.length;l<u;l++){var c=s[l];if(c.selected){e=r(c).val();if(o){return e}a.push(e)}}return a}if(L.test(n.type)&&!r.support.checkOn){return n.getAttribute("value")===null?"on":n.value}return(n.value||"").replace(R,"")}return t}var h=r.isFunction(e);return this.each(function(t){var n=r(this),i=e;if(this.nodeType!==1){return}if(h){i=e.call(this,t,n.val())}if(typeof i==="number"){i+=""}if(r.isArray(i)&&L.test(this.type)){this.checked=r.inArray(n.val(),i)>=0}else if(r.nodeName(this,"select")){var a=r.makeArray(i);r("option",this).each(function(){this.selected=r.inArray(r(this).val(),a)>=0});if(!a.length){this.selectedIndex=-1}}else{this.value=i}})}});r.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(e,n,i,a){if(!e||e.nodeType===3||e.nodeType===8){return t}if(a&&n in r.attrFn){return r(e)[n](i)}var s=e.nodeType!==1||!r.isXMLDoc(e),o=i!==t;n=s&&r.props[n]||n;if(e.nodeType===1){var l=A.test(n);if(n==="selected"&&!r.support.optSelected){var u=e.parentNode;if(u){u.selectedIndex;if(u.parentNode){u.parentNode.selectedIndex}}}if(n in e&&s&&!l){if(o){if(n==="type"&&P.test(e.nodeName)&&e.parentNode){r.error("type property can't be changed")}e[n]=i}if(r.nodeName(e,"form")&&e.getAttributeNode(n)){return e.getAttributeNode(n).nodeValue}if(n==="tabIndex"){var c=e.getAttributeNode("tabIndex");return c&&c.specified?c.value:F.test(e.nodeName)||M.test(e.nodeName)&&e.href?0:t}return e[n]}if(!r.support.style&&s&&n==="style"){if(o){e.style.cssText=""+i}return e.style.cssText}if(o){e.setAttribute(n,""+i)}var h=!r.support.hrefNormalized&&s&&l?e.getAttribute(n,2):e.getAttribute(n);return h===null?t:h}return r.style(e,n,i)}});var O=/\.(.*)$/,J=function(e){return e.replace(/[^\w\s\.\|`]/g,function(e){return"\\"+e})};r.event={add:function(n,i,a,s){if(n.nodeType===3||n.nodeType===8){return}if(n.setInterval&&(n!==e&&!n.frameElement)){n=e}var o,l;if(a.handler){o=a;a=o.handler}if(!a.guid){a.guid=r.guid++}var u=r.data(n);if(!u){return}var c=u.events=u.events||{},h=u.handle,h;if(!h){u.handle=h=function(){return typeof r!=="undefined"&&!r.event.triggered?r.event.handle.apply(h.elem,arguments):t}}h.elem=n;i=i.split(" ");var f,d=0,b;while(f=i[d++]){l=o?r.extend({},o):{handler:a,data:s};if(f.indexOf(".")>-1){b=f.split(".");f=b.shift();l.namespace=b.slice(0).sort().join(".")}else{b=[];l.namespace=""}l.type=f;l.guid=a.guid;var p=c[f],m=r.event.special[f]||{};if(!p){p=c[f]=[];if(!m.setup||m.setup.call(n,s,b,h)===false){if(n.addEventListener){n.addEventListener(f,h,false)}else if(n.attachEvent){n.attachEvent("on"+f,h)}}}if(m.add){m.add.call(n,l);if(!l.handler.guid){l.handler.guid=a.guid}}p.push(l);r.event.global[f]=true}n=null},global:{},remove:function(e,t,n,i){if(e.nodeType===3||e.nodeType===8){return}var a,s,o,l=0,u,c,h,f,d,b,p,m=r.data(e),g=m&&m.events;if(!m||!g){return}if(t&&t.type){n=t.handler;t=t.type}if(!t||typeof t==="string"&&t.charAt(0)==="."){t=t||"";for(s in g){r.event.remove(e,s+t)}return}t=t.split(" ");while(s=t[l++]){p=s;b=null;u=s.indexOf(".")<0;c=[];if(!u){c=s.split(".");s=c.shift();h=new RegExp("(^|\\.)"+r.map(c.slice(0).sort(),J).join("\\.(?:.*\\.)?")+"(\\.|$)")}d=g[s];if(!d){continue}if(!n){for(var v=0;v<d.length;v++){b=d[v];if(u||h.test(b.namespace)){r.event.remove(e,p,b.handler,v);d.splice(v--,1)}}continue}f=r.event.special[s]||{};for(var v=i||0;v<d.length;v++){b=d[v];if(n.guid===b.guid){if(u||h.test(b.namespace)){if(i==null){d.splice(v--,1)}if(f.remove){f.remove.call(e,b)}}if(i!=null){break}}}if(d.length===0||i!=null&&d.length===1){if(!f.teardown||f.teardown.call(e,c)===false){k(e,s,m.handle)}a=null;delete g[s]}}if(r.isEmptyObject(g)){var w=m.handle;if(w){w.elem=null}delete m.events;delete m.handle;if(r.isEmptyObject(m)){r.removeData(e)}}},trigger:function(e,n,i){var a=e.type||e,s=arguments[3];if(!s){e=typeof e==="object"?e[C]?e:r.extend(r.Event(a),e):r.Event(a);if(a.indexOf("!")>=0){e.type=a=a.slice(0,-1);e.exclusive=true}if(!i){e.stopPropagation();if(r.event.global[a]){r.each(r.cache,function(){if(this.events&&this.events[a]){r.event.trigger(e,n,this.handle.elem)}})}}if(!i||i.nodeType===3||i.nodeType===8){return t}e.result=t;e.target=i;n=r.makeArray(n);n.unshift(e)}e.currentTarget=i;var o=r.data(i,"handle");if(o){o.apply(i,n)}var l=i.parentNode||i.ownerDocument;try{if(!(i&&i.nodeName&&r.noData[i.nodeName.toLowerCase()])){if(i["on"+a]&&i["on"+a].apply(i,n)===false){e.result=false}}}catch(u){}if(!e.isPropagationStopped()&&l){r.event.trigger(e,n,l,true)}else if(!e.isDefaultPrevented()){var c=e.target,h,f=r.nodeName(c,"a")&&a==="click",d=r.event.special[a]||{};if((!d._default||d._default.call(i,e)===false)&&!f&&!(c&&c.nodeName&&r.noData[c.nodeName.toLowerCase()])){try{if(c[a]){h=c["on"+a];if(h){c["on"+a]=null}r.event.triggered=true;c[a]()}}catch(u){}if(h){c["on"+a]=h}r.event.triggered=false}}},handle:function(n){var i,a,s,o,l;n=arguments[0]=r.event.fix(n||e.event);n.currentTarget=this;i=n.type.indexOf(".")<0&&!n.exclusive;if(!i){s=n.type.split(".");n.type=s.shift();o=new RegExp("(^|\\.)"+s.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}var l=r.data(this,"events"),a=l[n.type];if(l&&a){a=a.slice(0);for(var u=0,c=a.length;u<c;u++){var h=a[u];if(i||o.test(h.namespace)){n.handler=h.handler;n.data=h.data;n.handleObj=h;var f=h.handler.apply(this,arguments);if(f!==t){n.result=f;if(f===false){n.preventDefault();n.stopPropagation()}}if(n.isImmediatePropagationStopped()){break}}}}return n.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(e){if(e[C]){return e}var n=e;e=r.Event(n);for(var i=this.props.length,s;i;){s=this.props[--i];e[s]=n[s]}if(!e.target){e.target=e.srcElement||a}if(e.target.nodeType===3){e.target=e.target.parentNode}if(!e.relatedTarget&&e.fromElement){e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement}if(e.pageX==null&&e.clientX!=null){var o=a.documentElement,l=a.body;e.pageX=e.clientX+(o&&o.scrollLeft||l&&l.scrollLeft||0)-(o&&o.clientLeft||l&&l.clientLeft||0);e.pageY=e.clientY+(o&&o.scrollTop||l&&l.scrollTop||0)-(o&&o.clientTop||l&&l.clientTop||0)}if(!e.which&&(e.charCode||e.charCode===0?e.charCode:e.keyCode)){e.which=e.charCode||e.keyCode}if(!e.metaKey&&e.ctrlKey){e.metaKey=e.ctrlKey}if(!e.which&&e.button!==t){e.which=e.button&1?1:e.button&2?3:e.button&4?2:0}return e},guid:1e8,proxy:r.proxy,special:{ready:{setup:r.bindReady,teardown:r.noop},live:{add:function(e){r.event.add(this,e.origType,r.extend({},e,{handler:G}))},remove:function(e){var t=true,n=e.origType.replace(O,"");r.each(r.data(this,"events").live||[],function(){if(n===this.origType.replace(O,"")){t=false;return false}});if(t){r.event.remove(this,e.origType,G)}}},beforeunload:{setup:function(e,t,r){if(this.setInterval){this.onbeforeunload=r}return false},teardown:function(e,t){if(this.onbeforeunload===t){this.onbeforeunload=null}}}}};var k=a.removeEventListener?function(e,t,r){e.removeEventListener(t,r,false)}:function(e,t,r){e.detachEvent("on"+t,r)};r.Event=function(e){if(!this.preventDefault){return new r.Event(e)}if(e&&e.type){this.originalEvent=e;this.type=e.type}else{this.type=e}this.timeStamp=E();this[C]=true};function B(){return false}function $(){return true}r.Event.prototype={preventDefault:function(){this.isDefaultPrevented=$;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}e.returnValue=false},stopPropagation:function(){this.isPropagationStopped=$;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=$;this.stopPropagation()},isDefaultPrevented:B,isPropagationStopped:B,isImmediatePropagationStopped:B};var z=function(e){var t=e.relatedTarget;try{while(t&&t!==this){t=t.parentNode}if(t!==this){e.type=e.data;r.event.handle.apply(this,arguments)}}catch(n){}},U=function(e){e.type=e.data;r.event.handle.apply(this,arguments)};r.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){r.event.special[e]={setup:function(n){r.event.add(this,t,n&&n.selector?U:z,e)},teardown:function(e){r.event.remove(this,t,e&&e.selector?U:z)}}});if(!r.support.submitBubbles){r.event.special.submit={setup:function(e,t){if(this.nodeName.toLowerCase()!=="form"){r.event.add(this,"click.specialSubmit",function(e){var t=e.target,n=t.type;if((n==="submit"||n==="image")&&r(t).closest("form").length){return X("submit",this,arguments)}});r.event.add(this,"keypress.specialSubmit",function(e){var t=e.target,n=t.type;if((n==="text"||n==="password")&&r(t).closest("form").length&&e.keyCode===13){return X("submit",this,arguments)}})}else{return false}},teardown:function(e){r.event.remove(this,".specialSubmit")}}}if(!r.support.changeBubbles){var q=/textarea|input|select/i,W,H=function(e){var t=e.type,n=e.value;if(t==="radio"||t==="checkbox"){n=e.checked}else if(t==="select-multiple"){n=e.selectedIndex>-1?r.map(e.options,function(e){return e.selected}).join("-"):""}else if(e.nodeName.toLowerCase()==="select"){n=e.selectedIndex}return n},V=function Ve(e){var n=e.target,i,a;if(!q.test(n.nodeName)||n.readOnly){return}i=r.data(n,"_change_data");a=H(n);if(e.type!=="focusout"||n.type!=="radio"){r.data(n,"_change_data",a)}if(i===t||a===i){return}if(i!=null||a){e.type="change";return r.event.trigger(e,arguments[1],n)}};r.event.special.change={filters:{focusout:V,click:function(e){var t=e.target,r=t.type;if(r==="radio"||r==="checkbox"||t.nodeName.toLowerCase()==="select"){return V.call(this,e)}},keydown:function(e){var t=e.target,r=t.type;if(e.keyCode===13&&t.nodeName.toLowerCase()!=="textarea"||e.keyCode===32&&(r==="checkbox"||r==="radio")||r==="select-multiple"){return V.call(this,e)}},beforeactivate:function(e){var t=e.target;r.data(t,"_change_data",H(t))}},setup:function(e,t){if(this.type==="file"){return false}for(var n in W){r.event.add(this,n+".specialChange",W[n])}return q.test(this.nodeName)},teardown:function(e){r.event.remove(this,".specialChange");return q.test(this.nodeName)}};W=r.event.special.change.filters}function X(e,t,n){n[0].type=e;return r.event.handle.apply(t,n)}if(a.addEventListener){r.each({focus:"focusin",blur:"focusout"},function(e,t){r.event.special[t]={setup:function(){this.addEventListener(e,n,true)},teardown:function(){this.removeEventListener(e,n,true)}};function n(e){e=r.event.fix(e);e.type=t;return r.event.handle.call(this,e)}})}r.each(["bind","one"],function(e,n){r.fn[n]=function(e,i,a){if(typeof e==="object"){for(var s in e){this[n](s,i,e[s],a)}return this}if(r.isFunction(i)){a=i;i=t}var o=n==="one"?r.proxy(a,function(e){r(this).unbind(e,o);return a.apply(this,arguments)}):a;if(e==="unload"&&n!=="one"){this.one(e,i,a)}else{for(var l=0,u=this.length;l<u;l++){r.event.add(this[l],e,o,i)}}return this}});r.fn.extend({unbind:function(e,t){if(typeof e==="object"&&!e.preventDefault){for(var n in e){this.unbind(n,e[n])}}else{for(var i=0,a=this.length;i<a;i++){r.event.remove(this[i],e,t)}}return this},delegate:function(e,t,r,n){return this.live(t,r,n,e)},undelegate:function(e,t,r){if(arguments.length===0){return this.unbind("live")}else{return this.die(t,null,r,e)}},trigger:function(e,t){return this.each(function(){r.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0]){var n=r.Event(e);n.preventDefault();n.stopPropagation();r.event.trigger(n,t,this[0]);return n.result}},toggle:function(e){var t=arguments,n=1;while(n<t.length){r.proxy(e,t[n++])}return this.click(r.proxy(e,function(i){var a=(r.data(this,"lastToggle"+e.guid)||0)%n;r.data(this,"lastToggle"+e.guid,a+1);i.preventDefault();return t[a].apply(this,arguments)||false}))},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}});var Q={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};r.each(["live","die"],function(e,n){r.fn[n]=function(e,i,a,s){var o,l=0,u,c,h,f=s||this.selector,d=s?this:r(this.context);if(r.isFunction(i)){a=i;i=t}e=(e||"").split(" ");while((o=e[l++])!=null){u=O.exec(o);c="";if(u){c=u[0];o=o.replace(O,"")}if(o==="hover"){e.push("mouseenter"+c,"mouseleave"+c);continue}h=o;if(o==="focus"||o==="blur"){e.push(Q[o]+c);o=o+c}else{o=(Q[o]||o)+c}if(n==="live"){d.each(function(){r.event.add(this,Y(o,f),{data:i,selector:f,handler:a,origType:o,origHandler:a,preType:h})})}else{d.unbind(Y(o,f),a)}}return this}});function G(e){var t,n=[],i=[],a=arguments,s,o,l,u,c,h,f,d,b=r.data(this,"events");if(e.liveFired===this||!b||!b.live||e.button&&e.type==="click"){return}e.liveFired=this;var p=b.live.slice(0);for(c=0;c<p.length;c++){l=p[c];if(l.origType.replace(O,"")===e.type){i.push(l.selector)}else{p.splice(c--,1)}}o=r(e.target).closest(i,e.currentTarget);for(h=0,f=o.length;h<f;h++){for(c=0;c<p.length;c++){l=p[c];if(o[h].selector===l.selector){u=o[h].elem;s=null;if(l.preType==="mouseenter"||l.preType==="mouseleave"){s=r(e.relatedTarget).closest(l.selector)[0]}if(!s||s!==u){n.push({elem:u,handleObj:l})}}}}for(h=0,f=n.length;h<f;h++){o=n[h];e.currentTarget=o.elem;e.data=o.handleObj.data;e.handleObj=o.handleObj;if(o.handleObj.origHandler.apply(o.elem,a)===false){t=false;break}}return t}function Y(e,t){return"live."+(e&&e!=="*"?e+".":"")+t.replace(/\./g,"`").replace(/ /g,"&")}r.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error").split(" "),function(e,t){r.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)};if(r.attrFn){r.attrFn[t]=true}});if(e.attachEvent&&!e.addEventListener){e.attachEvent("onunload",function(){for(var e in r.cache){if(r.cache[e].handle){try{r.event.remove(r.cache[e].handle.elem)}catch(t){}}}})}(function(){var n=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,i=0,s=Object.prototype.toString,o=false,l=true;[0,0].sort(function(){l=false;return 0});var u=function(e,t,r,i){r=r||[];var o=t=t||a;if(t.nodeType!==1&&t.nodeType!==9){return[]}if(!e||typeof e!=="string"){return r}var l=[],f,b,p,m,g=true,v=x(t),j=e;while((n.exec(""),f=n.exec(j))!==null){j=f[3];l.push(f[1]);if(f[2]){m=f[3];break}}if(l.length>1&&h.exec(e)){if(l.length===2&&c.relative[l[0]]){b=y(l[0]+l[1],t)}else{b=c.relative[l[0]]?[t]:u(l.shift(),t);while(l.length){e=l.shift();if(c.relative[e]){e+=l.shift()}b=y(e,b)}}}else{if(!i&&l.length>1&&t.nodeType===9&&!v&&c.match.ID.test(l[0])&&!c.match.ID.test(l[l.length-1])){var _=u.find(l.shift(),t,v);t=_.expr?u.filter(_.expr,_.set)[0]:_.set[0]}if(t){var _=i?{expr:l.pop(),set:d(i)}:u.find(l.pop(),l.length===1&&(l[0]==="~"||l[0]==="+")&&t.parentNode?t.parentNode:t,v);b=_.expr?u.filter(_.expr,_.set):_.set;if(l.length>0){p=d(b)}else{g=false}while(l.length){var S=l.pop(),E=S;if(!c.relative[S]){S=""}else{E=l.pop()}if(E==null){E=t}c.relative[S](p,E,v)}}else{p=l=[]}}if(!p){p=b}if(!p){u.error(S||e)}if(s.call(p)==="[object Array]"){if(!g){r.push.apply(r,p)}else if(t&&t.nodeType===1){for(var C=0;p[C]!=null;C++){if(p[C]&&(p[C]===true||p[C].nodeType===1&&w(t,p[C]))){r.push(b[C])}}}else{for(var C=0;p[C]!=null;C++){if(p[C]&&p[C].nodeType===1){r.push(b[C])}}}}else{d(p,r)}if(m){u(m,o,r,i);u.uniqueSort(r)}return r};u.uniqueSort=function(e){if(p){o=l;e.sort(p);if(o){for(var t=1;t<e.length;t++){if(e[t]===e[t-1]){e.splice(t--,1)}}}}return e};u.matches=function(e,t){return u(e,null,null,t)};u.find=function(e,t,r){var n,i;if(!e){return[]}for(var a=0,s=c.order.length;a<s;a++){var o=c.order[a],i;if(i=c.leftMatch[o].exec(e)){var l=i[1];i.splice(1,1);if(l.substr(l.length-1)!=="\\"){i[1]=(i[1]||"").replace(/\\/g,"");n=c.find[o](i,t,r);if(n!=null){e=e.replace(c.match[o],"");break}}}}if(!n){n=t.getElementsByTagName("*")}return{set:n,expr:e}};u.filter=function(e,r,n,i){var a=e,s=[],o=r,l,h,f=r&&r[0]&&x(r[0]);while(e&&r.length){for(var d in c.filter){if((l=c.leftMatch[d].exec(e))!=null&&l[2]){var b=c.filter[d],p,m,g=l[1];h=false;l.splice(1,1);if(g.substr(g.length-1)==="\\"){continue}if(o===s){s=[]}if(c.preFilter[d]){l=c.preFilter[d](l,o,n,s,i,f);if(!l){h=p=true}else if(l===true){continue}}if(l){for(var v=0;(m=o[v])!=null;v++){if(m){p=b(m,l,v,o);var w=i^!!p;if(n&&p!=null){if(w){h=true}else{o[v]=false}}else if(w){s.push(m);h=true}}}}if(p!==t){if(!n){o=s}e=e.replace(c.match[d],"");if(!h){return[]}break}}}if(e===a){if(h==null){u.error(e)}else{break}}a=e}return o};u.error=function(e){throw"Syntax error, unrecognized expression: "+e};var c=u.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(e,t){var r=typeof t==="string",n=r&&!/\W/.test(t),i=r&&!n;if(n){t=t.toLowerCase()}for(var a=0,s=e.length,o;a<s;a++){if(o=e[a]){while((o=o.previousSibling)&&o.nodeType!==1){}e[a]=i||o&&o.nodeName.toLowerCase()===t?o||false:o===t}}if(i){u.filter(t,e,true)}},">":function(e,t){var r=typeof t==="string";if(r&&!/\W/.test(t)){t=t.toLowerCase();for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a){var s=a.parentNode;e[n]=s.nodeName.toLowerCase()===t?s:false}}}else{for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a){e[n]=r?a.parentNode:a.parentNode===t}}if(r){u.filter(t,e,true)}}},"":function(e,t,r){var n=i++,a=v;if(typeof t==="string"&&!/\W/.test(t)){var s=t=t.toLowerCase();a=g}a("parentNode",t,n,e,s,r)},"~":function(e,t,r){var n=i++,a=v;if(typeof t==="string"&&!/\W/.test(t)){var s=t=t.toLowerCase();a=g}a("previousSibling",t,n,e,s,r)}},find:{ID:function(e,t,r){
if(typeof t.getElementById!=="undefined"&&!r){var n=t.getElementById(e[1]);return n?[n]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!=="undefined"){var r=[],n=t.getElementsByName(e[1]);for(var i=0,a=n.length;i<a;i++){if(n[i].getAttribute("name")===e[1]){r.push(n[i])}}return r.length===0?null:r}},TAG:function(e,t){return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,r,n,i,a){e=" "+e[1].replace(/\\/g,"")+" ";if(a){return e}for(var s=0,o;(o=t[s])!=null;s++){if(o){if(i^(o.className&&(" "+o.className+" ").replace(/[\t\n]/g," ").indexOf(e)>=0)){if(!r){n.push(o)}}else if(r){t[s]=false}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(e,t){return e[1].toLowerCase()},CHILD:function(e){if(e[1]==="nth"){var t=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0;e[3]=t[3]-0}e[0]=i++;return e},ATTR:function(e,t,r,n,i,a){var s=e[1].replace(/\\/g,"");if(!a&&c.attrMap[s]){e[1]=c.attrMap[s]}if(e[2]==="~="){e[4]=" "+e[4]+" "}return e},PSEUDO:function(e,t,r,i,a){if(e[1]==="not"){if((n.exec(e[3])||"").length>1||/^\w/.test(e[3])){e[3]=u(e[3],null,null,t)}else{var s=u.filter(e[3],t,r,true^a);if(!r){i.push.apply(i,s)}return false}}else if(c.match.POS.test(e[0])||c.match.CHILD.test(e[0])){return true}return e},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,r){return!!u(r[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toLowerCase()==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(e,t){return t===0},last:function(e,t,r,n){return t===n.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,r){return t<r[3]-0},gt:function(e,t,r){return t>r[3]-0},nth:function(e,t,r){return r[3]-0===t},eq:function(e,t,r){return r[3]-0===t}},filter:{PSEUDO:function(e,t,r,n){var i=t[1],a=c.filters[i];if(a){return a(e,r,t,n)}else if(i==="contains"){return(e.textContent||e.innerText||m([e])||"").indexOf(t[3])>=0}else if(i==="not"){var s=t[3];for(var r=0,o=s.length;r<o;r++){if(s[r]===e){return false}}return true}else{u.error("Syntax error, unrecognized expression: "+i)}},CHILD:function(e,t){var r=t[1],n=e;switch(r){case"only":case"first":while(n=n.previousSibling){if(n.nodeType===1){return false}}if(r==="first"){return true}n=e;case"last":while(n=n.nextSibling){if(n.nodeType===1){return false}}return true;case"nth":var i=t[2],a=t[3];if(i===1&&a===0){return true}var s=t[0],o=e.parentNode;if(o&&(o.sizcache!==s||!e.nodeIndex)){var l=0;for(n=o.firstChild;n;n=n.nextSibling){if(n.nodeType===1){n.nodeIndex=++l}}o.sizcache=s}var u=e.nodeIndex-a;if(i===0){return u===0}else{return u%i===0&&u/i>=0}}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var r=t[1],n=c.attrHandle[r]?c.attrHandle[r](e):e[r]!=null?e[r]:e.getAttribute(r),i=n+"",a=t[2],s=t[4];return n==null?a==="!=":a==="="?i===s:a==="*="?i.indexOf(s)>=0:a==="~="?(" "+i+" ").indexOf(s)>=0:!s?i&&n!==false:a==="!="?i!==s:a==="^="?i.indexOf(s)===0:a==="$="?i.substr(i.length-s.length)===s:a==="|="?i===s||i.substr(0,s.length+1)===s+"-":false},POS:function(e,t,r,n){var i=t[2],a=c.setFilters[i];if(a){return a(e,r,t,n)}}}};var h=c.match.POS;for(var f in c.match){c.match[f]=new RegExp(c.match[f].source+/(?![^\[]*\])(?![^\(]*\))/.source);c.leftMatch[f]=new RegExp(/(^(?:.|\r|\n)*?)/.source+c.match[f].source.replace(/\\(\d+)/g,function(e,t){return"\\"+(t-0+1)}))}var d=function(e,t){e=Array.prototype.slice.call(e,0);if(t){t.push.apply(t,e);return t}return e};try{Array.prototype.slice.call(a.documentElement.childNodes,0)[0].nodeType}catch(b){d=function(e,t){var r=t||[];if(s.call(e)==="[object Array]"){Array.prototype.push.apply(r,e)}else{if(typeof e.length==="number"){for(var n=0,i=e.length;n<i;n++){r.push(e[n])}}else{for(var n=0;e[n];n++){r.push(e[n])}}}return r}}var p;if(a.documentElement.compareDocumentPosition){p=function(e,t){if(!e.compareDocumentPosition||!t.compareDocumentPosition){if(e==t){o=true}return e.compareDocumentPosition?-1:1}var r=e.compareDocumentPosition(t)&4?-1:e===t?0:1;if(r===0){o=true}return r}}else if("sourceIndex"in a.documentElement){p=function(e,t){if(!e.sourceIndex||!t.sourceIndex){if(e==t){o=true}return e.sourceIndex?-1:1}var r=e.sourceIndex-t.sourceIndex;if(r===0){o=true}return r}}else if(a.createRange){p=function(e,t){if(!e.ownerDocument||!t.ownerDocument){if(e==t){o=true}return e.ownerDocument?-1:1}var r=e.ownerDocument.createRange(),n=t.ownerDocument.createRange();r.setStart(e,0);r.setEnd(e,0);n.setStart(t,0);n.setEnd(t,0);var i=r.compareBoundaryPoints(Range.START_TO_END,n);if(i===0){o=true}return i}}function m(e){var t="",r;for(var n=0;e[n];n++){r=e[n];if(r.nodeType===3||r.nodeType===4){t+=r.nodeValue}else if(r.nodeType!==8){t+=m(r.childNodes)}}return t}(function(){var e=a.createElement("div"),r="script"+(new Date).getTime();e.innerHTML="<a name='"+r+"'/>";var n=a.documentElement;n.insertBefore(e,n.firstChild);if(a.getElementById(r)){c.find.ID=function(e,r,n){if(typeof r.getElementById!=="undefined"&&!n){var i=r.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!=="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}};c.filter.ID=function(e,t){var r=typeof e.getAttributeNode!=="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&r&&r.nodeValue===t}}n.removeChild(e);n=e=null})();(function(){var e=a.createElement("div");e.appendChild(a.createComment(""));if(e.getElementsByTagName("*").length>0){c.find.TAG=function(e,t){var r=t.getElementsByTagName(e[1]);if(e[1]==="*"){var n=[];for(var i=0;r[i];i++){if(r[i].nodeType===1){n.push(r[i])}}r=n}return r}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){c.attrHandle.href=function(e){return e.getAttribute("href",2)}}e=null})();if(a.querySelectorAll){(function(){var e=u,t=a.createElement("div");t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}u=function(t,r,n,i){r=r||a;if(!i&&r.nodeType===9&&!x(r)){try{return d(r.querySelectorAll(t),n)}catch(s){}}return e(t,r,n,i)};for(var r in e){u[r]=e[r]}t=null})()}(function(){var e=a.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}c.order.splice(1,0,"CLASS");c.find.CLASS=function(e,t,r){if(typeof t.getElementsByClassName!=="undefined"&&!r){return t.getElementsByClassName(e[1])}};e=null})();function g(e,t,r,n,i,a){for(var s=0,o=n.length;s<o;s++){var l=n[s];if(l){l=l[e];var u=false;while(l){if(l.sizcache===r){u=n[l.sizset];break}if(l.nodeType===1&&!a){l.sizcache=r;l.sizset=s}if(l.nodeName.toLowerCase()===t){u=l;break}l=l[e]}n[s]=u}}}function v(e,t,r,n,i,a){for(var s=0,o=n.length;s<o;s++){var l=n[s];if(l){l=l[e];var c=false;while(l){if(l.sizcache===r){c=n[l.sizset];break}if(l.nodeType===1){if(!a){l.sizcache=r;l.sizset=s}if(typeof t!=="string"){if(l===t){c=true;break}}else if(u.filter(t,[l]).length>0){c=l;break}}l=l[e]}n[s]=c}}}var w=a.compareDocumentPosition?function(e,t){return!!(e.compareDocumentPosition(t)&16)}:function(e,t){return e!==t&&(e.contains?e.contains(t):true)};var x=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":false};var y=function(e,t){var r=[],n="",i,a=t.nodeType?[t]:t;while(i=c.match.PSEUDO.exec(e)){n+=i[0];e=e.replace(c.match.PSEUDO,"")}e=c.relative[e]?e+"*":e;for(var s=0,o=a.length;s<o;s++){u(e,a[s],r)}return u.filter(n,r)};r.find=u;r.expr=u.selectors;r.expr[":"]=r.expr.filters;r.unique=u.uniqueSort;r.text=m;r.isXMLDoc=x;r.contains=w;return;e.Sizzle=u})();var K=/Until$/,Z=/^(?:parents|prevUntil|prevAll)/,ee=/,/,x=Array.prototype.slice;var te=function(e,t,n){if(r.isFunction(t)){return r.grep(e,function(e,r){return!!t.call(e,r,e)===n})}else if(t.nodeType){return r.grep(e,function(e,r){return e===t===n})}else if(typeof t==="string"){var i=r.grep(e,function(e){return e.nodeType===1});if(l.test(t)){return r.filter(t,i,!n)}else{t=r.filter(t,i)}}return r.grep(e,function(e,i){return r.inArray(e,t)>=0===n})};r.fn.extend({find:function(e){var t=this.pushStack("","find",e),n=0;for(var i=0,a=this.length;i<a;i++){n=t.length;r.find(e,this[i],t);if(i>0){for(var s=n;s<t.length;s++){for(var o=0;o<n;o++){if(t[o]===t[s]){t.splice(s--,1);break}}}}}return t},has:function(e){var t=r(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++){if(r.contains(this,t[e])){return true}}})},not:function(e){return this.pushStack(te(this,e,false),"not",e)},filter:function(e){return this.pushStack(te(this,e,true),"filter",e)},is:function(e){return!!e&&r.filter(e,this).length>0},closest:function(e,t){if(r.isArray(e)){var n=[],i=this[0],a,s={},o;if(i&&e.length){for(var l=0,u=e.length;l<u;l++){o=e[l];if(!s[o]){s[o]=r.expr.match.POS.test(o)?r(o,t||this.context):o}}while(i&&i.ownerDocument&&i!==t){for(o in s){a=s[o];if(a.jquery?a.index(i)>-1:r(i).is(a)){n.push({selector:o,elem:i});delete s[o]}}i=i.parentNode}}return n}var c=r.expr.match.POS.test(e)?r(e,t||this.context):null;return this.map(function(n,i){while(i&&i.ownerDocument&&i!==t){if(c?c.index(i)>-1:r(i).is(e)){return i}i=i.parentNode}return null})},index:function(e){if(!e||typeof e==="string"){return r.inArray(this[0],e?r(e):this.parent().children())}return r.inArray(e.jquery?e[0]:e,this)},add:function(e,t){var n=typeof e==="string"?r(e,t||this.context):r.makeArray(e),i=r.merge(this.get(),n);return this.pushStack(re(n[0])||re(i[0])?i:r.unique(i))},andSelf:function(){return this.add(this.prevObject)}});function re(e){return!e||!e.parentNode||e.parentNode.nodeType===11}r.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return r.dir(e,"parentNode")},parentsUntil:function(e,t,n){return r.dir(e,"parentNode",n)},next:function(e){return r.nth(e,2,"nextSibling")},prev:function(e){return r.nth(e,2,"previousSibling")},nextAll:function(e){return r.dir(e,"nextSibling")},prevAll:function(e){return r.dir(e,"previousSibling")},nextUntil:function(e,t,n){return r.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return r.dir(e,"previousSibling",n)},siblings:function(e){return r.sibling(e.parentNode.firstChild,e)},children:function(e){return r.sibling(e.firstChild)},contents:function(e){return r.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:r.makeArray(e.childNodes)}},function(e,t){r.fn[e]=function(n,i){var a=r.map(this,t,n);if(!K.test(e)){i=n}if(i&&typeof i==="string"){a=r.filter(i,a)}a=this.length>1?r.unique(a):a;if((this.length>1||ee.test(i))&&Z.test(e)){a=a.reverse()}return this.pushStack(a,e,x.call(arguments).join(","))}});r.extend({filter:function(e,t,n){if(n){e=":not("+e+")"}return r.find.matches(e,t)},dir:function(e,n,i){var a=[],s=e[n];while(s&&s.nodeType!==9&&(i===t||s.nodeType!==1||!r(s).is(i))){if(s.nodeType===1){a.push(s)}s=s[n]}return a},nth:function(e,t,r,n){t=t||1;var i=0;for(;e;e=e[r]){if(e.nodeType===1&&++i===t){break}}return e},sibling:function(e,t){var r=[];for(;e;e=e.nextSibling){if(e.nodeType===1&&e!==t){r.push(e)}}return r}});var ne=/ jQuery\d+="(?:\d+|null)"/g,ie=/^\s+/,ae=/(<([\w:]+)[^>]*?)\/>/g,se=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,oe=/<([\w:]+)/,le=/<tbody/i,ue=/<|&#?\w+;/,ce=/<script|<object|<embed|<option|<style/i,he=/checked\s*(?:[^=]|=\s*.checked.)/i,fe=function(e,t,r){return se.test(r)?e:t+"></"+r+">"},de={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};de.optgroup=de.option;de.tbody=de.tfoot=de.colgroup=de.caption=de.thead;de.th=de.td;if(!r.support.htmlSerialize){de._default=[1,"div<div>","</div>"]}r.fn.extend({text:function(e){if(r.isFunction(e)){return this.each(function(t){var n=r(this);n.text(e.call(this,t,n.text()))})}if(typeof e!=="object"&&e!==t){return this.empty().append((this[0]&&this[0].ownerDocument||a).createTextNode(e))}return r.text(this)},wrapAll:function(e){if(r.isFunction(e)){return this.each(function(t){r(this).wrapAll(e.call(this,t))})}if(this[0]){var t=r(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){t.insertBefore(this[0])}t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){if(r.isFunction(e)){return this.each(function(t){r(this).wrapInner(e.call(this,t))})}return this.each(function(){var t=r(this),n=t.contents();if(n.length){n.wrapAll(e)}else{t.append(e)}})},wrap:function(e){return this.each(function(){r(this).wrapAll(e)})},unwrap:function(){return this.parent().each(function(){if(!r.nodeName(this,"body")){r(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.appendChild(e)}})},prepend:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.insertBefore(e,this.firstChild)}})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this)})}else if(arguments.length){var e=r(arguments[0]);e.push.apply(e,this.toArray());return this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this.nextSibling)})}else if(arguments.length){var e=this.pushStack(this,"after",arguments);e.push.apply(e,r(arguments[0]).toArray());return e}},remove:function(e,t){for(var n=0,i;(i=this[n])!=null;n++){if(!e||r.filter(e,[i]).length){if(!t&&i.nodeType===1){r.cleanData(i.getElementsByTagName("*"));r.cleanData([i])}if(i.parentNode){i.parentNode.removeChild(i)}}}return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){if(t.nodeType===1){r.cleanData(t.getElementsByTagName("*"))}while(t.firstChild){t.removeChild(t.firstChild)}}return this},clone:function(e){var t=this.map(function(){if(!r.support.noCloneEvent&&!r.isXMLDoc(this)){var e=this.outerHTML,t=this.ownerDocument;if(!e){var n=t.createElement("div");n.appendChild(this.cloneNode(true));e=n.innerHTML}return r.clean([e.replace(ne,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(ie,"")],t)[0]}else{return this.cloneNode(true)}});if(e===true){be(this,t);be(this.find("*"),t.find("*"))}return t},html:function(e){if(e===t){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(ne,""):null}else if(typeof e==="string"&&!ce.test(e)&&(r.support.leadingWhitespace||!ie.test(e))&&!de[(oe.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ae,fe);try{for(var n=0,i=this.length;n<i;n++){if(this[n].nodeType===1){r.cleanData(this[n].getElementsByTagName("*"));this[n].innerHTML=e}}}catch(a){this.empty().append(e)}}else if(r.isFunction(e)){this.each(function(t){var n=r(this),i=n.html();n.empty().append(function(){return e.call(this,t,i)})})}else{this.empty().append(e)}return this},replaceWith:function(e){if(this[0]&&this[0].parentNode){if(r.isFunction(e)){return this.each(function(t){var n=r(this),i=n.html();n.replaceWith(e.call(this,t,i))})}if(typeof e!=="string"){e=r(e).detach()}return this.each(function(){var t=this.nextSibling,n=this.parentNode;r(this).remove();if(t){r(t).before(e)}else{r(n).append(e)}})}else{return this.pushStack(r(r.isFunction(e)?e():e),"replaceWith",e)}},detach:function(e){return this.remove(e,true)},domManip:function(e,n,i){var a,s,o=e[0],l=[],u,c;if(!r.support.checkClone&&arguments.length===3&&typeof o==="string"&&he.test(o)){return this.each(function(){r(this).domManip(e,n,i,true)})}if(r.isFunction(o)){return this.each(function(a){var s=r(this);e[0]=o.call(this,a,n?s.html():t);s.domManip(e,n,i)})}if(this[0]){c=o&&o.parentNode;if(r.support.parentNode&&c&&c.nodeType===11&&c.childNodes.length===this.length){a={fragment:c}}else{a=pe(e,this,l)}u=a.fragment;if(u.childNodes.length===1){s=u=u.firstChild}else{s=u.firstChild}if(s){n=n&&r.nodeName(s,"tr");for(var h=0,f=this.length;h<f;h++){i.call(n?d(this[h],s):this[h],h>0||a.cacheable||this.length>1?u.cloneNode(true):u)}}if(l.length){r.each(l,_)}}return this;function d(e,t){return r.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}}});function be(e,t){var n=0;t.each(function(){if(this.nodeName!==(e[n]&&e[n].nodeName)){return}var t=r.data(e[n++]),i=r.data(this,t),a=t&&t.events;if(a){delete i.handle;i.events={};for(var s in a){for(var o in a[s]){r.event.add(this,s,a[s][o],a[s][o].data)}}}})}function pe(e,t,n){var i,s,o,l=t&&t[0]?t[0].ownerDocument||t[0]:a;if(e.length===1&&typeof e[0]==="string"&&e[0].length<512&&l===a&&!ce.test(e[0])&&(r.support.checkClone||!he.test(e[0]))){s=true;o=r.fragments[e[0]];if(o){if(o!==1){i=o}}}if(!i){i=l.createDocumentFragment();r.clean(e,l,i,n)}if(s){r.fragments[e[0]]=o?i:1}return{fragment:i,cacheable:s}}r.fragments={};r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){r.fn[e]=function(n){var i=[],a=r(n),s=this.length===1&&this[0].parentNode;if(s&&s.nodeType===11&&s.childNodes.length===1&&a.length===1){a[t](this[0]);return this}else{for(var o=0,l=a.length;o<l;o++){var u=(o>0?this.clone(true):this).get();r.fn[t].apply(r(a[o]),u);i=i.concat(u)}return this.pushStack(i,e,a.selector)}}});r.extend({clean:function(e,t,n,i){t=t||a;if(typeof t.createElement==="undefined"){t=t.ownerDocument||t[0]&&t[0].ownerDocument||a}var s=[];for(var o=0,l;(l=e[o])!=null;o++){if(typeof l==="number"){l+=""}if(!l){continue}if(typeof l==="string"&&!ue.test(l)){l=t.createTextNode(l)}else if(typeof l==="string"){l=l.replace(ae,fe);var u=(oe.exec(l)||["",""])[1].toLowerCase(),c=de[u]||de._default,h=c[0],f=t.createElement("div");f.innerHTML=c[1]+l+c[2];while(h--){f=f.lastChild}if(!r.support.tbody){var d=le.test(l),b=u==="table"&&!d?f.firstChild&&f.firstChild.childNodes:c[1]==="<table>"&&!d?f.childNodes:[];for(var p=b.length-1;p>=0;--p){if(r.nodeName(b[p],"tbody")&&!b[p].childNodes.length){b[p].parentNode.removeChild(b[p])}}}if(!r.support.leadingWhitespace&&ie.test(l)){f.insertBefore(t.createTextNode(ie.exec(l)[0]),f.firstChild)}l=f.childNodes}if(l.nodeType){s.push(l)}else{s=r.merge(s,l)}}if(n){for(var o=0;s[o];o++){if(i&&r.nodeName(s[o],"script")&&(!s[o].type||s[o].type.toLowerCase()==="text/javascript")){i.push(s[o].parentNode?s[o].parentNode.removeChild(s[o]):s[o])}else{if(s[o].nodeType===1){s.splice.apply(s,[o+1,0].concat(r.makeArray(s[o].getElementsByTagName("script"))))}n.appendChild(s[o])}}}return s},cleanData:function(e){var t,n,i=r.cache,a=r.event.special,s=r.support.deleteExpando;for(var o=0,l;(l=e[o])!=null;o++){n=l[r.expando];if(n){t=i[n];if(t.events){for(var u in t.events){if(a[u]){r.event.remove(l,u)}else{k(l,u,t.handle)}}}if(s){delete l[r.expando]}else if(l.removeAttribute){l.removeAttribute(r.expando)}delete i[n]}}}});var me=/z-?index|font-?weight|opacity|zoom|line-?height/i,ge=/alpha\([^)]*\)/,ve=/opacity=([^)]*)/,we=/float/i,xe=/-([a-z])/gi,ye=/([A-Z])/g,je=/^-?\d+(?:px)?$/i,_e=/^-?\d/,Se={position:"absolute",visibility:"hidden",display:"block"},Ee=["Left","Right"],Ce=["Top","Bottom"],Te=a.defaultView&&a.defaultView.getComputedStyle,Ie=r.support.cssFloat?"cssFloat":"styleFloat",Ne=function(e,t){return t.toUpperCase()};r.fn.css=function(e,n){return S(this,e,n,true,function(e,n,i){if(i===t){return r.curCSS(e,n)}if(typeof i==="number"&&!me.test(n)){i+="px"}r.style(e,n,i)})};r.extend({style:function(e,n,i){if(!e||e.nodeType===3||e.nodeType===8){return t}if((n==="width"||n==="height")&&parseFloat(i)<0){i=t}var a=e.style||e,s=i!==t;if(!r.support.opacity&&n==="opacity"){if(s){a.zoom=1;var o=parseInt(i,10)+""==="NaN"?"":"alpha(opacity="+i*100+")";var l=a.filter||r.curCSS(e,"filter")||"";a.filter=ge.test(l)?l.replace(ge,o):o}return a.filter&&a.filter.indexOf("opacity=")>=0?parseFloat(ve.exec(a.filter)[1])/100+"":""}if(we.test(n)){n=Ie}n=n.replace(xe,Ne);if(s){a[n]=i}return a[n]},css:function(e,t,n,i){if(t==="width"||t==="height"){var a,s=Se,o=t==="width"?Ee:Ce;function l(){a=t==="width"?e.offsetWidth:e.offsetHeight;if(i==="border"){return}r.each(o,function(){if(!i){a-=parseFloat(r.curCSS(e,"padding"+this,true))||0}if(i==="margin"){a+=parseFloat(r.curCSS(e,"margin"+this,true))||0}else{a-=parseFloat(r.curCSS(e,"border"+this+"Width",true))||0}})}if(e.offsetWidth!==0){l()}else{r.swap(e,s,l)}return Math.max(0,Math.round(a))}return r.curCSS(e,t,n)},curCSS:function(e,t,n){var i,a=e.style,s;if(!r.support.opacity&&t==="opacity"&&e.currentStyle){i=ve.test(e.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return i===""?"1":i}if(we.test(t)){t=Ie}if(!n&&a&&a[t]){i=a[t]}else if(Te){if(we.test(t)){t="float"}t=t.replace(ye,"-$1").toLowerCase();var o=e.ownerDocument.defaultView;if(!o){return null}var l=o.getComputedStyle(e,null);if(l){i=l.getPropertyValue(t)}if(t==="opacity"&&i===""){i="1"}}else if(e.currentStyle){var u=t.replace(xe,Ne);i=e.currentStyle[t]||e.currentStyle[u];if(!je.test(i)&&_e.test(i)){var c=a.left,h=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left;a.left=u==="fontSize"?"1em":i||0;i=a.pixelLeft+"px";a.left=c;e.runtimeStyle.left=h}}return i},swap:function(e,t,r){var n={};for(var i in t){n[i]=e.style[i];e.style[i]=t[i]}r.call(e);for(var i in t){e.style[i]=n[i]}}});if(r.expr&&r.expr.filters){r.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight,i=e.nodeName.toLowerCase()==="tr";return t===0&&n===0&&!i?true:t>0&&n>0&&!i?false:r.curCSS(e,"display")==="none"};r.expr.filters.visible=function(e){return!r.expr.filters.hidden(e)}}var De=E(),Re=/<script(.|\s)*?\/script>/gi,Ae=/select|textarea/i,Pe=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,Fe=/=\?(&|$)/,Me=/\?/,Le=/(\?|&)_=.*?(&|$)/,Oe=/^(\w+:)?\/\/([^\/?#]+)/,Je=/%20/g,ke=r.fn.load;r.fn.extend({load:function(e,t,n){if(typeof e!=="string"){return ke.call(this,e)}else if(!this.length){return this}var i=e.indexOf(" ");if(i>=0){var a=e.slice(i,e.length);e=e.slice(0,i)}var s="GET";if(t){if(r.isFunction(t)){n=t;t=null}else if(typeof t==="object"){t=r.param(t,r.ajaxSettings.traditional);s="POST"}}var o=this;r.ajax({url:e,type:s,dataType:"html",data:t,complete:function(e,t){if(t==="success"||t==="notmodified"){o.html(a?r("<div />").append(e.responseText.replace(Re,"")).find(a):e.responseText)}if(n){o.each(n,[e.responseText,t,e])}}});return this},serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?r.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Ae.test(this.nodeName)||Pe.test(this.type))}).map(function(e,t){var n=r(this).val();return n==null?null:r.isArray(n)?r.map(n,function(e,r){return{name:t.name,value:e}}):{name:t.name,value:n}}).get()}});r.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){r.fn[t]=function(e){return this.bind(t,e)}});r.extend({get:function(e,t,n,i){if(r.isFunction(t)){i=i||n;n=t;t=null}return r.ajax({type:"GET",url:e,data:t,success:n,dataType:i})},getScript:function(e,t){return r.get(e,null,t,"script")},getJSON:function(e,t,n){return r.get(e,t,n,"json")},post:function(e,t,n,i){if(r.isFunction(t)){i=i||n;n=t;t={}}return r.ajax({type:"POST",url:e,data:t,success:n,dataType:i})},ajaxSetup:function(e){r.extend(r.ajaxSettings,e)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:e.XMLHttpRequest&&(e.location.protocol!=="file:"||!e.ActiveXObject)?function(){return new e.XMLHttpRequest}:function(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(n){var i=r.extend(true,{},r.ajaxSettings,n);var s,o,l,u=n&&n.context||i,c=i.type.toUpperCase();if(i.data&&i.processData&&typeof i.data!=="string"){i.data=r.param(i.data,i.traditional)}if(i.dataType==="jsonp"){if(c==="GET"){if(!Fe.test(i.url)){i.url+=(Me.test(i.url)?"&":"?")+(i.jsonp||"callback")+"=?"}}else if(!i.data||!Fe.test(i.data)){i.data=(i.data?i.data+"&":"")+(i.jsonp||"callback")+"=?"}i.dataType="json"}if(i.dataType==="json"&&(i.data&&Fe.test(i.data)||Fe.test(i.url))){s=i.jsonpCallback||"jsonp"+De++;if(i.data){i.data=(i.data+"").replace(Fe,"="+s+"$1")}i.url=i.url.replace(Fe,"="+s+"$1");i.dataType="script";e[s]=e[s]||function(r){l=r;_();S();e[s]=t;try{delete e[s]}catch(n){}if(p){p.removeChild(m)}}}if(i.dataType==="script"&&i.cache===null){i.cache=false}if(i.cache===false&&c==="GET"){var h=E();var f=i.url.replace(Le,"$1_="+h+"$2");i.url=f+(f===i.url?(Me.test(i.url)?"&":"?")+"_="+h:"")}if(i.data&&c==="GET"){i.url+=(Me.test(i.url)?"&":"?")+i.data}if(i.global&&!r.active++){r.event.trigger("ajaxStart")}var d=Oe.exec(i.url),b=d&&(d[1]&&d[1]!==location.protocol||d[2]!==location.host);if(i.dataType==="script"&&c==="GET"&&b){var p=a.getElementsByTagName("head")[0]||a.documentElement;var m=a.createElement("script");m.src=i.url;if(i.scriptCharset){m.charset=i.scriptCharset}if(!s){var g=false;m.onload=m.onreadystatechange=function(){if(!g&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){g=true;_();S();m.onload=m.onreadystatechange=null;if(p&&m.parentNode){p.removeChild(m)}}}}p.insertBefore(m,p.firstChild);return t}var v=false;var w=i.xhr();if(!w){return}if(i.username){w.open(c,i.url,i.async,i.username,i.password)}else{w.open(c,i.url,i.async)}try{if(i.data||n&&n.contentType){w.setRequestHeader("Content-Type",i.contentType)}if(i.ifModified){if(r.lastModified[i.url]){w.setRequestHeader("If-Modified-Since",r.lastModified[i.url])}if(r.etag[i.url]){w.setRequestHeader("If-None-Match",r.etag[i.url])}}if(!b){w.setRequestHeader("X-Requested-With","XMLHttpRequest")}w.setRequestHeader("Accept",i.dataType&&i.accepts[i.dataType]?i.accepts[i.dataType]+", */*":i.accepts._default)}catch(x){}if(i.beforeSend&&i.beforeSend.call(u,w,i)===false){if(i.global&&!--r.active){r.event.trigger("ajaxStop")}w.abort();return false}if(i.global){C("ajaxSend",[w,i])}var y=w.onreadystatechange=function(e){if(!w||w.readyState===0||e==="abort"){if(!v){S()}v=true;if(w){w.onreadystatechange=r.noop}}else if(!v&&w&&(w.readyState===4||e==="timeout")){v=true;w.onreadystatechange=r.noop;o=e==="timeout"?"timeout":!r.httpSuccess(w)?"error":i.ifModified&&r.httpNotModified(w,i.url)?"notmodified":"success";var t;if(o==="success"){try{l=r.httpData(w,i.dataType,i)}catch(n){o="parsererror";t=n}}if(o==="success"||o==="notmodified"){if(!s){_()}}else{r.handleError(i,w,o,t)}S();if(e==="timeout"){w.abort()}if(i.async){w=null}}};try{var j=w.abort;w.abort=function(){if(w){j.call(w)}y("abort")}}catch(x){}if(i.async&&i.timeout>0){setTimeout(function(){if(w&&!v){y("timeout")}},i.timeout)}try{w.send(c==="POST"||c==="PUT"||c==="DELETE"?i.data:null)}catch(x){r.handleError(i,w,null,x);S()}if(!i.async){y()}function _(){if(i.success){i.success.call(u,l,o,w)}if(i.global){C("ajaxSuccess",[w,i])}}function S(){if(i.complete){i.complete.call(u,w,o)}if(i.global){C("ajaxComplete",[w,i])}if(i.global&&!--r.active){r.event.trigger("ajaxStop")}}function C(e,t){(i.context?r(i.context):r.event).trigger(e,t)}return w},handleError:function(e,t,n,i){if(e.error){e.error.call(e.context||e,t,n,i)}if(e.global){(e.context?r(e.context):r.event).trigger("ajaxError",[t,e,i])}},active:0,httpSuccess:function(e){try{return!e.status&&location.protocol==="file:"||e.status>=200&&e.status<300||e.status===304||e.status===1223||e.status===0}catch(t){}return false},httpNotModified:function(e,t){var n=e.getResponseHeader("Last-Modified"),i=e.getResponseHeader("Etag");if(n){r.lastModified[t]=n}if(i){r.etag[t]=i}return e.status===304||e.status===0},httpData:function(e,t,n){var i=e.getResponseHeader("content-type")||"",a=t==="xml"||!t&&i.indexOf("xml")>=0,s=a?e.responseXML:e.responseText;if(a&&s.documentElement.nodeName==="parsererror"){r.error("parsererror")}if(n&&n.dataFilter){s=n.dataFilter(s,t)}if(typeof s==="string"){if(t==="json"||!t&&i.indexOf("json")>=0){s=r.parseJSON(s)}else if(t==="script"||!t&&i.indexOf("javascript")>=0){r.globalEval(s)}}return s},param:function(e,n){var i=[];if(n===t){n=r.ajaxSettings.traditional}if(r.isArray(e)||e.jquery){r.each(e,function(){o(this.name,this.value)})}else{for(var a in e){s(a,e[a])}}return i.join("&").replace(Je,"+");function s(e,t){if(r.isArray(t)){r.each(t,function(t,i){if(n||/\[\]$/.test(e)){o(e,i)}else{s(e+"["+(typeof i==="object"||r.isArray(i)?t:"")+"]",i)}})}else if(!n&&t!=null&&typeof t==="object"){r.each(t,function(t,r){s(e+"["+t+"]",r)})}else{o(e,t)}}function o(e,t){t=r.isFunction(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)}}});var Be={},$e=/toggle|show|hide/,ze=/^([+-]=)?([\d+-.]+)(.*)$/,Ue,qe=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];r.fn.extend({show:function(e,t){if(e||e===0){return this.animate(We("show",3),e,t)}else{for(var n=0,i=this.length;n<i;n++){var a=r.data(this[n],"olddisplay");this[n].style.display=a||"";if(r.css(this[n],"display")==="none"){var s=this[n].nodeName,o;if(Be[s]){o=Be[s]}else{var l=r("<"+s+" />").appendTo("body");o=l.css("display");if(o==="none"){o="block"}l.remove();Be[s]=o}r.data(this[n],"olddisplay",o)}}for(var u=0,c=this.length;u<c;u++){this[u].style.display=r.data(this[u],"olddisplay")||""}return this}},hide:function(e,t){if(e||e===0){return this.animate(We("hide",3),e,t)}else{for(var n=0,i=this.length;n<i;n++){var a=r.data(this[n],"olddisplay");if(!a&&a!=="none"){r.data(this[n],"olddisplay",r.css(this[n],"display"))}}for(var s=0,o=this.length;s<o;s++){this[s].style.display="none"}return this}},_toggle:r.fn.toggle,toggle:function(e,t){var n=typeof e==="boolean";if(r.isFunction(e)&&r.isFunction(t)){this._toggle.apply(this,arguments)}else if(e==null||n){this.each(function(){var t=n?e:r(this).is(":hidden");r(this)[t?"show":"hide"]()})}else{this.animate(We("toggle",3),e,t)}return this},fadeTo:function(e,t,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,r)},animate:function(e,t,n,i){var a=r.speed(t,n,i);if(r.isEmptyObject(e)){return this.each(a.complete)}return this[a.queue===false?"each":"queue"](function(){var t=r.extend({},a),n,i=this.nodeType===1&&r(this).is(":hidden"),s=this;for(n in e){var o=n.replace(xe,Ne);if(n!==o){e[o]=e[n];delete e[n];n=o}if(e[n]==="hide"&&i||e[n]==="show"&&!i){return t.complete.call(this)}if((n==="height"||n==="width")&&this.style){t.display=r.css(this,"display");t.overflow=this.style.overflow}if(r.isArray(e[n])){(t.specialEasing=t.specialEasing||{})[n]=e[n][1];e[n]=e[n][0]}}if(t.overflow!=null){
this.style.overflow="hidden"}t.curAnim=r.extend({},e);r.each(e,function(n,a){var o=new r.fx(s,t,n);if($e.test(a)){o[a==="toggle"?i?"show":"hide":a](e)}else{var l=ze.exec(a),u=o.cur(true)||0;if(l){var c=parseFloat(l[2]),h=l[3]||"px";if(h!=="px"){s.style[n]=(c||1)+h;u=(c||1)/o.cur(true)*u;s.style[n]=u+h}if(l[1]){c=(l[1]==="-="?-1:1)*c+u}o.custom(u,c,h)}else{o.custom(u,a,"")}}});return true})},stop:function(e,t){var n=r.timers;if(e){this.queue([])}this.each(function(){for(var e=n.length-1;e>=0;e--){if(n[e].elem===this){if(t){n[e](true)}n.splice(e,1)}}});if(!t){this.dequeue()}return this}});r.each({slideDown:We("show",1),slideUp:We("hide",1),slideToggle:We("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(e,t){r.fn[e]=function(e,r){return this.animate(t,e,r)}});r.extend({speed:function(e,t,n){var i=e&&typeof e==="object"?e:{complete:n||!n&&t||r.isFunction(e)&&e,duration:e,easing:n&&t||t&&!r.isFunction(t)&&t};i.duration=r.fx.off?0:typeof i.duration==="number"?i.duration:r.fx.speeds[i.duration]||r.fx.speeds._default;i.old=i.complete;i.complete=function(){if(i.queue!==false){r(this).dequeue()}if(r.isFunction(i.old)){i.old.call(this)}};return i},easing:{linear:function(e,t,r,n){return r+n*e},swing:function(e,t,r,n){return(-Math.cos(e*Math.PI)/2+.5)*n+r}},timers:[],fx:function(e,t,r){this.options=t;this.elem=e;this.prop=r;if(!t.orig){t.orig={}}}});r.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(r.fx.step[this.prop]||r.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(e){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var t=parseFloat(r.css(this.elem,this.prop,e));return t&&t>-1e4?t:parseFloat(r.curCSS(this.elem,this.prop))||0},custom:function(e,t,n){this.startTime=E();this.start=e;this.end=t;this.unit=n||this.unit||"px";this.now=this.start;this.pos=this.state=0;var i=this;function a(e){return i.step(e)}a.elem=this.elem;if(a()&&r.timers.push(a)&&!Ue){Ue=setInterval(r.fx.tick,13)}},show:function(){this.options.orig[this.prop]=r.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());r(this.elem).show()},hide:function(){this.options.orig[this.prop]=r.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(e){var t=E(),n=true;if(e||t>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var i in this.options.curAnim){if(this.options.curAnim[i]!==true){n=false}}if(n){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;var a=r.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(r.css(this.elem,"display")==="none"){this.elem.style.display="block"}}if(this.options.hide){r(this.elem).hide()}if(this.options.hide||this.options.show){for(var s in this.options.curAnim){r.style(this.elem,s,this.options.orig[s])}}this.options.complete.call(this.elem)}return false}else{var o=t-this.startTime;this.state=o/this.options.duration;var l=this.options.specialEasing&&this.options.specialEasing[this.prop];var u=this.options.easing||(r.easing.swing?"swing":"linear");this.pos=r.easing[l||u](this.state,o,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};r.extend(r.fx,{tick:function(){var e=r.timers;for(var t=0;t<e.length;t++){if(!e[t]()){e.splice(t--,1)}}if(!e.length){r.fx.stop()}},stop:function(){clearInterval(Ue);Ue=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){r.style(e.elem,"opacity",e.now)},_default:function(e){if(e.elem.style&&e.elem.style[e.prop]!=null){e.elem.style[e.prop]=(e.prop==="width"||e.prop==="height"?Math.max(0,e.now):e.now)+e.unit}else{e.elem[e.prop]=e.now}}}});if(r.expr&&r.expr.filters){r.expr.filters.animated=function(e){return r.grep(r.timers,function(t){return e===t.elem}).length}}function We(e,t){var n={};r.each(qe.concat.apply([],qe.slice(0,t)),function(){n[this]=e});return n}if("getBoundingClientRect"in a.documentElement){r.fn.offset=function(e){var t=this[0];if(e){return this.each(function(t){r.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return r.offset.bodyOffset(t)}var n=t.getBoundingClientRect(),i=t.ownerDocument,a=i.body,s=i.documentElement,o=s.clientTop||a.clientTop||0,l=s.clientLeft||a.clientLeft||0,u=n.top+(self.pageYOffset||r.support.boxModel&&s.scrollTop||a.scrollTop)-o,c=n.left+(self.pageXOffset||r.support.boxModel&&s.scrollLeft||a.scrollLeft)-l;return{top:u,left:c}}}else{r.fn.offset=function(e){var t=this[0];if(e){return this.each(function(t){r.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return r.offset.bodyOffset(t)}r.offset.initialize();var n=t.offsetParent,i=t,a=t.ownerDocument,s,o=a.documentElement,l=a.body,u=a.defaultView,c=u?u.getComputedStyle(t,null):t.currentStyle,h=t.offsetTop,f=t.offsetLeft;while((t=t.parentNode)&&t!==l&&t!==o){if(r.offset.supportsFixedPosition&&c.position==="fixed"){break}s=u?u.getComputedStyle(t,null):t.currentStyle;h-=t.scrollTop;f-=t.scrollLeft;if(t===n){h+=t.offsetTop;f+=t.offsetLeft;if(r.offset.doesNotAddBorder&&!(r.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(t.nodeName))){h+=parseFloat(s.borderTopWidth)||0;f+=parseFloat(s.borderLeftWidth)||0}i=n,n=t.offsetParent}if(r.offset.subtractsBorderForOverflowNotVisible&&s.overflow!=="visible"){h+=parseFloat(s.borderTopWidth)||0;f+=parseFloat(s.borderLeftWidth)||0}c=s}if(c.position==="relative"||c.position==="static"){h+=l.offsetTop;f+=l.offsetLeft}if(r.offset.supportsFixedPosition&&c.position==="fixed"){h+=Math.max(o.scrollTop,l.scrollTop);f+=Math.max(o.scrollLeft,l.scrollLeft)}return{top:h,left:f}}}r.offset={initialize:function(){var e=a.body,t=a.createElement("div"),n,i,s,o,l=parseFloat(r.curCSS(e,"marginTop",true))||0,u="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";r.extend(t.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});t.innerHTML=u;e.insertBefore(t,e.firstChild);n=t.firstChild;i=n.firstChild;o=n.nextSibling.firstChild.firstChild;this.doesNotAddBorder=i.offsetTop!==5;this.doesAddBorderForTableAndCells=o.offsetTop===5;i.style.position="fixed",i.style.top="20px";this.supportsFixedPosition=i.offsetTop===20||i.offsetTop===15;i.style.position=i.style.top="";n.style.overflow="hidden",n.style.position="relative";this.subtractsBorderForOverflowNotVisible=i.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=e.offsetTop!==l;e.removeChild(t);e=t=n=i=s=o=null;r.offset.initialize=r.noop},bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;r.offset.initialize();if(r.offset.doesNotIncludeMarginInBodyOffset){t+=parseFloat(r.curCSS(e,"marginTop",true))||0;n+=parseFloat(r.curCSS(e,"marginLeft",true))||0}return{top:t,left:n}},setOffset:function(e,t,n){if(/static/.test(r.curCSS(e,"position"))){e.style.position="relative"}var i=r(e),a=i.offset(),s=parseInt(r.curCSS(e,"top",true),10)||0,o=parseInt(r.curCSS(e,"left",true),10)||0;if(r.isFunction(t)){t=t.call(e,n,a)}var l={top:t.top-a.top+s,left:t.left-a.left+o};if("using"in t){t.using.call(e,l)}else{i.css(l)}}};r.fn.extend({position:function(){if(!this[0]){return null}var e=this[0],t=this.offsetParent(),n=this.offset(),i=/^body|html$/i.test(t[0].nodeName)?{top:0,left:0}:t.offset();n.top-=parseFloat(r.curCSS(e,"marginTop",true))||0;n.left-=parseFloat(r.curCSS(e,"marginLeft",true))||0;i.top+=parseFloat(r.curCSS(t[0],"borderTopWidth",true))||0;i.left+=parseFloat(r.curCSS(t[0],"borderLeftWidth",true))||0;return{top:n.top-i.top,left:n.left-i.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||a.body;while(e&&(!/^body|html$/i.test(e.nodeName)&&r.css(e,"position")==="static")){e=e.offsetParent}return e})}});r.each(["Left","Top"],function(e,n){var i="scroll"+n;r.fn[i]=function(n){var a=this[0],s;if(!a){return null}if(n!==t){return this.each(function(){s=He(this);if(s){s.scrollTo(!e?n:r(s).scrollLeft(),e?n:r(s).scrollTop())}else{this[i]=n}})}else{s=He(a);return s?"pageXOffset"in s?s[e?"pageYOffset":"pageXOffset"]:r.support.boxModel&&s.document.documentElement[i]||s.document.body[i]:a[i]}}});function He(e){return"scrollTo"in e&&e.document?e:e.nodeType===9?e.defaultView||e.parentWindow:false}r.each(["Height","Width"],function(e,n){var i=n.toLowerCase();r.fn["inner"+n]=function(){return this[0]?r.css(this[0],i,false,"padding"):null};r.fn["outer"+n]=function(e){return this[0]?r.css(this[0],i,false,e?"margin":"border"):null};r.fn[i]=function(e){var a=this[0];if(!a){return e==null?null:this}if(r.isFunction(e)){return this.each(function(t){var n=r(this);n[i](e.call(this,t,n[i]()))})}return"scrollTo"in a&&a.document?a.document.compatMode==="CSS1Compat"&&a.document.documentElement["client"+n]||a.document.body["client"+n]:a.nodeType===9?Math.max(a.documentElement["client"+n],a.body["scroll"+n],a.documentElement["scroll"+n],a.body["offset"+n],a.documentElement["offset"+n]):e===t?r.css(a,i):this.css(i,typeof e==="string"?e:e+"px")}});e.jQuery=e.$=r})(window);(function(e){e.jStore={Availability:{},Engines:{},Instances:{},CurrentEngine:null,defaults:{project:null,engine:null,autoload:true,flash:"jStore.swf"},isReady:false,isFlashReady:false,delegate:e("<a></a>").bind("jStore-ready",function(t,r){e.jStore.isReady=true;if(e.jStore.defaults.autoload)r.connect()}).bind("flash-ready",function(){e.jStore.isFlashReady=true})};e.jStore.ready=function(t){if(e.jStore.isReady)t({},e.jStore.CurrentEngine);else e.jStore.delegate.bind("jStore-ready",t)};e.jStore.flashReady=function(t){if(e.jStore.isFlashReady)t({},e.jStore.CurrentEngine);else e.jStore.delegate.bind("flash-ready",t)};e.jStore.use=function(t,r,n){r=r||e.jStore.defaults.project||location.hostname.replace(/\./,"-")||"unknown";var i=e.jStore.Engines[t.toLowerCase()]||null,a=(n?n+".":"")+r+"."+t;if(!i)throw"JSTORE_ENGINE_UNDEFINED";i=new i(r,a);if(e.jStore.Instances[a])throw"JSTORE_JRI_CONFLICT";if(i.isAvailable()){e.jStore.Instances[a]=i;if(!e.jStore.CurrentEngine){e.jStore.CurrentEngine=i}e.jStore.delegate.triggerHandler("jStore-ready",[i])}else{if(!i.autoload)throw"JSTORE_ENGINE_UNAVILABLE";else{i.included(function(){if(i.isAvailable()){e.jStore.Instances[a]=i;if(!e.jStore.CurrentEngine){e.jStore.CurrentEngine=i}e.jStore.delegate.triggerHandler("jStore-ready",[i])}else throw"JSTORE_ENGINE_ACTIVATION_FAILURE"}).include()}}};e.jStore.setCurrentEngine=function(t){if(!e.jStore.Instances.length)return e.jStore.FindEngine();if(!t&&e.jStore.Instances.length>=1){e.jStore.delegate.triggerHandler("jStore-ready",[e.jStore.Instances[0]]);return e.jStore.CurrentEngine=e.jStore.Instances[0]}if(t&&e.jStore.Instances[t]){e.jStore.delegate.triggerHandler("jStore-ready",[e.jStore.Instances[t]]);return e.jStore.CurrentEngine=e.jStore.Instances[t]}throw"JSTORE_JRI_NO_MATCH"};e.jStore.FindEngine=function(){e.each(e.jStore.Availability,function(t){if(this()){e.jStore.use(t,e.jStore.defaults.project,"default");return false}})};e.store=function(t,r){if(!e.jStore.CurrentEngine)return false;if(!r)return e.jStore.CurrentEngine.get(t);return e.jStore.CurrentEngine.set(t,r)};e.remove=function(t){if(!e.jStore.CurrentEngine)return false;return e.jStore.CurrentEngine.rem(t)};e.fn.store=function(t,r){if(!e.jStore.CurrentEngine)return this;var n=e.store(t,r);return!r?n:this};e.fn.removeStore=function(t){e.remove(t);return this};e(function(){if(e.jStore.defaults.engine)return e.jStore.use(e.jStore.defaults.engine,e.jStore.defaults.project,"default");var t=e("[engine]:first");if(t.length)return e.jStore.use(t.attr("engine"),t.attr("project"),t.attr("identifier"));try{e.jStore.FindEngine()}catch(r){}})})(jQuery);(function(){var e=false,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(r){var n=this.prototype;e=true;var i=new this;e=false;for(var a in r){i[a]=typeof r[a]=="function"&&typeof n[a]=="function"&&t.test(r[a])?function(e,t){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);this._super=r;return i}}(a,r[a]):r[a]}function s(){if(!e&&this.init)this.init.apply(this,arguments)}s.prototype=i;s.constructor=s;s.extend=arguments.callee;return s}})();(function(e){this.StorageEngine=Class.extend({init:function(t,r){this.project=t;this.jri=r;this.data={};this.limit=-1;this.includes=[];this.delegate=e("<a></a>").bind("engine-ready",function(e,t){t.isReady=true}).bind("engine-included",function(e,t){t.hasIncluded=true});this.autoload=false;this.isReady=false;this.hasIncluded=false},include:function(){var t=this,r=this.includes.length,n=0;e.each(this.includes,function(){e.ajax({type:"get",url:this,dataType:"script",cache:true,success:function(){n++;if(n==r)t.delegate.triggerHandler("engine-included",[t])}})})},isAvailable:function(){return false},ready:function(e){if(this.isReady)e({},this);else this.delegate.bind("engine-ready",e);return this},included:function(e){if(this.hasIncluded)e({},this);else this.delegate.bind("engine-included",e);return this},get:function(e){return this.data[e]||null},set:function(e,t){this.data[e]=t;return t},rem:function(e){var t=this.data[e];this.data[e]=null;return t}})})(jQuery);(function(e){var t=e.jStore.Availability.session=function(){return!!window.sessionStorage},r=e.jStore.Availability.local=function(){return!!(window.localStorage||window.globalStorage)};this.jStoreDom=StorageEngine.extend({init:function(e,t){this._super(e,t);this.type="DOM";this.limit=5*1024*1024},connect:function(){this.delegate.triggerHandler("engine-ready",[this])},get:function(e){var t=this.db.getItem(e);return t&&t.value?t.value:t},set:function(e,t){this.db.setItem(e,t);return t},rem:function(e){var t=this.get(e);this.db.removeItem(e);return t}});this.jStoreLocal=jStoreDom.extend({connect:function(){this.db=!window.globalStorage?window.localStorage:window.globalStorage[location.hostname];this._super()},isAvailable:r});this.jStoreSession=jStoreDom.extend({connect:function(){this.db=sessionStorage;this._super()},isAvailable:t});e.jStore.Engines.local=jStoreLocal;e.jStore.Engines.session=jStoreSession})(jQuery);(function(e){var t=e.jStore.Availability.flash=function(){return!!(window.swfobject&&jQuery.hasFlash("8.0.0"))};this.jStoreFlash=StorageEngine.extend({init:function(t,r){this._super(t,r);this.type="Flash";var n=this;e.jStore.flashReady(function(){n.flashReady()})},connect:function(){var t="jstore-flash-"+this.project;e("<div></div>").css({position:"absolute",left:-1e5}).attr("id",t).appendTo(document.body).flash({src:e.jStore.defaults.flash,width:1,height:1},{version:"8.0.0"})},flashReady:function(t){this.db=e("embed","#jstore-flash-"+this.project)[0];this.delegate.triggerHandler("engine-ready",[this])},isAvailable:t,get:function(e){var t=this.db.f_get_cookie(e);return t=="null"?null:t},set:function(e,t){this.db.f_set_cookie(e,t);return t},rem:function(e){var t=this.get(e);this.db.f_delete_cookie(e);return t}});e.jStore.Engines.flash=jStoreFlash})(jQuery);function flash_ready(){$.jStore.delegate.triggerHandler("flash-ready")}(function(){var e;e=jQuery.fn.flash=function(t,r,n,i){var a=n||e.replace;r=e.copy(e.pluginOptions,r);if(!e.hasFlash(r.version)){if(r.expressInstall&&e.hasFlash(6,0,65)){var s={flashvars:{MMredirectURL:location,MMplayerType:"PlugIn",MMdoctitle:jQuery("title").text()}}}else{if(r.update){a=i||e.update}else{return this}}}t=e.copy(e.htmlOptions,s,t);return this.each(function(){a.call(this,e.copy(t))})};e.copy=function(){var e={},t={};for(var r=0;r<arguments.length;r++){var n=arguments[r];if(n==undefined){continue}jQuery.extend(e,n);if(n.flashvars==undefined){continue}jQuery.extend(t,n.flashvars)}e.flashvars=t;return e};jQuery.hasFlash=e.hasFlash=function(){if(/hasFlash\=true/.test(location)){return true}if(/hasFlash\=false/.test(location)){return false}var t=e.hasFlash.playerVersion().match(/\d+/g);var r=String([arguments[0],arguments[1],arguments[2]]).match(/\d+/g)||String(e.pluginOptions.version).match(/\d+/g);for(var n=0;n<3;n++){t[n]=parseInt(t[n]||0);r[n]=parseInt(r[n]||0);if(t[n]<r[n]){return false}if(t[n]>r[n]){return true}}return true};e.hasFlash.playerVersion=function(){try{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(t){return"6,0,0"}}catch(t){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(t){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}}catch(t){}}return"0,0,0"};e.htmlOptions={height:240,flashvars:{},pluginspage:"http://www.adobe.com/go/getflashplayer",src:"#",type:"application/x-shockwave-flash",width:320};e.pluginOptions={expressInstall:false,update:true,version:"6.0.65"};e.replace=function(t){this.innerHTML='<div class="alt">'+this.innerHTML+"</div>";jQuery(this).addClass("flash-replaced").prepend(e.transform(t))};e.update=function(e){var t=String(location).split("?");t.splice(1,0,"?hasFlash=true&");t=t.join("");var r='<p>This content requires the Flash Player. <a href="http://www.adobe.com/go/getflashplayer">Download Flash Player</a>. Already have Flash Player? <a href="'+t+'">Click here.</a></p>';this.innerHTML='<span class="alt">'+this.innerHTML+"</span>";jQuery(this).addClass("flash-update").prepend(r)};function t(){var e="";for(var t in this){if(typeof this[t]!="function"){e+=t+'="'+this[t]+'" '}}return e}function r(){var e="";for(var t in this){if(typeof this[t]!="function"){e+=t+"="+encodeURIComponent(this[t])+"&"}}return e.replace(/&$/,"")}e.transform=function(e){e.toString=t;if(e.flashvars){e.flashvars.toString=r}return"<embed "+String(e)+"/>"};if(window.attachEvent){window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){}})}})();(function(e){var t=e.jStore.Availability.gears=function(){return!!(window.google&&window.google.gears)};this.jStoreGears=StorageEngine.extend({init:function(e,t){this._super(e,t);this.type="Google Gears";this.includes.push("http://code.google.com/apis/gears/gears_init.js");this.autoload=true},connect:function(){var e=this.db=google.gears.factory.create("beta.database");e.open("jstore-"+this.project);e.execute("CREATE TABLE IF NOT EXISTS jstore (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)");this.updateCache()},updateCache:function(){var e=this.db.execute("SELECT k,v FROM jstore");while(e.isValidRow()){this.data[e.field(0)]=e.field(1);e.next()}e.close();this.delegate.triggerHandler("engine-ready",[this])},isAvailable:t,set:function(e,t){var r=this.db;r.execute("BEGIN");r.execute("INSERT OR REPLACE INTO jstore(k, v) VALUES (?, ?)",[e,t]);r.execute("COMMIT");return this._super(e,t)},rem:function(e){var t=this.db;t.execute("BEGIN");t.execute("DELETE FROM jstore WHERE k = ?",[e]);t.execute("COMMIT");return this._super(e)}});e.jStore.Engines.gears=jStoreGears})(jQuery);(function(e){var t=e.jStore.Availability.html5=function(){return!!window.openDatabase};this.jStoreHtml5=StorageEngine.extend({init:function(e,t){this._super(e,t);this.type="HTML5";this.limit=1024*200},connect:function(){var e=this.db=openDatabase("jstore-"+this.project,"1.0",this.project,this.limit);if(!e)throw"JSTORE_ENGINE_HTML5_NODB";e.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS jstore (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)")});this.updateCache()},updateCache:function(){var e=this;this.db.transaction(function(t){t.executeSql("SELECT k,v FROM jstore",[],function(t,r){rows=r.rows;for(var n=0;n<rows.length;++n){var i=rows.item(n);e.data[i.k]=i.v}e.delegate.triggerHandler("engine-ready",[e])})})},isAvailable:t,set:function(e,t){this.db.transaction(function(r){r.executeSql("INSERT OR REPLACE INTO jstore(k, v) VALUES (?, ?)",[e,t])});return this._super(e,t)},rem:function(e){this.db.transaction(function(t){t.executeSql("DELETE FROM jstore WHERE k = ?",[e])});return this._super(e)}});e.jStore.Engines.html5=jStoreHtml5})(jQuery);(function(e){var t=e.jStore.Availability.ie=function(){return!!window.ActiveXObject};this.jStoreIE=StorageEngine.extend({init:function(e,t){this._super(e,t);this.type="IE";this.limit=64*1024},connect:function(){this.db=e('<div style="display:none;behavior:url(\'#default#userData\')" id="jstore-'+this.project+'"></div>').appendTo(document.body).get(0);this.delegate.triggerHandler("engine-ready",[this])},isAvailable:t,get:function(e){this.db.load(this.project);return this.db.getAttribute(e)},set:function(e,t){this.db.setAttribute(e,t);this.db.save(this.project);return t},rem:function(e){var t=this.get(e);this.db.removeAttribute(e);this.db.save(this.project);return t}});e.jStore.Engines.ie=jStoreIE})(jQuery);(function(){if("jabberwerx"in window){return}var e;e={version:"2.1.1.19913",_config:{persistDuration:30,unsecureAllowed:false,capabilityFeatures:[],httpBindingURL:"/httpbinding",baseReconnectCountdown:30,enabledMechanisms:["DIGEST-MD5","PLAIN"]},getInstallURL:function(){return this.getInstallPath()},getInstallPath:function(){var t=this._config.installPath;if(!t){var r=String(arguments[0]||"jabberwerx")+".js";t=e.$("script[src$="+r+"]").slice(0,1).attr("src");t=t.substring(0,t.indexOf(r))}return t.charAt(t.length-1)=="/"?t:t+"/"},parseTimestamp:function(e){var t=/^([0-9]{4})(?:-?)([0-9]{2})(?:-?)([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2}(?:\.([0-9]+))?)(?:(Z|[-+]?[0-9]{2}:[0-9]{2})?)$/.exec(e);if(!t){throw new TypeError("timestamp string not recognized")}var r,n=0;r=Date.UTC(Number(t[1]),Number(t[2])-1,Number(t[3]),Number(t[4]),Number(t[5]),Number(t[6]),Number(t[7]||"0"));if(t[8]&&t[8]!="Z"){t=/^([-+]?[0-9]{2}):([0-9]{2})$/.exec(t[8]);if(t){n+=Number(t[1])*36e5;n+=Number(t[2])*6e4}}return new Date(r-n)},generateTimestamp:function(e,t){var r=function(e,t){var r="";if(t>1){r=arguments.callee(parseInt(e/10),t-1)}return r+String(parseInt(e%10))};if(!(e&&e instanceof Date)){throw new TypeError("Expected Date object")}var n=[r(e.getUTCFullYear(),4),r(e.getUTCMonth()+1,2),r(e.getUTCDate(),2)];var i=[r(e.getUTCHours(),2),r(e.getUTCMinutes(),2),r(e.getUTCSeconds(),2)];if(t){return n.join("")+"T"+i.join(":")}else{return n.join("-")+"T"+i.join(":")+"Z"}},_init:function(){this._inited=true;if(typeof jabberwerx_config!="undefined"){for(var t in jabberwerx_config){var r=jabberwerx_config[t];if(e.$.isArray(r)&&r.concat){r=r.concat()}this._config[t]=r}}e.InsufficientServerDetailsError=e.util.Error.extend("A server name and HTTP proxy address are needed to connect.");e.$(document).ready(function(){if(!e.$.jStore.isReady){e.$.jStore.ready(window.jabberwerx._handleStorageReady)}else{window.jabberwerx._handleStorageReady(null,e.$.jStore.CurrentEngine)}})},_handleStorageReady:function(e,t){if(this._storageReady){return}if(t&&!t.isReady){t.ready(this._handleStorageReady)}this._storageReady=true;if(!this._deferredCalls){this._deferredCalls=[]}for(var r=0;r<this._deferredCalls.length;r++){var n=this._deferredCalls[r];var i=n.target||this;i[n.methodName].apply(i,n.arguments)}this._deferredCalls=[]},reset:function(){if(this.client){this.client.disconnect()}if(e._config.persistSessions){e.util.clearGraph()}},reduce:function(t,r,n){if(!e.$.isFunction(r)){throw new TypeError("expected function object")}e.$.each(t,function(e,t){n=r(t,n);return true});return n},unique:function(t){if(!e.$.isArray(t)){return t}var r={};for(var n=t.length-1;n>=0;n--){var i=t[n];if(!r[i]){r[i]=true}else{t.splice(n,1)}}return t},isText:function(e){return e&&e.ownerDocument&&e.nodeType==3&&typeof e.nodeName=="string"},isElement:function(e){return e&&e.ownerDocument!==undefined&&e.nodeType==1&&typeof e.nodeName=="string"},isDocument:function(e){return e&&e.documentElement!==undefined&&e.nodeType==9&&typeof e.nodeName=="string"},client:null,_inited:false,_deferredCalls:[],_storageReady:false};e._config.debug={on:true};e.NodeBuilder=function(t){var r,n,i=null;if(t instanceof e.NodeBuilder){this.parent=r=arguments[0];t=arguments[1];n=r.document;i=r.namespaceURI}if(e.isDocument(t)){n=t;t=n.documentElement;i=t.namespaceURI||t.getAttribute("xmlns")||i}else if(e.isElement(t)){if(!n){n=t.ownerDocument}else if(t.ownerDocument!==n){t=n.importNode?n.importNode(t,true):t.cloneNode(true)}if(r&&r.data){r.data.appendChild(t)}if(!n.documentElement){n.appendChild(t)}i=t.namespaceURI||t.getAttribute("xmlns")||i}else if(t){if(!n){n=this._createDoc()}var a,s,o;a=this._parseName(t,i);i=a.namespaceURI;t=this._createElem(n,i,a.localName,a.prefix)}else if(!r){n=this._createDoc()}this.document=n;this.data=t;this.namespaceURI=i};e.NodeBuilder.prototype={attribute:function(e,t){var r=this._parseName(e);if(r.prefix&&r.prefix!="xml"&&r.prefix!="xmlns"){var n="xmlns:"+r.prefix;if(this.data.getAttribute(n)===null){this.data.setAttribute(n,r.namespaceURI||"")}}else if(r.prefix!="xml"&&r.prefix!="xmlns"&&r.namespaceURI!==null){throw new TypeError("namespaced attributes not supported")}this.data.setAttribute(r.qualifiedName,t);return this},text:function(e){if(!e){return this}var t=this.document.createTextNode(e);this.data.appendChild(t);return this},element:function(t,r){if(!r){r={}}if(typeof t!="string"){throw new TypeError("name is not a valid expanded name")}var n=new e.NodeBuilder(this,t);for(var i in r){if(i=="xmlns"){continue}n.attribute(i,r[i])}return n},node:function(t){if(!t){throw new TypeError("node must exist")}if(e.isDocument(t)){t=t.documentElement}if(e.isElement(t)){return new e.NodeBuilder(this,t)}else if(e.isText(t)){return this.text(t.nodeValue)}else{throw new TypeError("Node must be an XML node")}return this},xml:function(t){var r=this.namespaceURI?"<wrapper xmlns='"+this.namespaceURI+"'>":"<wrapper>";r+=t+"</wrapper>";var n=this._parseXML(r);var i=this;e.$(n).contents().each(function(){if(e.isElement(this)){new e.NodeBuilder(i,this)}else if(e.isText(this)){i.text(this.nodeValue)}});return this},_parseName:function(e,t){var r=/^(?:\{(.*)\})?(?:([^\s{}:]+):)?([^\s{}:]+)$/;var n=e.match(r);if(!n){throw new TypeError("name '"+e+"' is not a valid ename")}var i={namespaceURI:n[1],localName:n[3],prefix:n[2]};if(!i.localName){throw new TypeError("local-name not value")}i.qualifiedName=i.prefix?i.prefix+":"+i.localName:i.localName;if(!i.namespaceURI){if(e.indexOf("{}")==0){i.namespaceURI=""}else{i.namespaceURI=t||null}}return i},_createDoc:function(){var t;try{if(document.implementation&&document.implementation.createDocument){t=document.implementation.createDocument(null,null,null)}else{t=new ActiveXObject("Msxml2.DOMDocument");t.async=false}}catch(r){e.util.debug.log("could not create XML Document: "+r);throw r}return t},_parseXML:function(t){var r;try{r=this._createDoc();r.loadXML(t)}catch(n){try{r=(new DOMParser).parseFromString(t,"text/xml")}catch(n){e.util.debug.log("exception: "+n+" trying to parse xml: '"+t+"'");throw new TypeError("Exception trying to parse xml: '"+t+"'")}}var i=r.documentElement;if(!i||i.nodeName=="parsererror"||e.$("parsererror",i).length>0){e.util.debug.log("parse error trying to parse xml: '"+t+"'");throw new TypeError("Parse error trying to parse: "+t)}return i},_createElem:function(e,t,r,n){var i=this.parent;var a;var s=n?n+":"+r:r;var o;if(n){o="xmlns:"+n+"='"+(t||"")+"'"}else{o=t!==undefined&&t!==null?"xmlns='"+t+"'":""}o="<"+s+" "+o+"/>";a=this._parseXML(o);if(e.importNode){a=e.importNode(a,true)}if(i&&i.data){if(i.namespaceURI==t){a.removeAttribute("xmlns")}i.data.appendChild(a)}else if(!e.documentElement){e.appendChild(a)}return a}};e.xhtmlim={};e.xhtmlim.allowedStyles=["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"];e.xhtmlim.allowedTags={br:[],em:[],strong:[],a:["style","href","type"],blockquote:["style"],cite:["style"],img:["style","alt","height","src","width"],li:["style"],ol:["style"],p:["style"],span:["style"],ul:["style"],body:["style","xmlns","xml:lang"]};e.xhtmlim.sanitize=function(t){var r=function(t){var n=t.children();var i=t.get(0);if(e.xhtmlim.allowedTags[i.nodeName]===undefined){t.replaceWith(i.childNodes);t.remove()}else{var a=0;while(a<i.attributes.length){var s=i.attributes[a].nodeName;if(e.$.inArray(s,e.xhtmlim.allowedTags[i.nodeName])==-1){t.removeAttr(s)}else{if(s=="href"||s=="src"){var o=i.attributes[a].nodeValue;if(o.indexOf("javascript:")==0){t.replaceWith(i.childNodes);t.remove()}}else if(s=="style"){var l=e.$.map(i.attributes[a].value.split(";"),function(t,r){return e.$.inArray(t.split(":")[0],e.xhtmlim.allowedStyles)!=-1?t:null});t.attr("style",l.join(";"))}++a}}}for(var a=0;a<n.length;++a){if(e.isElement(n[a])){r(e.$(n[a]))}}};if(!e.isElement(t)){throw new TypeError("xhtmlNode must be a DOM")}if(e.xhtmlim.allowedTags[t.nodeName]===undefined){throw new TypeError("xhtmlNode must be an allowed tag")}r(e.$(t));return t};e.$=jQuery.noConflict(true);window.jabberwerx=e;e.$(document).ready(function(){e._init()})})();if(window.jabberwerx){window.jabberwerx.util=window.jabberwerx.util||{};window.jabberwerx.util.crypto=window.jabberwerx.util.crypto||{};jabberwerx.util.crypto.b64Encode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var r="";for(var n=0;n<e.length;n+=3){var i=e.charCodeAt(n)<<16|e.charCodeAt(n+1)<<8|e.charCodeAt(n+2);r+=t.charAt(i>>>18&63)+t.charAt(i>>>12&63);r+=n+1<e.length?t.charAt(i>>>6&63):"=";r+=n+2<e.length?t.charAt(i&63):"="}return r};jabberwerx.util.crypto.b64Decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var r="";for(var n=0;n<e.length;n+=4){var i=[t.indexOf(e.charAt(n)),t.indexOf(e.charAt(n+1)),t.indexOf(e.charAt(n+2)),t.indexOf(e.charAt(n+3))];var a=i[0]<<18|i[1]<<12|i[2]<<6|i[3];if(e.charAt(n+2)=="="){a=String.fromCharCode(a>>>16&255)}else if(e.charAt(n+3)=="="){a=String.fromCharCode(a>>>16&255,a>>>8&255)}else{a=String.fromCharCode(a>>>16&255,a>>>8&255,a&255)}r+=a}return r};jabberwerx.util.crypto.utf8Encode=function(e){var t="";var r=-1;var n,i;while(++r<e.length){n=e.charCodeAt(r);i=r+1<e.length?e.charCodeAt(r+1):0;if(55296<=n&&n<=56319&&56320<=i&&i<=57343){n=65536+((n&1023)<<10)+(i&1023);r++}if(n<=127)t+=String.fromCharCode(n);else if(n<=2047)t+=String.fromCharCode(192|n>>>6&31,128|n&63);else if(n<=65535)t+=String.fromCharCode(224|n>>>12&15,128|n>>>6&63,128|n&63);else if(n<=2097151)t+=String.fromCharCode(240|n>>>18&7,128|n>>>12&63,128|n>>>6&63,128|n&63)}return t};jabberwerx.util.crypto.utf8Decode=function(e){var t="";for(idx=0;idx<e.length;idx++){var r=[e.charCodeAt(idx),e.charCodeAt(idx+1),e.charCodeAt(idx+2)];var n;if(r[0]<128){n=r[0]}else if(r[0]>191&&r[0]<224){n=(r[0]&31)<<6|r[1]&63;idx+=1}else{n=(r[0]&15)<<12|(r[1]&31)<<6|r[2]&63;idx+=2}t+=String.fromCharCode(n)}return t};jabberwerx.util.crypto.str2hex=function(e,t){var r=t?"0123456789ABCDEF":"0123456789abcdef";var n="";var i;for(var a=0;a<e.length;a++){i=e.charCodeAt(a);n+=r.charAt(i>>>4&15)+r.charAt(i&15)}return n};jabberwerx.util.crypto.b64_sha1=function(e){return jabberwerx.util.crypto.b64Encode(jabberwerx.util.crypto.str_sha1(e))};jabberwerx.util.crypto.str_sha1=function(e){var t=function(e){var t=Array(e.length>>2);for(var r=0;r<t.length;r++)t[r]=0;for(var r=0;r<e.length*8;r+=8)t[r>>5]|=(e.charCodeAt(r/8)&255)<<24-r%32;return t};var r=function(e){var t="";for(var r=0;r<e.length*32;r+=8){t+=String.fromCharCode(e[r>>5]>>>24-r%32&255)}return t};var n=function(e,t){var r=(e&65535)+(t&65535);var n=(e>>16)+(t>>16)+(r>>16);return n<<16|r&65535};var i=function(e,t){return e<<t|e>>>32-t};var a=function(e,t,r,n){if(e<20)return t&r|~t&n;
if(e<40)return t^r^n;if(e<60)return t&r|t&n|r&n;return t^r^n};var s=function(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514};var o=function(e,t){e[t>>5]|=128<<24-t%32;e[(t+64>>9<<4)+15]=t;var r=Array(80);var o=1732584193;var l=-271733879;var u=-1732584194;var c=271733878;var h=-1009589776;for(var f=0;f<e.length;f+=16){var d=o;var b=l;var p=u;var m=c;var g=h;for(var v=0;v<80;v++){if(v<16){r[v]=e[f+v]}else{r[v]=i(r[v-3]^r[v-8]^r[v-14]^r[v-16],1)}var w=n(n(i(o,5),a(v,l,u,c)),n(n(h,r[v]),s(v)));h=c;c=u;u=i(l,30);l=o;o=w}o=n(o,d);l=n(l,b);u=n(u,p);c=n(c,m);h=n(h,g)}return Array(o,l,u,c,h)};return r(o(t(e),e.length*8))};jabberwerx.util.crypto.hex_md5=function(e){return jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(e))};jabberwerx.util.crypto.rstr_md5=function(e){function t(e,t,r,n,i,a){return s(o(s(s(t,e),s(n,a)),i),r)}function r(e,r,n,i,a,s,o){return t(r&n|~r&i,e,r,a,s,o)}function n(e,r,n,i,a,s,o){return t(r&i|n&~i,e,r,a,s,o)}function i(e,r,n,i,a,s,o){return t(r^n^i,e,r,a,s,o)}function a(e,r,n,i,a,s,o){return t(n^(r|~i),e,r,a,s,o)}var s=function(e,t){var r=(e&65535)+(t&65535);var n=(e>>16)+(t>>16)+(r>>16);return n<<16|r&65535};var o=function(e,t){return e<<t|e>>>32-t};var l=function(e){var t=Array(e.length>>2);for(var r=0;r<t.length;r++){t[r]=0}for(var r=0;r<e.length*8;r+=8){t[r>>5]|=(e.charCodeAt(r/8)&255)<<r%32}return t};var u=function(e){var t="";for(var r=0;r<e.length*32;r+=8){t+=String.fromCharCode(e[r>>5]>>>r%32&255)}return t};var c=function(e,t){e[t>>5]|=128<<t%32;e[(t+64>>>9<<4)+14]=t;var o=1732584193;var l=-271733879;var u=-1732584194;var c=271733878;for(var h=0;h<e.length;h+=16){var f=o;var d=l;var b=u;var p=c;o=r(o,l,u,c,e[h+0],7,-680876936);c=r(c,o,l,u,e[h+1],12,-389564586);u=r(u,c,o,l,e[h+2],17,606105819);l=r(l,u,c,o,e[h+3],22,-1044525330);o=r(o,l,u,c,e[h+4],7,-176418897);c=r(c,o,l,u,e[h+5],12,1200080426);u=r(u,c,o,l,e[h+6],17,-1473231341);l=r(l,u,c,o,e[h+7],22,-45705983);o=r(o,l,u,c,e[h+8],7,1770035416);c=r(c,o,l,u,e[h+9],12,-1958414417);u=r(u,c,o,l,e[h+10],17,-42063);l=r(l,u,c,o,e[h+11],22,-1990404162);o=r(o,l,u,c,e[h+12],7,1804603682);c=r(c,o,l,u,e[h+13],12,-40341101);u=r(u,c,o,l,e[h+14],17,-1502002290);l=r(l,u,c,o,e[h+15],22,1236535329);o=n(o,l,u,c,e[h+1],5,-165796510);c=n(c,o,l,u,e[h+6],9,-1069501632);u=n(u,c,o,l,e[h+11],14,643717713);l=n(l,u,c,o,e[h+0],20,-373897302);o=n(o,l,u,c,e[h+5],5,-701558691);c=n(c,o,l,u,e[h+10],9,38016083);u=n(u,c,o,l,e[h+15],14,-660478335);l=n(l,u,c,o,e[h+4],20,-405537848);o=n(o,l,u,c,e[h+9],5,568446438);c=n(c,o,l,u,e[h+14],9,-1019803690);u=n(u,c,o,l,e[h+3],14,-187363961);l=n(l,u,c,o,e[h+8],20,1163531501);o=n(o,l,u,c,e[h+13],5,-1444681467);c=n(c,o,l,u,e[h+2],9,-51403784);u=n(u,c,o,l,e[h+7],14,1735328473);l=n(l,u,c,o,e[h+12],20,-1926607734);o=i(o,l,u,c,e[h+5],4,-378558);c=i(c,o,l,u,e[h+8],11,-2022574463);u=i(u,c,o,l,e[h+11],16,1839030562);l=i(l,u,c,o,e[h+14],23,-35309556);o=i(o,l,u,c,e[h+1],4,-1530992060);c=i(c,o,l,u,e[h+4],11,1272893353);u=i(u,c,o,l,e[h+7],16,-155497632);l=i(l,u,c,o,e[h+10],23,-1094730640);o=i(o,l,u,c,e[h+13],4,681279174);c=i(c,o,l,u,e[h+0],11,-358537222);u=i(u,c,o,l,e[h+3],16,-722521979);l=i(l,u,c,o,e[h+6],23,76029189);o=i(o,l,u,c,e[h+9],4,-640364487);c=i(c,o,l,u,e[h+12],11,-421815835);u=i(u,c,o,l,e[h+15],16,530742520);l=i(l,u,c,o,e[h+2],23,-995338651);o=a(o,l,u,c,e[h+0],6,-198630844);c=a(c,o,l,u,e[h+7],10,1126891415);u=a(u,c,o,l,e[h+14],15,-1416354905);l=a(l,u,c,o,e[h+5],21,-57434055);o=a(o,l,u,c,e[h+12],6,1700485571);c=a(c,o,l,u,e[h+3],10,-1894986606);u=a(u,c,o,l,e[h+10],15,-1051523);l=a(l,u,c,o,e[h+1],21,-2054922799);o=a(o,l,u,c,e[h+8],6,1873313359);c=a(c,o,l,u,e[h+15],10,-30611744);u=a(u,c,o,l,e[h+6],15,-1560198380);l=a(l,u,c,o,e[h+13],21,1309151649);o=a(o,l,u,c,e[h+4],6,-145523070);c=a(c,o,l,u,e[h+11],10,-1120210379);u=a(u,c,o,l,e[h+2],15,718787259);l=a(l,u,c,o,e[h+9],21,-343485551);o=s(o,f);l=s(l,d);u=s(u,b);c=s(c,p)}return Array(o,l,u,c)};return u(c(l(e),e.length*8))};jabberwerx.util.crypto.generateUUID=function(){var e=[];for(var t=0;t<16;t++){e[t]=Math.floor(Math.random()*256)}e[6]=e[6]&15|64;e[8]=e[8]&63|128;var r="";for(var t=0;t<e.length;t++){var n=e[t];if(t==4||t==6||t==8||t==10){r+="-"}r+=(n>>>4&15).toString(16);r+=(n&15).toString(16)}return r}}if(jabberwerx){if(!jabberwerx.util){jabberwerx.util={}}jabberwerx.util.config={maxGraphAge:30};jabberwerx.util._markGraph=function(e,t){if(jabberwerx.util._graphRegistry){if(t&&(!t.shouldBeSerializedInline||!t.shouldBeSerializedInline())){jabberwerx.util._graphRegistry[e]={timestamp:new Date,value:t,graph:jabberwerx.util.findReachableGUIDs(t)}}else{delete jabberwerx.util._graphRegistry[e]}}};if(jabberwerx){(function(){var e=false;jabberwerx.JWBase=function(){};jabberwerx.JWBase.prototype.init=function(){};jabberwerx.JWBase.prototype.destroy=function(){return null};jabberwerx.JWBase.prototype.getClassName=function(){return this._className||""};jabberwerx.JWBase.prototype.toString=function(){return"["+this.getClassName()+"]"};jabberwerx.JWBase.prototype.shouldBeSavedWithGraph=function(){return false};jabberwerx.JWBase.prototype.shouldBeSerializedInline=function(){return false};jabberwerx.JWBase.prototype.willBeSerialized=function(){};jabberwerx.JWBase.prototype.wasUnserialized=function(){jabberwerx.$.each(this._observerInfo,function(e,t){t.observers=jabberwerx.$.grep(t.observers,function(e,t){return typeof e.target!="undefined"})})};jabberwerx.JWBase.prototype.graphUnserialized=function(){};jabberwerx.JWBase.prototype.invocation=function(e,t){return jabberwerx.util.generateInvocation(this,e,t)};var t=function(e,t){if(e!==undefined&&t===undefined){return e}if(!jabberwerx.$.isFunction(e)||!jabberwerx.$.isFunction(t)){return t}return function(){var r=this._super;this._super=e;var n=t.apply(this,arguments);this._super=r;return n}};jabberwerx.JWBase.mixin=function(e){e=jabberwerx.$.extend(true,{},e);for(var r in e){this.prototype[r]=t(e[r],this.prototype[r])}};jabberwerx.JWBase.extend=function(r,n){var i=this.prototype;e=true;var a=new this;e=false;for(var s in r){a[s]=t(i[s],r[s])}var o=jabberwerx.$.extend({},this);function l(){if(!e){if(arguments.length==2&&typeof arguments[0]=="string"&&arguments[0]=="__jw_rehydrate__"){var t=arguments[1];for(var r in t){this[r]=t[r]}}else{this._guid=jabberwerx.util.newObjectGUID(n||"");this._jwobj_=true;this._className=typeof n=="undefined"?null:n;this._observerInfo={};for(var r in this){if(typeof this[r]!="function"){this[r]=jabberwerx.util.clone(this[r])}}if(this.init){this.init.apply(this,arguments)}}}}for(var s in o){l[s]=o[s]}l.prototype=a;a.constructor=l;return l}})()}jabberwerx.util.Error=function(e){this.message=e};jabberwerx.util.Error.prototype=new jabberwerx.util.Error;jabberwerx.util.Error.extend=function(e,t){var r=function(e,t){this.message=e||this.message;for(var r in t){this[r]=t[r]}};r.prototype=new this(e);for(var n in t){r.prototype[n]=t[n]}return r};jabberwerx.util.NotSupportedError=jabberwerx.util.Error.extend("This operation is not supported");jabberwerx.util._invocations={};jabberwerx.util.generateInvocation=function(e,t,r){var n="_global_";if(jabberwerx.util.isJWObjRef(e)){n=e._guid}var i=jabberwerx.util._invocations[n+"."+t];if(typeof i!="undefined"){return i}if(typeof r!="undefined"){if(typeof r!="object"||!(r instanceof Array)){r=[r]}}else{r=[]}var i=function(){return jabberwerx.util.invoke.apply(arguments.callee,[arguments.callee].concat(r,Array.prototype.slice.call(arguments)))};i.object=e;i.methodName=t;i._jwinvocation_=true;jabberwerx.util._invocations[n+"."+t]=i;return i};jabberwerx.util.invoke=function(){var e=arguments[0];var t=Array.prototype.slice.call(arguments,1);if(typeof e.object=="undefined"||!e.object){return window[e.methodName].apply(window,t)}else{return e.object[e.methodName].apply(e.object,t)}};jabberwerx.util.eventNames=["jw_valueChanged","jw_collectionChanged"];jabberwerx.util.registerEventName=function(e){if(jabberwerx.util.eventNames.indexOf(e)==-1){jabberwerx.util.eventNames.push(e)}else{throw new jabberwerx.util.EventNameAlreadyRegisteredError("JW event name "+e+" already registered!")}};jabberwerx.util.EventNameAlreadyRegisteredError=jabberwerx.util.Error.extend("That event name is already registered!");jabberwerx.util._objectUIDCounter=0;jabberwerx.util.newObjectGUID=function(e){jabberwerx.util._objectUIDCounter=jabberwerx.util._objectUIDCounter+1==Number.MAX_VALUE?0:jabberwerx.util._objectUIDCounter+1;return"_jwobj_"+e.replace(/\./g,"_")+"_"+((new Date).valueOf()+jabberwerx.util._objectUIDCounter).toString()};jabberwerx.util._escapeString=function(e){return('"'+e.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};jabberwerx.util.isString=function(e){return!!arguments.length&&e!=null&&(typeof e=="string"||e instanceof String)};jabberwerx.util.isArray=function(e){return e&&(e instanceof Array||typeof e=="array")};jabberwerx.util._getParts=function(e,t,r){return[jabberwerx.util.isString(e)?e.split(""):e,t||window,jabberwerx.util.isString(r)?new Function("item","index","array",r):r]};jabberwerx.util.map=function(e,t,r){var n=jabberwerx.util._getParts(e,r,t);e=n[0];var i=arguments[3]?new arguments[3]:[];for(var a=0;a<e.length;++a){i.push(n[2].call(n[1],e[a],a,e))}return i};jabberwerx.util.serialize=function(e,t,r){var n=function(e,t,r){if(e===undefined){return"undefined"}var n=typeof e;if(n=="number"||n=="boolean"){return e+""}if(e===null){return"null"}if(jabberwerx.util.isString(e)){return jabberwerx.util._escapeString(e)}if(typeof e.nodeType=="number"&&typeof e.cloneNode=="function"){return"{}"}var i=arguments.callee;var a;r=r||"";var s=t?r+"	":"";if(typeof e.__json__=="function"){a=e.__json__();if(e!==a){return i(a,t,s)}}if(typeof e.json=="function"){a=e.json();if(e!==a){return i(a,t,s)}}var o=t?" ":"";var l=t?"\n":"";var u;if(jabberwerx.util.isArray(e)){var c=jabberwerx.util.map(e,function(e){if(jabberwerx.util.isJWObjRef(e)){u=jabberwerx.util._escapeString(e._guid)}else{u=i(e,t,s)}if(typeof u!="string"){u="undefined"}return l+s+u});return"["+c.join(","+o)+l+r+"]"}if(n=="function"){if(jabberwerx.util.isJWInvocation(e)){return i({object:e.object,methodName:e.methodName,_jwinvocation_:true},t,s)}else{return null}}var h=[];if(!("responseText"in e)&&!("responseXML"in e)){try{for(var f in e){break}}catch(d){return"null"}for(var f in e){var b;if(typeof f=="number"){b='"'+f+'"'}else if(typeof f=="string"){b=jabberwerx.util._escapeString(f)}else{continue}if(jabberwerx.util.isJWObjRef(e[f])){if(!e[f].shouldBeSerializedInline||!e[f].shouldBeSerializedInline()){u=jabberwerx.util._escapeString(e[f]._guid)}else{if(e[f].willBeSerialized){e[f].willBeSerialized()}u=i(e[f],t,s)}}else{u=i(e[f],t,s)}if(typeof u!="string"){continue}h.push(l+s+b+":"+o+u)}}return"{"+h.join(","+o)+l+r+"}"};return n(e,t,r)};jabberwerx.util.isJWObjGUID=function(e){return typeof e=="string"&&(e.indexOf("_jwobj_")==0||e.indexOf('"_jwobj_')==0)};jabberwerx.util.isJWObjRef=function(e){return e&&typeof e=="object"&&typeof e._jwobj_=="boolean"&&e._jwobj_};jabberwerx.util.isJWInvocation=function(e){return e&&typeof e._jwinvocation_!="undefined"};jabberwerx.util.findReachableGUIDs=function(e){var t={};(function r(e,n){if(typeof e=="object"&&e!=null){var i="";for(var a=0;a<n;a++){i+="   "}if(jabberwerx.util.isArray(e)){for(var s=0;s<e.length;s++){if(e[s]){r(e[s],n+1)}}}else if(jabberwerx.util.isJWObjRef(e)){if(t[e._guid]===undefined){t[e._guid]=e;for(var a in e){if(e[a]){r(e[a],n+1)}}}}else if(e.constructor==Object){for(var a in e){if(e[a]&&typeof e[a]=="object"){r(e[a],n+1)}}}}})(e,0);return t};jabberwerx.util.saveGraph=function(e,t,r){if(!jabberwerx.$.jStore||!jabberwerx.$.jStore.isReady){throw new jabberwerx.util.JWStorageRequiresjQueryjStoreError}var n=jabberwerx.util.findReachableGUIDs(e);if(!n[t]){e=jabberwerx.util.isJWObjRef(e)?{reference:e,timestamp:(new Date).getTime()}:e;n[t]=e}var i={};for(var a in n){var s=n[a];if(s.shouldBeSavedWithGraph&&!s.shouldBeSavedWithGraph()){continue}if(s.willBeSerialized){s.willBeSerialized()}var o=jabberwerx.util.serialize(s,false);jabberwerx.$.store("_jw_store_."+a,o);i[a]=o;jabberwerx.util._markGraph(a,s)}jabberwerx.$.store("_jw_store_timestamp_."+t,(new Date).getTime());if(r){r(i)}return i};jabberwerx.util.loadGraph=function(tag){if(!jabberwerx.$.jStore||!jabberwerx.$.jStore.isReady){throw new jabberwerx.util.JWStorageRequiresjQueryjStoreError}var reg={};var loader,knitter;knitter=function(arg){if(!arg){return arg}switch(typeof arg){case"string":if(jabberwerx.util.isJWObjGUID(arg)){var tmp=reg[arg]?reg[arg]:loader(arg);if(tmp){return tmp}}break;case"object":if(jabberwerx.util.isJWInvocation(arg)){var typeObject=knitter(arg.object);arg=jabberwerx.util.generateInvocation(typeObject,arg.methodName)}else if(arg._className){var tmp=reg[arg._guid];if(tmp){return tmp}if(arg instanceof jabberwerx.JWBase){reg[arg._guid]=arg}else{arg=eval("new "+arg._className+'("__jw_rehydrate__", arg)');reg[arg._guid]=arg}}for(var key in arg){if(key=="_guid"){continue}arg[key]=knitter(arg[key])}if(arg.wasUnserialized){arg.wasUnserialized()}break;case"array":for(var i in val){val[i]=knitter(val[i])}break}return arg};loader=function(ltag){var graph;if(reg[ltag]){return reg[ltag]}graph=jabberwerx.$.store("_jw_store_."+ltag);if(!graph){return graph}try{graph=eval("("+graph+")");graph=knitter(graph)}catch(e){jabberwerx.util.debug.log("exception evalualuating "+ltag+": "+e);throw e}reg[ltag]=graph;jabberwerx.util._markGraph(ltag,graph);return graph};var ts=jabberwerx.util.getLoadedGraphAge(tag);if(ts&&ts.getTime()>jabberwerx.util.getMaxGraphAge()*1e3){return null}loader(tag);var key;for(key in reg){if(reg[key]&&reg[key].graphUnserialized){reg[key].graphUnserialized()}}var retval=reg[tag];if(retval&&!jabberwerx.util.isJWObjRef(retval)&&jabberwerx.util.isJWObjRef(retval.reference)){retval=retval.reference}return retval};jabberwerx.util.isGraphSaved=function(e){if(!jabberwerx.$.jStore||!jabberwerx.$.jStore.isReady){throw new jabberwerx.util.JWStorageRequiresjQueryjStoreError}return jabberwerx.$.store("_jw_store_."+e)!=null};jabberwerx.util.clearGraph=function(e){if(!e&&!jabberwerx.util._graphRegistry)return;var t={};if(e&&(!jabberwerx.util._graphRegistry||!jabberwerx.util._graphRegistry[e])){t=jabberwerx.util.findReachableGUIDs(jabberwerx.util.loadGraph(e))}else{var r=e?jabberwerx.util._graphRegistry[e]:jabberwerx.util._graphRegistry;t=r.graph;if(e&&!t[e]){t[e]=r.value}}for(var n in t){jabberwerx.$.remove("_jw_store_."+n);jabberwerx.util._markGraph(n)}};jabberwerx.util.getLoadedGraphTimestamp=function(e){if(e){var t=jabberwerx.$.store("_jw_store_timestamp_."+e);if(t){var r=new Date;r.setTime(t);return r}}return null};jabberwerx.util.getLoadedGraphAge=function(e){var t=jabberwerx.util.getLoadedGraphTimestamp(e);if(t){return new Date((new Date).getTime()-t.getTime())}return null};jabberwerx.util.getMaxGraphAge=function(){if(typeof jabberwerx._config.persistDuration!="number"){jabberwerx._config.persistDuration=parseInt(jabberwerx._config.persistDuration)}return jabberwerx._config.persistDuration};jabberwerx.util.setMaxGraphAge=function(e){if(e&&typeof e=="number"&&e>0){jabberwerx._config.persistDuration=e}return jabberwerx.util.getMaxGraphAge()};jabberwerx.util.clone=function(e){if(typeof e=="object"&&e!=null){if(e instanceof Array){var t=[];for(var r=0;r<e.length;r++){t.push(jabberwerx.util.clone(e[r]))}}if(typeof t=="undefined"){var t={}}for(var n in e){t[n]=jabberwerx.util.clone(e[n])}if(typeof e.prototype!="undefined"){t.prototype=e.prototype}}else{var t=e}return t};jabberwerx.util.slugify=function(e,t){return e.toLowerCase().replace("-",t).replace(/[^%a-z0-9 _-]/g,"").replace(/\s+/g,typeof t!="undefined"?t:"-")};jabberwerx.util.encodeSerialization=function(e){if(e){return jabberwerx.util.crypto.b64Encode(jabberwerx.util.crypto.utf8Encode(e))}return""};jabberwerx.util.decodeSerialization=function(e){if(e){return jabberwerx.util.crypto.utf8Decode(jabberwerx.util.crypto.b64Decode(e))}return""};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){var t=this.length;var r=Number(arguments[1])||0;r=r<0?Math.ceil(r):Math.floor(r);if(r<0)r+=t;for(;r<t;r++){if(r in this&&this[r]===e)return r}return-1}}jabberwerx.util.unserializeXMLDoc=function(e,t){if(!e&&!t){return null}if(typeof t=="string"){e="<"+t+">"+e+"</"+t+">"}var r=new jabberwerx.NodeBuilder("nbwrapper");r.xml(e);var n=r.data.childNodes[0];r.data.removeChild(n);r.document.removeChild(r.data);r.document.appendChild(n);return r.document};jabberwerx.util.unserializeXML=function(e,t){var r=jabberwerx.util.unserializeXMLDoc(e,t);return r?r.documentElement:r};jabberwerx.util.serializeXML=function(e){if(typeof XMLSerializer!="undefined"){return(new XMLSerializer).serializeToString(e)}else if(e.xml){return e.xml}return null};if(typeof XMLSerializer!="undefined"&&typeof Node!="undefined"&&Node.prototype&&Node.prototype.__defineGetter__){Node.prototype.__defineGetter__("xml",function(){return jabberwerx.util.serializeXML(this)})}jabberwerx.util.debug={consoleDelegate:null,console:window.console||null};jabberwerx.$.each(["log","dir","warn","error","info","debug"],function(e,t){jabberwerx.util.debug[t]=function(e,r){if(!jabberwerx._config.debug.on||jabberwerx.util.isString(r)&&!jabberwerx._config.debug[r]){return}if(jabberwerx.util.isString(r)){e="["+r+"] "+e}try{jabberwerx.util.debug.console[t](e)}catch(n){}if(jabberwerx.util.debug.consoleDelegate){jabberwerx.util.debug.consoleDelegate[t](e)}}});jabberwerx.util.setDebugStream=function(e,t){jabberwerx._config.debug[e]=typeof t=="undefined"?true:t};jabberwerx.util.JWStorageRequiresjQueryjStoreError=jabberwerx.util.Error.extend("JW storage features require jQuery-jStore.");jabberwerx.util._graphRegistry=null}if(jabberwerx){jabberwerx.JWModel=jabberwerx.JWBase.extend({init:function(){},shouldBeSavedWithGraph:function(){return true}},"JWModel")}if(jabberwerx){jabberwerx.SASLMechanism=jabberwerx.JWBase.extend({init:function(e,t){this._super();this.mechanismName=this.constructor.mechanismName;this._encoded=Boolean(t);if(!(e&&e instanceof jabberwerx.Client)){throw new TypeError("client must be a jabberwerx.Client")}this.client=e},evaluate:function(e){if(e&&!jabberwerx.isElement(e)){throw new TypeError("input must be undefined or an element")}var t=null;var r=null;var n;if(!e){if(this.started){jabberwerx.util.debug.log("SASL mechanism already started!");throw this._handleFailure()}this.started=true;try{n=this.evaluateStart();n=this._encodeData(n);t=new jabberwerx.NodeBuilder("{urn:ietf:params:xml:ns:xmpp-sasl}auth").attribute("mechanism",this.mechanismName).text(n).data}catch(i){jabberwerx.util.debug.log("SASL failed to initialize: "+i);throw this._handleFailure(i)}}else{if(!this.started){jabberwerx.util.debug.log("SASL mechanism not yet started!");throw this._handleFailure()}switch(e.nodeName){case"success":try{if(!this.complete){n=jabberwerx.$(e).text();n=this._decodeData(n);n=this.evaluateChallenge(n)}}catch(i){jabberwerx.util.debug.log("SASL failed to evaluate success data: "+i);throw this._handleFailure(i)}if(n||!this.complete){jabberwerx.util.debug.log("SASL failed to complete upon <success/>");throw this._handleFailure()}break;case"failure":{var r=this._handleFailure(jabberwerx.$(e).children().get(0));jabberwerx.util.debug.log("SASL failure from server: "+r.message);throw r}break;case"challenge":if(this.complete){jabberwerx.util.debug.log("SASL received challenge after completion!");throw this._handleFailure()}try{n=jabberwerx.$(e).text();n=this._decodeData(n);n=this.evaluateChallenge(n);n=this._encodeData(n);t=new jabberwerx.NodeBuilder("{urn:ietf:params:xml:ns:xmpp-sasl}response").text(n).data}catch(i){jabberwerx.util.debug.log("SASL failed to evaluate challenge data: "+i);throw this._handleFailure(i)}break;default:jabberwerx.util.debug.log("unexpected stanza received!");throw this._handleFailure();break}}return t},_decodeData:function(e){if(!e){return""}if(!this._encoded){return jabberwerx.util.crypto.utf8Decode(jabberwerx.util.crypto.b64Decode(e))}return e},_encodeData:function(e){if(!e){return""}if(!this._encoded){return jabberwerx.util.crypto.b64Encode(jabberwerx.util.crypto.utf8Encode(e))}return e},evaluateStart:function(){throw new Error("not implemented!")},evaluateChallenge:function(e){throw new Error("not implemented!")},_handleFailure:function(e){this.complete=true;if(e instanceof jabberwerx.SASLMechanism.SASLAuthFailure){return e}else if(jabberwerx.isElement(e)){var t="{urn:ietf:params:xml:ns:xmpp-sasl}"+e.nodeName;return new jabberwerx.SASLMechanism.SASLAuthFailure(t)}else{return new jabberwerx.SASLMechanism.SASLAuthFailure}},getProperties:function(){return this.client&&this.client._connectParams||{}},client:null,mechanismName:"",complete:false,started:false},"jabberwerx.SASLMechanism");jabberwerx.SASLMechanism.SASLAuthFailure=jabberwerx.util.Error.extend("{urn:ietf:params:xml:ns:xmpp-sasl}temporary-auth-failure");jabberwerx.SASLMechanism._baseExtend=jabberwerx.SASLMechanism.extend;jabberwerx.SASLMechanism.extend=function(e,t,r){if(!(r&&typeof r=="string")){throw new TypeError("name must be a non-empty string")}var n=jabberwerx.SASLMechanism._baseExtend(e,t);n.mechanismName=r.toUpperCase();if(jabberwerx.sasl&&jabberwerx.sasl instanceof jabberwerx.SASLMechanismFactory){jabberwerx.sasl.addMechanism(n)}return n};jabberwerx.SASLMechanismFactory=jabberwerx.JWBase.extend({init:function(e){this._super();if(!e){if(jabberwerx._config.enabledMechanisms){e=jabberwerx._config.enabledMechanisms}else{e=[]}}this.mechanisms=e.concat()},createMechanismFor:function(e,t){if(!jabberwerx.$.isArray(t)){throw new TypeError("mechs must be an array of mechanism names")}if(!(e&&e instanceof jabberwerx.Client)){throw new TypeError("client must be an isntance of jabberwerx.Client")}t=t.concat();for(var r=0;r<t.length;r++){t[r]=String(t[r]).toUpperCase()}var n=null;for(var r=0;!n&&r<this.mechanisms.length;r++){var i=this._mechsAvail[this.mechanisms[r]];if(!i){continue}for(var a=0;!n&&a<t.length;a++){if(t[a]!=i.mechanismName){continue}try{n=new i(e)}catch(s){jabberwerx.util.debug.log("could not create SASLMechanism for "+i.mechanismName+": "+s);n=null}}}return n},addMechanism:function(e){if(!(jabberwerx.$.isFunction(e)&&e.mechanismName)){throw new TypeError("type must be the constructor for a SASLMechanism type")}this._mechsAvail[e.mechanismName]=e},removeMechanism:function(e){if(!(jabberwerx.$.isFunction(e)&&e.mechanismName)){throw new TypeError("type must be the constructor for a SASLMechanism type")}this._mechsAvail[e.mechanismName]=undefined;delete this._mechsAvail[e.mechanismName]},_mechsAvail:{},mechanisms:[]},"jabberwerx.SASLMechanismFactory");if(!(jabberwerx.sasl&&jabberwerx.sasl instanceof jabberwerx.SASLMechanismFactory)){jabberwerx.sasl=new jabberwerx.SASLMechanismFactory([]);jabberwerx.$(document).ready(function(){if(jabberwerx.sasl.mechanisms.length==0){jabberwerx.sasl.mechanisms=jabberwerx._config.enabledMechanisms.concat()}})}}if(jabberwerx&&jabberwerx.SASLMechanism){jabberwerx.SASLPlainMechanism=jabberwerx.SASLMechanism.extend({init:function(e){this._super(e)},evaluateStart:function(){var e=this.getProperties();if(!this.client.isSecure()){throw new jabberwerx.SASLMechanism.SASLAuthFailure("{urn:ietf:params:xml:ns:xmpp-sasl}mechanism-too-weak")}var t=String.fromCharCode(0);var r=e&&e.jid&&e.jid.getNode()||"";var n=e&&e.password||"";return t+r+t+n},evaluateChallenge:function(e){if(e||this.complete){throw new jabberwerx.SASLMechanism.SASLAuthFailure}this.complete=true}},"jabberwerx.SASLPlainMechanism","PLAIN");jabberwerx.SASLDigestMd5Mechanism=jabberwerx.SASLMechanism.extend({init:function(e){this._super(e)},evaluateStart:function(){this._stage=this._generateResponse;return null},evaluateChallenge:function(e){var t,r;if(this.complete&&!this._stage){return}if(!this._stage){jabberwerx.util.debug.log("DIGEST-MD5 in bad stage");throw new jabberwerx.SASLMechanism.SASLAuthFailure}t=this._decodeProperties(e);r=this._stage(t);return this._encodeProperties(r)},_generateResponse:function(e){var t=this.getProperties();var r,n,i;r=t.jid&&t.jid.getNode()||"";i=t.jid&&t.jid.getDomain()||"";n=t.password||"";var a=e.realm||i;var s=e.nonce;var o=e.nc||"00000001";var l=this._cnonce((r+"@"+a).length);var u="xmpp/"+i;var c="auth";var h;h=jabberwerx.util.crypto.rstr_md5(jabberwerx.util.crypto.utf8Encode(r+":"+a+":"+n));h=h+jabberwerx.util.crypto.utf8Encode(":"+s+":"+l);var f;f=jabberwerx.util.crypto.utf8Encode("AUTHENTICATE:"+u);var d=[jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(h)),s,o,l,c,jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(f))].join(":");d=jabberwerx.util.crypto.hex_md5(jabberwerx.util.crypto.utf8Encode(d));var b={charset:"utf-8","digest-uri":u,cnonce:l,nonce:s,nc:o,qop:c,username:r,realm:a,response:d};this._authProps=b;this._stage=this._verifyRspAuth;return b},_verifyRspAuth:function(e){if(e){e=jabberwerx.$.extend({},e,this._authProps||{});var t=this.getProperties();var r,n,i;r=t.jid&&t.jid.getNode()||"";i=t.jid&&t.jid.getDomain()||"";n=t.password||"";var a=e.realm||i;var s=e.nonce;var o=e.nc||"00000001";var l=e.cnonce;var u="xmpp/"+i;var c="auth";var h;h=jabberwerx.util.crypto.rstr_md5(jabberwerx.util.crypto.utf8Encode(r+":"+a+":"+n));h=h+jabberwerx.util.crypto.utf8Encode(":"+s+":"+l);var f;f=jabberwerx.util.crypto.utf8Encode(":"+u);var d=[jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(h)),s,o,l,c,jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(f))].join(":");d=jabberwerx.util.crypto.hex_md5(jabberwerx.util.crypto.utf8Encode(d));if(d!=e.rspauth){jabberwerx.util.debug.log("response auth values do not match");throw new jabberwerx.SASLMechanism.SASLAuthFailure}}this.complete=true;this._stage=null},_decodeProperties:function(e){var t=/([^"()<>\{\}\[\]@,;:\\\/?= \t]+)=(?:([^"()<>\{\}\[\]@,;:\\\/?= \t]+)|(?:"([^"]+)"))/g;var r={};var n;if(!e){e=""}while(n=t.exec(e)){r[n[1]]=n[2]||n[3]||""}return r},_encodeProperties:function(e){var t={username:true,realm:true,nonce:true,cnonce:true,"digest-uri":true,response:true};var r=[];for(var n in e){var i=t[n]?'"'+e[n]+'"':e[n];r.push(n+"="+i)}return r.join(",")},_stage:null,_cnonce:function(e){var t="";for(var r=0;r<e;r++){t+=String.fromCharCode(Math.random()*256)}return jabberwerx.util.crypto.b64Encode(t)}},"jabberwerx.SASLDigestMd5Mechanism","DIGEST-MD5")}if(jabberwerx){jabberwerx.JID=jabberwerx.JWModel.extend({init:function(e){if(e instanceof jabberwerx.JID){e={node:e.getNode()||null,domain:e.getDomain()||null,resource:e.getResource()||null}}else if(typeof e=="string"){var t=/^(?:([^\/]+)@)?([^@\/]+)(?:\/(.+))?$/.exec(e);if(!t){throw new jabberwerx.JID.InvalidJIDError("JID did not match the form 'node@domain/resource'")}full=e.toString();e={node:t[1]||undefined,domain:t[2],resource:t[3]||undefined}}else if(!e){throw new jabberwerx.JID.InvalidJIDError("argument must be defined and not null")}else{e=jabberwerx.$.extend({},e)}var r=function(e){if(/[ \t\n\r@\:\<\>\&'"\/]/.test(e)){throw new jabberwerx.JID.InvalidJIDError("invalid characters found")}return e.toLowerCase()};if(!e.domain){throw new jabberwerx.JID.InvalidJIDError("'' or null or undefined domain not allowed")}else{e.domain=r(e.domain,true)}if(e.node==""){throw new jabberwerx.JID.InvalidJIDError("'' node with @ not allowed")}else if(e.node){if(e.unescaped){e.node=jabberwerx.JID.escapeNode(e.node)}e.node=r(e.node,true)}if(e.resouce==""){throw new jabberwerx.JID.InvalidJIDError("'' resource with / not allowed")}this._domain=e.domain;this._node=e.node||"";this._resource=e.resource||"";this._full=""+(e.node?e.node+"@":"")+e.domain+(e.resource?"/"+e.resource:"");if(jabberwerx.$.browser.msie){this.toString=function(){return this._full}}},getBareJID:function(){if(!this.getResource()){return this}else{return new jabberwerx.JID({node:this.getNode(),domain:this.getDomain()})}},getBareJIDString:function(){return this.getBareJID().toString()},getDomain:function(){return this._domain},getNode:function(){return this._node},getResource:function(){return this._resource},toString:function(){return this._full},toDisplayString:function(){var e=this.getDomain();var t;t=this.getNode();if(t){e=jabberwerx.JID.unescapeNode(t)+"@"+e}t=this.getResource();if(t){e=e+"/"+t}return e},equals:function(e){try{e=jabberwerx.JID.asJID(e);return this.toString()==e.toString()}catch(t){return false}},compareTo:function(e){e=jabberwerx.JID.asJID(e);var t=function(e,t){if(e<t){return-1}else if(e>t){return 1}return 0};var r;if((r=t(this.getDomain(),e.getDomain()))!=0){return r}if((r=t(this.getNode(),e.getNode()))!=0){return r}if((r=t(this.getResource(),e.getResource()))!=0){return r}return 0},shouldBeSavedWithGraph:function(){return false},shouldBeSerializedInline:function(){return true},wasUnserialized:function(){if(jabberwerx.$.browser.msie){this.toString=function(){return this._full}}},_node:"",_domain:"",_resource:"",_full:""},"jabberwerx.JID");jabberwerx.JID.InvalidJIDError=jabberwerx.util.Error.extend.call(TypeError,"The JID is invalid");jabberwerx.JID.asJID=function(e){if(e instanceof jabberwerx.JID){return e}else{return new jabberwerx.JID(e)}};jabberwerx.JID.escapeNode=function(e){if(typeof e!="string"){throw new TypeError("input must be a string")}if(e.charAt(0)==" "||e.charAt(e.length-1)==" "){throw new TypeError("input cannot start or end with ' '")}var t=/([ "&'\/:<>@])|(\\)(20|22|26|27|2f|3a|3c|3e|40|5c)/gi;var r=function(e,t,r,n){switch(t||r){case" ":return"\\20";case'"':return"\\22";case"&":return"\\26";case"'":return"\\27";case"/":return"\\2f";case":":return"\\3a";case"<":return"\\3c";case">":return"\\3e";case"@":return"\\40";case"\\":return"\\5c"+n}return e};return e.replace(t,r)};jabberwerx.JID.unescapeNode=function(e){if(typeof e!="string"){throw new TypeError("input must be a string")}var t=/(\\20|\\22|\\26|\\27|\\2f|\\3a|\\3c|\\3e|\\40)|(\\5c)(20|22|26|27|2f|3a|3c|3e|40|5c)/gi;var r=function(e,t,r,n){switch(t||r){case"\\20":return" ";case"\\22":return'"';case"\\26":return"&";case"\\27":return"'";case"\\2f":return"/";case"\\3a":return":";case"\\3c":return"<";case"\\3e":return">";case"\\40":return"@";case"\\5c":return"\\"+n}return e};return e.replace(t,r)}}if(jabberwerx){(function(){var e=function(e,t,r){var n="on:"+t.toLowerCase();var i=e[n];if(!i&&r=="create"){i=new jabberwerx.EventNotifier(e,t);e[n]=i}else if(i&&r=="destroy"){delete e[n]}return i};var t=function(t,r,n){var i=t instanceof jabberwerx.EventDispatcher?t:t._eventDispatch;if(!(i&&i instanceof jabberwerx.EventDispatcher)){if(n!="create"){return}i=new jabberwerx.EventDispatcher(t);t._eventDispatch=i}return e(i,r,n)};jabberwerx.EventObject=function(e,t){this.notifier=e;this.name=e.name;this.source=e.dispatcher.source;this.data=t;this.selected=undefined};jabberwerx.EventNotifier=jabberwerx.JWBase.extend({init:function(e,t){this._super();this.dispatcher=e;this.name=t.toLowerCase();this._callbacks=[]},bind:function(e){this.bindWhen(undefined,e)},bindWhen:function(e,t){if(!jabberwerx.$.isFunction(t)){new TypeError("callback must be a function")}this.unbind(t);switch(typeof e){case"undefined":break;case"function":break;case"string":var r=e;e=function(e,t){var n;if(e instanceof jabberwerx.Stanza){n=e.getDoc()}else{n=e}var i=jabberwerx.$(r,n);switch(i.length){case 0:return false;case 1:return i[0];default:return i}return false};break;default:throw new TypeError("selector must be undefined or function or string")}this._callbacks.push({filter:r,selector:e,cb:t})},unbind:function(e){this._callbacks=jabberwerx.$.grep(this._callbacks,function(t){return t["cb"]!==e})},trigger:function(t,r){var n;if(t instanceof jabberwerx.EventObject){n=t;n.notifier=this}else{n=new jabberwerx.EventObject(this,t)}var i=[];jabberwerx.reduce(this._callbacks,function(e){var t=e["cb"];var r=e["selector"];var a;if(!t||!jabberwerx.$.isFunction(t)){return}var s=undefined;if(r){s=r(n.data);if(!s){return}}try{n.selected=s;a=t.call(t,n)}catch(o){}if(a!==undefined){i.push(a)}});if(!r){r=e(jabberwerx.globalEvents,this.name)}else if(!(r instanceof jabberwerx.EventNotifier)){
throw new TypeError("delegated must be a EventNotifier")}if(r&&r!==this){i=i.concat(r.trigger(n))}return i},shouldBeSavedWithGraph:function(){return true},wasUnserialized:function(){var e=this._callbacks;e=jabberwerx.$.map(e,function(e,t){if(jabberwerx.util.isJWInvocation(e.cb)){var r=e.cb.methodName,n=e.cb.object;if(!(n&&r&&n[r])){jabberwerx.util.debug.log("throwing out bad callback: "+n+"["+r+"]");return null}}if(e.filter&&!e.selector&&typeof e.filter=="string"){var i=e.filter;e.selector=function(e,t){var r;if(e instanceof jabberwerx.Stanza){r=e.getDoc()}else{r=e}var n=jabberwerx.$(i,r);switch(n.length){case 0:return false;case 1:return n[0];default:return n}return false}}return e});this._callbacks=e}},"jabberwerx.EventNotifier");jabberwerx.EventDispatcher=jabberwerx.JWBase.extend({init:function(e){this._super();this.source=e;if(e!==jabberwerx&&jabberwerx.globalEvents){this.globalEvents=jabberwerx.globalEvents}},shouldBeSavedWithGraph:function(){return true},wasUnserialized:function(){jabberwerx.globalEvents=this.globalEvents}},"jabberwerx.EventDispatcher");jabberwerx.GlobalEventDispatcher=jabberwerx.EventDispatcher.extend({init:function(){this._super(jabberwerx);if(jabberwerx.globalEvents&&jabberwerx.globalEvents!==this){throw new Error("only one global events dispatcher can exist!")}},bind:function(t,r){var n=e(this,t,"create");n.bind(r)},bindWhen:function(t,r,n){var i=e(this,t,"create");i.bindWhen(r,n)},unbind:function(t,r){var n=e(this,t);if(n){n.unbind(r)}},shouldBeSerializedInline:function(){return false},shouldBeSavedWithGraph:function(){return true},willBeSerialized:function(){this.source=undefined},wasUnserialized:function(){this.source=jabberwerx}},"jabberwerx.GlobalEventDispatcher");if(!(jabberwerx.globalEvents&&jabberwerx.globalEvents instanceof jabberwerx.GlobalEventDispatcher)){jabberwerx.globalEvents=new jabberwerx.GlobalEventDispatcher}jabberwerx.JWModel.prototype.event=function(e){return t(this,e)};jabberwerx.JWModel.prototype.applyEvent=function(e){return t(this,e,"create")}})()}if(jabberwerx){(function(){var e=function(e,t){return"["+(e||"")+"]:["+(t||"")+"]"};jabberwerx.Entity=jabberwerx.JWModel.extend({init:function(t,r){this._super();if(!t&&!(t.jid||t.node)){throw new TypeError("key must contain a jid and/or a node")}if(t.jid){this.jid=jabberwerx.JID.asJID(t.jid)}if(t.node){this.node=t.node}this._mapKey=e(this.jid,this.node);var n;if(r instanceof jabberwerx.Controller){this.controller=r;n=r.client&&r.client.entitySet}else if(r&&r.register&&r.unregister&&r.entity){n=r}if(n){this.cache=n;this._eventing={added:n.event("entityCreated"),updated:n.event("entityUpdated"),deleted:n.event("entityDestroyed")}}else{this._eventing={added:null,updated:null,deleted:null}}this.applyEvent("primaryPresenceChanged");this.applyEvent("resourcePresenceChanged");if(jabberwerx.$.browser.msie){this.toString=function(){return this.__toStringValue()}}},destroy:function(){if(this.cache){this.cache.unregister(this)}this._super()},apply:function(e,t){if(!(e&&e instanceof jabberwerx.Entity)){throw new TypeError("entity is not valid")}jabberwerx.$.extend(this,{_displayName:e._displayName,_groups:jabberwerx.$.extend([],e._groups),_presenceList:jabberwerx.$.extend([],e._presenceList),properties:jabberwerx.$.extend(true,{},e.properties),features:jabberwerx.$.extend([],e.features),identities:jabberwerx.$.extend([],e.identities)});if(!t){this.update()}return this},__toStringValue:function(){return"entity<"+this.getClassName()+">["+this._mapKey+"]: "+this.getDisplayName()},matches:function(e){if(e===this){return true}if(!e){return false}return this._mapKey==e._mapKey},isActive:function(){return this._presenceList.length>0&&this._presenceList[0].getType()!="unavailable"},getPrimaryPresence:function(){return this._presenceList[0]||null},getAllPresence:function(){return this._presenceList},getResourcePresence:function(e){var t=this.jid.getBareJIDString()+"/"+e;var r=null;jabberwerx.$.each(this._presenceList,function(){if(this.getFrom()==t){r=this;return false}return true});return r},updatePresence:function(e){var t=false;if(!e){if(this.getPrimaryPresence()){var r=this._presenceList.length;for(var n=0;n<r;n++){var e=this._presenceList.pop();this.event("resourcePresenceChanged").trigger({fullJid:e.getFromJID(),presence:null,nowAvailable:false})}this.event("primaryPresenceChanged").trigger({presence:null,fullJid:this.jid.getBareJID()});t=true}}else{if(!(e instanceof jabberwerx.Presence)){throw new TypeError("presence is not a valid type")}var i=e.getFromJID();if(i.getBareJIDString()!=this.jid.getBareJIDString()){throw new jabberwerx.Entity.InvalidPresenceError("presence is not for this entity: "+this)}if(e.getType()&&e.getType()!="unavailable"){throw new jabberwerx.Entity.InvalidPresenceError("presence is not the correct type")}var a=this.getResourcePresence(i.getResource());var s;if(!a||a.getType()=="unavailable"){s=Boolean(!e.getType())}else{s=false}var o=this._presenceList[0]||null;this._removePresenceFromList(i.toString());if(e.getType()!="unavailable"){if(!this.isActive()){this._clearPresenceList()}this._insertPresence(e)}else{this._handleUnavailable(e)}this.event("resourcePresenceChanged").trigger({fullJid:i,presence:e,nowAvailable:s});if(o!==this._presenceList[0]){var l;o=this._presenceList[0]||null;l=o?o.getFromJID():i.getBareJID();this.event("primaryPresenceChanged").trigger({presence:o,fullJid:l});t=true}}return t},_handleUnavailable:function(e){},_insertPresence:function(e){this._presenceList.push(e);this._presenceList.sort(function(e,t){return t.compareTo(e)})},_clearPresenceList:function(){this._presenceList=[]},_removePresenceFromList:function(e){for(var t=0;t<this._presenceList.length;t++){if(this._presenceList[t].getFrom()==e){this._presenceList.splice(t,1);return true}}return false},getDisplayName:function(){var e=this._displayName;if(!e){var t=this.jid&&this.jid.toDisplayString();e=(this.node&&"{"+this.node+"}")+(t||"")}return e},setDisplayName:function(e){var t=String(e)||"";var r=this._displayName;if(r!=t){this._displayName=t;this.update()}},_displayName:"",getGroups:function(){return this._groups},setGroups:function(e){if(jabberwerx.$.isArray(e)){e=jabberwerx.unique(e.concat([]))}else if(e){e=[e.toString()]}else{e=[]}this._groups=e;this.update()},_groups:[],update:function(){if(this.controller&&this.controller.updateEntity){this.controller.updateEntity(this)}else if(this._eventing["updated"]){this._eventing["updated"].trigger(this)}},remove:function(){if(this.controller&&this.controller.removeEntity){this.controller.removeEntity(this)}else{this.destroy()}},hasFeature:function(e){if(!e){return false}var t=false;jabberwerx.$.each(this.features,function(){t=String(this)==e;return!t});return t},hasIdentity:function(e){if(!e){return false}var t=false;jabberwerx.$.each(this.identities,function(){t=String(this)==e;return!t});return t},toString:function(){return this.__toStringValue()},jid:null,node:"",properties:{},features:[],identities:[],_presenceList:[]},"jabberwerx.Entity");jabberwerx.Entity.InvalidPresenceError=jabberwerx.util.Error.extend("The provided presence is not valid for this entity");jabberwerx.EntitySet=jabberwerx.JWModel.extend({init:function(){this._super();this.applyEvent("entityCreated");this.applyEvent("entityDestroyed");this.applyEvent("entityUpdated");this.applyEvent("entityRenamed");this.applyEvent("entityAdded");this.applyEvent("entityRemoved");this.applyEvent("batchUpdateStarted");this.applyEvent("batchUpdateEnded")},entity:function(t,r){return this._map[e(t,r)]},register:function(e){if(!(e&&e instanceof jabberwerx.Entity)){throw new TypeError("entity is not an Entity")}var t=this.entity(e.jid,e.node);if(t===e){return false}if(t){this.unregister(t)}this._updateToMap(e);this.event("entityAdded").trigger(e);return true},unregister:function(e){var t=this.entity(e.jid,e.node)!==undefined;this._removeFromMap(e);if(t){this.event("entityRemoved").trigger(e)}return t},_renameEntity:function(e,t,r){var n=e.jid;var i=e.node;this._removeFromMap(e);if(t){t=jabberwerx.JID.asJID(t)}else{t=undefined}e.jid=t;if(r){r=String(r)}else{r=undefined}e.node=r;this._updateToMap(e);var a={entity:e,jid:n,node:r};this.event("entityRenamed").trigger(a)},each:function(e){if(!jabberwerx.$.isFunction(e)){throw new TypeError("operator must be a function")}var t=this;jabberwerx.$.each(this._map,function(){var t;if(this instanceof jabberwerx.Entity){t=e(this)}return t!==false})},toArray:function(){var e=[];this.each(function(t){e.push(t)});return e},getAllGroups:function(){var e=[];this.each(function(t){jabberwerx.$.merge(e,t.getGroups())});return jabberwerx.unique(e)},_map:{},_updateToMap:function(t){this._map[e(t.jid,t.node)]=t},_removeFromMap:function(t){delete this._map[e(t.jid,t.node)]}},"jabberwerx.EntitySet");jabberwerx.EntitySet.EntityAlreadyExistsError=jabberwerx.util.Error.extend("That JID is already taken!.")})()}if(jabberwerx){jabberwerx.Stanza=jabberwerx.JWModel.extend({init:function(e){this._super();var t=new jabberwerx.NodeBuilder;if(jabberwerx.isElement(e)){t=t.node(e)}else if(typeof e=="string"){if(!/^\{[^\}]*\}/.test(e)){e="{jabber:client}"+e}t=t.element(e)}else{throw new TypeError("root must be an element or expanded-name")}this._DOM=t.data;var r=new Date;var n=jabberwerx.$(t.data).find("x[xmlns='jabber:x:delay'][stamp]").attr("stamp");if(!n){n=jabberwerx.$(t.data).find("delay[xmlns='urn:xmpp:delay'][stamp]").attr("stamp")}if(n){try{r=jabberwerx.parseTimestamp(n)}catch(i){jabberwerx.util.debug.log("could not parse delay: "+i)}}this.timestamp=r},getNode:function(){return this._DOM},getDoc:function(){return this.getNode().ownerDocument},xml:function(){return jabberwerx.util.serializeXML(this._DOM)},pType:function(){return this.getNode().nodeName},_getAttrValue:function(e){return this.getNode().getAttribute(e)},_setAttrValue:function(e,t){if(t===undefined||t===null){this.getNode().removeAttribute(e)}else{this.getNode().setAttribute(e,t)}},_getChildText:function(e){var t=new jabberwerx.NodeBuilder(e).data;var r=t.namespaceURI?t.namespaceURI:this.getNode().namespaceURI;var n=jabberwerx.$(this.getNode()).children(t.nodeName).map(function(e,t){return t.namespaceURI==r?t:null});return n.length?jabberwerx.$(n[0]).text():null},_setChildText:function(e,t){var r=jabberwerx.$(this.getNode()).children(e);if(t===undefined||t===null){r.remove()}else{if(!r.length){r=jabberwerx.$(new jabberwerx.NodeBuilder(this.getNode()).element(e).data)}r.text(t)}},getType:function(){return this._getAttrValue("type")},setType:function(e){this._setAttrValue("type",e||undefined)},getID:function(){return this._getAttrValue("id")},setID:function(e){this._setAttrValue("id",e||undefined)},getFrom:function(){return this._getAttrValue("from")||null},getFromJID:function(){var e=this.getFrom();if(e){try{e=jabberwerx.JID.asJID(e)}catch(t){jabberwerx.util.debug.log("could not parse 'from' address: "+t);e=null}}return e},setFrom:function(e){e=e?jabberwerx.JID.asJID(e):undefined;this._setAttrValue("from",e)},getTo:function(){return this._getAttrValue("to")||null},getToJID:function(){var e=this.getTo();if(e){try{e=jabberwerx.JID.asJID(e)}catch(t){jabberwerx.util.debug.log("could not parse 'to' address: "+t);e=null}}return e},setTo:function(e){e=e?jabberwerx.JID.asJID(e):undefined;this._setAttrValue("to",e)},isError:function(){return this.getType()=="error"},getErrorInfo:function(){var e=jabberwerx.$(this.getNode()).children("error");if(this.isError()&&e.length){e=jabberwerx.Stanza.ErrorInfo.createWithNode(e.get(0))}else{e=null}return e},clone:function(){var e=jabberwerx.Stanza.createWithNode(this.getNode());e.timestamp=this.timestamp;return e},swap:function(e){var t=this.clone();t.setTo(this.getFromJID());t.setFrom(e?this.getToJID():null);return t},errorReply:function(e){if(!(e&&e instanceof jabberwerx.Stanza.ErrorInfo)){throw new TypeError("err must be an ErrorInfo")}var t=this.swap();t.setType("error");var r=new jabberwerx.NodeBuilder(t.getNode()).xml(e.getNode().xml);return t},willBeSerialized:function(){this.timestamp=this.timestamp.getTime();this._serializedXML=this._DOM.xml;delete this._DOM},wasUnserialized:function(){if(this._serializedXML&&this._serializedXML.length){this._DOM=jabberwerx.util.unserializeXML(this._serializedXML);delete this._serializedXML}this.timestamp=this.timestamp?new Date(this.timestamp):new Date},timestamp:null,_DOM:null},"jabberwerx.Stanza");jabberwerx.Stanza.ErrorInfo=jabberwerx.JWModel.extend({init:function(e,t,r){this._super();this.type=e||"wait";this.condition=t||"{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error";this.text=r||"";this.toString=this._toErrString},getNode:function(){var e=new jabberwerx.NodeBuilder("error");e.attribute("type",this.type);e.element(this.condition);if(this.text){e.element("{urn:ietf:params:xml:ns:xmpp-stanzas}text").text(this.text)}return e.data},wasUnserialized:function(){this.toString=this._toErrString},_toErrString:function(){return this.condition},type:"",condition:"",text:""},"jabberwerx.Stanza.ErrorInfo");jabberwerx.Stanza.ErrorInfo.createWithNode=function(e){if(!jabberwerx.isElement(e)){throw new TypeError("node must be an Element")}e=jabberwerx.$(e);var t=e.attr("type");var r=e.children("[xmlns=urn:ietf:params:xml:ns:xmpp-stanzas]:not(text)").map(function(){return"{urn:ietf:params:xml:ns:xmpp-stanzas}"+this.nodeName}).get(0);var n=e.children("text[xmlns=urn:ietf:params:xml:ns:xmpp-stanzas]").text();return new jabberwerx.Stanza.ErrorInfo(t,r,n)};jabberwerx.Stanza.ERR_BAD_REQUEST=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}bad-request");jabberwerx.Stanza.ERR_CONFLICT=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}conflict");jabberwerx.Stanza.ERR_FEATURE_NOT_IMPLEMENTED=new jabberwerx.Stanza.ErrorInfo("cancel","{urn:ietf:params:xml:ns:xmpp-stanzas}feature-not-implemented");jabberwerx.Stanza.ERR_FORBIDDEN=new jabberwerx.Stanza.ErrorInfo("auth","{urn:ietf:params:xml:ns:xmpp-stanzas}forbidden");jabberwerx.Stanza.ERR_INTERNAL_SERVER_ERROR=new jabberwerx.Stanza.ErrorInfo("wait","{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error");jabberwerx.Stanza.ERR_ITEM_NOT_FOUND=new jabberwerx.Stanza.ErrorInfo("cancel","{urn:ietf:params:xml:ns:xmpp-stanzas}item-not-found");jabberwerx.Stanza.ERR_JID_MALFORMED=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}jid-malformed");jabberwerx.Stanza.ERR_NOT_ACCEPTABLE=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}not-acceptable");jabberwerx.Stanza.ERR_NOT_ALLOWED=new jabberwerx.Stanza.ErrorInfo("cancel","{urn:ietf:params:xml:ns:xmpp-stanzas}not-allowed");jabberwerx.Stanza.ERR_NOT_AUTHORIZED=new jabberwerx.Stanza.ErrorInfo("auth","{urn:ietf:params:xml:ns:xmpp-stanzas}not-authorized");jabberwerx.Stanza.ERR_SERVICE_UNAVAILABLE=new jabberwerx.Stanza.ErrorInfo("wait","{urn:ietf:params:xml:ns:xmpp-stanzas}service-unavailable");jabberwerx.Stanza.ERR_REMOTE_SERVER_TIMEOUT=new jabberwerx.Stanza.ErrorInfo("wait","{urn:ietf:params:xml:ns:xmpp-stanzas}remote-server-timeout");jabberwerx.Stanza.createWithNode=function(e){if(!jabberwerx.isElement(e)){throw new TypeError("node must be an element")}var t;switch(e.nodeName){case"iq":t=new jabberwerx.IQ(e);break;case"message":t=new jabberwerx.Message(e);break;case"presence":t=new jabberwerx.Presence(e);break;default:t=new jabberwerx.Stanza(e);break}return t};jabberwerx.IQ=jabberwerx.Stanza.extend({init:function(e){if(e){if(!jabberwerx.isElement(e)){throw new TypeError("packet must be an &lt;iq/&gt; Element")}if(e.nodeName!="iq"){throw new TypeError("packet must be an &lt;iq/&gt; Element")}}this._super(e||"{jabber:client}iq")},getQuery:function(){return jabberwerx.$(this.getNode()).children(":not(error)").get(0)},setQuery:function(e){if(e&&!jabberwerx.isElement(e)){throw new TypeError("Node must be an element")}var t=jabberwerx.$(this.getNode()).children(":not(error)");t.remove();if(e){new jabberwerx.NodeBuilder(this.getNode()).node(e)}},reply:function(e){var t=this.swap();try{jabberwerx.$(t.getNode()).empty()}catch(r){var n=t.getNode();for(var i=0;i<n.childNodes.length;i++){n.removeChild(n.childNodes[i])}}if(e){var a=new jabberwerx.NodeBuilder(t.getNode());if(jabberwerx.isElement(e)){a.node(e)}else if(typeof e=="string"){a.xml(e)}else{throw new TypeError("payload must be an Element or XML representation of an Element")}}t.setType("result");return t}},"jabberwerx.IQ");jabberwerx.Message=jabberwerx.Stanza.extend({init:function(e){if(e){if(!jabberwerx.isElement(e)){throw new TypeError("Must be a <message/> element")}if(e.nodeName!="message"){throw new TypeError("Must be a <message/> element")}}this._super(e||"{jabber:client}message")},getBody:function(){return this._getChildText("body")},setBody:function(e){this.setHTML();this._setChildText("body",e||undefined)},getHTML:function(){var e=jabberwerx.$(this.getNode()).find("html[xmlns=http://jabber.org/protocol/xhtml-im]>body[xmlns=http://www.w3.org/1999/xhtml]:first");if(e.length&&!this._isSanitized){this.setHTML(e.children().get());return this.getHTML()}return e.length?e.get(0):null},setHTML:function(e){if(e&&!jabberwerx.util.isString(e)&&!jabberwerx.isElement(e)&&(!jabberwerx.$.isArray(e)||!e.length)){throw new TypeError("html must be a string, DOM or an array")}this._isSanitized=false;var t=jabberwerx.$(this.getNode()).find("html[xmlns=http://jabber.org/protocol/xhtml-im]");if(t){t.remove()}this._setChildText("body");if(e){if(jabberwerx.util.isString(e)){e=jabberwerx.util.unserializeXML(e)}if(jabberwerx.$.isArray(e)){var r=new jabberwerx.NodeBuilder("{http://www.w3.org/1999/xhtml}body");jabberwerx.$.each(e,function(e,t){r.node(t)});e=r.data}else if(e.nodeName!="body"){e=jabberwerx.util.unserializeXML("<body xmlns='http://www.w3.org/1999/xhtml'>"+e.xml+"</body>")}jabberwerx.xhtmlim.sanitize(e);t=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/xhtml-im}html").node(e).parent.data;jabberwerx.$(this.getNode()).append(t.cloneNode(true));this._setChildText("body",jabberwerx.$(t).text());this._isSanitized=true}},getSubject:function(){return this._getChildText("subject")},setSubject:function(e){this._setChildText("subject",e||undefined)},getThread:function(){return this._getChildText("thread")||null},setThread:function(e){this._setChildText("thread",e||undefined)},_isSanitized:false},"jabberwerx.Message");jabberwerx.Message.translate=function(e,t){var r=false;var n=false;var i=null;var a=function(e,t){if(!r&&!n){if(jabberwerx.isText(e)){var i=s(jabberwerx.$(e).text(),t);if(r){jabberwerx.$(e).replaceWith(i)}else{n=true}}else if(e.hasChildNodes()){for(var o=0;o<e.childNodes.length;o++){a(e.childNodes[o],t)}}}};var s=function(e,t){var n="/me ";if(e.substring(0,n.length).toLowerCase()==n){r=true;return"* "+t+" "+e.substring(n.length)}return e};if(typeof e=="string"){e=s(e,t)}else if(jabberwerx.isElement(e)){for(var o=0;o<e.childNodes.length;o++){if(!r&&!n){a(e.childNodes[o],t)}else{break}}}else{throw new jabberwerx.Message.InvalidContentFormat}if(r){i=e}return i};jabberwerx.Message.InvalidContentFormat=jabberwerx.util.Error.extend("The content parameter must be of type string or a jQuery object.");jabberwerx.Presence=jabberwerx.Stanza.extend({init:function(e){if(e){if(!jabberwerx.isElement(e)){throw new TypeError("packet must be a &lt;presence/&gt; Element")}if(e.nodeName!="presence"){throw new TypeError("packet must be a &lt;presence/&gt; Element")}}this._super(e||"{jabber:client}presence")},getPriority:function(){var e=this._getChildText("priority");e=e?parseInt(e):0;return!isNaN(e)?e:0},setPriority:function(e){if(e!==undefined&&e!==null&&typeof e!="number"){throw new TypeError("new priority must be a number or undefined")}this._setChildText("priority",e)},getShow:function(){return this._getChildText("show")||jabberwerx.Presence.SHOW_NORMAL},setShow:function(e){if(e&&(e!=jabberwerx.Presence.SHOW_AWAY&&e!=jabberwerx.Presence.SHOW_CHAT&&e!=jabberwerx.Presence.SHOW_DND&&e!=jabberwerx.Presence.SHOW_XA)){throw new TypeError("show must be undefined or one of 'away', 'chat', 'dnd', or 'xa'")}this._setChildText("show",e||undefined)},getStatus:function(){return this._getChildText("status")||null},setStatus:function(e){this._setChildText("status",e||undefined)},compareTo:function(e){if(!(e&&e instanceof jabberwerx.Presence)){throw new TypeError("presence must be an instanceof jabberwerx.Presence")}var t,r;t=this.getPriority()||0;r=e.getPriority()||0;if(t>r){return 1}else if(t<r){return-1}t=this._showStrToInt(this.getType()||this.getShow());r=this._showStrToInt(e.getType()||e.getShow());if(t>r){return 1}else if(t<r){return-1}t=this.timestamp;r=e.timestamp;if(t>r){return 1}else if(t<r){return-1}return 0},_showStrToInt:function(e){e=e?e:"";switch(e){case"chat":return 5;case"":return 4;case"away":return 3;case"xa":return 2;case"dnd":return 1;case"unavailable":return 0;default:return-1}},setPresence:function(e,t,r){if(e){this.setShow(e)}if(t){this.setStatus(t)}if(r!==undefined&&r!==null){this.setPriority(r)}return this}},"jabberwerx.Presence");jabberwerx.Presence.SHOW_AWAY="away";jabberwerx.Presence.SHOW_CHAT="chat";jabberwerx.Presence.SHOW_DND="dnd";jabberwerx.Presence.SHOW_NORMAL="";jabberwerx.Presence.SHOW_XA="xa"}if(jabberwerx){jabberwerx.User=jabberwerx.Entity.extend({init:function(e,t){this._super({jid:e},t)}},"jabberwerx.User");jabberwerx.LocalUser=jabberwerx.User.extend({getDisplayName:function(){return this._displayName||jabberwerx.JID.unescapeNode(this.jid.getNode())}},"jabberwerx.LocalUser")}if(jabberwerx){jabberwerx.Stream=jabberwerx.JWModel.extend({init:function(){this.applyEvent("streamOpened");this.applyEvent("streamClosed");this.applyEvent("streamElementsReceived");this.applyEvent("streamElementsSent");this._recvQ=new jabberwerx.Stream.Queue;this._sendQ=new jabberwerx.Stream.Queue;this._xhrs=new jabberwerx.Stream.Queue;this._xhrSetup={cache:false,complete:this.invocation("_handleXHR"),contentType:"text/xml",dataType:"text",global:false,processData:false,type:"POST"}},getProperties:function(){return jabberwerx.$.extend(true,{},this._boshProps)},isOpen:function(){return this._opened},isSecure:function(){return this._boshProps.secure||false},getDomain:function(){return this._boshProps.domain||null},getSessionID:function(){return this._boshProps.sid||null},getTimeout:function(){return this._boshProps.timeout||60},open:function(e){if(this.isOpen()){throw new jabberwerx.Stream.AlreadyOpenError}this._reset();this._boshProps=jabberwerx.$.extend({},e||{});if(!this._boshProps.domain){throw new TypeError("domain must be specified")}if(!this._boshProps.timeout){this._boshProps.timeout=jabberwerx.Stream.DEFAULT_TIMEOUT}if(!this._boshProps.wait){this._boshProps.wait=jabberwerx.Stream.DEFAULT_WAIT}var t=/^(?:(?:([0-9a-zA-Z]+\:)\/\/)?([0-9a-zA-Z\.\-]+(?:\:[0-9]+)?))?(?:\/(.*))?$/.exec(this._boshProps.httpBindingURL||"");if(!t){throw new TypeError("httpBindingURL not specified correctly")}if(!t[1]){t[1]=document.location.protocol}if(!t[2]){t[2]=document.location.host}if(!t[3]){t[3]=""}this._boshProps.httpBindingURL=t[1]+"//"+t[2]+"/"+t[3];this._boshProps.secure=this._boshProps.secure||t[1]=="https:";this._boshProps.networkAttempts=0;this._boshProps.operation="open";this._sendRequest();this._boshProps.heartbeat=setInterval(this.invocation("_heartbeat"),jabberwerx.Stream.HEARTBEAT_INTERVAL)},reopen:function(){if(!this.isOpen()){throw new jabberwerx.Stream.NotOpenError}this._boshProps.opening=setTimeout(this.invocation("_handleOpen"),2e3);this._boshProps.operation="reopen";this._sendRequest({restart:true})},close:function(){if(this.isOpen()){this._sendRequest({type:"terminate"})}this._reset()},send:function(e){if(!jabberwerx.isElement(e)){throw new TypeError("elem must be a DOM element")}if(!this.isOpen()){throw new jabberwerx.Stream.NotOpenError}this._sendQ.enque(e)},_sendRequest:function(e,t){e=jabberwerx.$.extend({},this._boshProps,e);t=t||[];var r=0,n;var i=false;if(e.resend){r=e.resend.id;n=jabberwerx.util.unserializeXML(e.resend.body);i=true;t=jabberwerx.$(n).children();this._boshProps.rid=r+1;delete this._boshProps.resend}else{if(this._xhrs.size()>1&&t.length){this._sendQ.enque(t);return}if(!this._boshProps.rid){var a;a=Math.floor(Math.random()*4294967296);a=a<=32768?a+32768:a;this._boshProps.rid=a}else if(this._boshProps.rid>=9007199254740991){var s=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}policy-violation","BOSH maximum rid exceeded");this._handleClose(er.getNode());return}r=this._boshProps.rid++;n=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/httpbind}body");if(e.type){n.attribute("type",e.type);this._boshProps.type=e.type}if(!this._boshProps.sid){if(t.length){this._sendQ.enque(t);t=[]}n.attribute("xmlns:xmpp","urn:xmpp:xbosh").attribute("hold","1").attribute("ver","1.9").attribute("to",e.domain).attribute("secure",e.secure).attribute("wait",e.wait||30).attribute("{urn:xmpp:xbosh}xmpp:version","1.0")}else{n.attribute("sid",this._boshProps.sid);if(e.restart){n.attribute("{urn:xmpp:xbosh}xmpp:restart","true").attribute("to",e.domain);this._boshProps.restart=true}}n.attribute("rid",r);if(t.length){for(var o=0;o<t.length;o++){n.node(t[o])}}n=n.data}if(!this._boshProps.requests){this._boshProps.requests=new jabberwerx.Stream.Queue}this._boshProps.requests.enque({id:r,body:n.xml});var l={async:!(e.type=="terminate"),data:this._boshProps.requests.tail().body,timeout:this._boshProps.wait*1e3+5e3,url:this._boshProps.httpBindingURL};l=jabberwerx.$.extend(l,this._xhrSetup);var u=jabberwerx.$.ajax(l);if(l.async){this._xhrs.enque(u)}if(!i&&t.length){this.event("streamElementsSent").trigger(jabberwerx.$(t))}},_heartbeat:function(){var e=this._recvQ.empty();if(e.length){e=jabberwerx.$(e);this.event("streamElementsReceived").trigger(e)}if(!this.isOpen()&&!this._boshProps.operation){return}if(!this._sendQ.size()&&this._xhrs.size()){return}this._sendRequest({},this._sendQ.empty())},_handleXHR:function(e,t){if(this._dehydrated){return}this._xhrs.deque(e);var r=function(e,t){if(!this._boshProps){return}if(this._boshProps.type=="terminate"){return}if(this._boshProps.networkAttempts++<3){jabberwerx.util.debug.log("network timeout retry "+this._boshProps.networkAttempts);if(t){t=this._boshProps.requests.deque()}if(t){this._boshProps.resend=t}return}this._handleClose(e&&e.getNode())};if(t!="success"){var n;switch(t){case"timeout":n=jabberwerx.Stream.ERR_REMOTE_SERVER_TIMEOUT;break;case"error":n=jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE;break;case"parseerror":n=jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED;break;default:n=jabberwerx.Stream.ERR_UNDEFINED_CONDITION;break}r.call(this,n,true);return}var i=e.responseText;if(!i){r.call(this,jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED);return}try{i=jabberwerx.util.unserializeXML(i)}catch(a){r.call(this,jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED);return}if(!i){r.call(this,jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED);return}i=jabberwerx.$(i);if(!i.is("body[xmlns='http://jabber.org/protocol/httpbind']")){r.call(this,jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE);return}this._boshProps.networkAttempts=0;if(this._boshProps&&this._boshProps.requests){this._boshProps.requests.deque()}var s=i.children();if(!this._boshProps.sid){var o;o=i.attr("sid");if(o){this._boshProps.sid=o}o=i.attr("wait");if(o){this._boshProps.wait=parseInt(o)}o=i.attr("inactivity");if(o){this._boshProps.timeout=parseInt(o)}}else if(!this._boshProps.restart&&i.attr("ack")){var l=this._boshProps.rid-1;var u=parseInt(i.attr("ack"));var c=this._boshProps.requests.find(function(e){return e.id==u?e:null});var n;if(l!=u&&l+1!=u){if(c){jabberwerx.util.debug.log("resending unacknowledged rid "+u);this._boshProps.requests.deque(c);this._sendRequest({resend:c})}else{jabberwerx.util.debug.log("acknowledged rid "+u+" outside accepted window ("+l+".."+(l+1)+")!");this._handleClose(jabberwerx.Stream.ERR_REMOTE_CONNECTION_FAILED.getNode());return}}}if(s.length){var h=null,n=null;s=s.map(function(){switch(this.nodeName){case"stream:features":h=this;break;case"stream:error":n=this;break;default:return this}return null});if(h){this._handleOpen(h)}if(s.length){this._recvQ.enque(s.get())}if(n){this._handleClose(n);return}}var n;switch(i.attr("type")||this._boshProps.type){case"terminate":if(!this._boshProps.type){switch(i.attr("condition")||""){case"":n=null;break;case"bad-request":n=jabberwerx.Stream.ERR_BAD_REQUEST;break;case"host-gone":n=jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE;break;case"other-request":n=jabberwerx.Stream.ERR_CONFLICT;break;case"policy-violation":n=jabberwerx.Stream.ERR_POLICY_VIOLATION;break;case"system-shutdown":n=jabberwerx.Stream.ERR_SYSTEM_SHUTDOWN;break;default:n=jabberwerx.Stream.ERR_UNDEFINED_CONDITION;break}}this._handleClose(n&&n.getNode());return;case"error":break}},_handleOpen:function(e){if(this._boshProps.opening){clearTimeout(this._boshProps.opening);delete this._boshProps.opening}delete this._boshProps.restart;delete this._boshProps.operation;if(!jabberwerx.isElement(e)){e=new jabberwerx.NodeBuilder("{http://etherx.jabber.org/streams}stream:features");e.element("{urn:ietf:params:xml:ns:xmpp-bind}bind");e.element("{urn:ietf:params:xml:ns:xmpp-session}session");e=e.data}var t=this;setTimeout(function(){t._opened=true;t.event("streamOpened").trigger(e)},1)},_handleClose:function(e){var t=this.isOpen();var r=this._boshProps.operation;this._reset();if(t||r){var n=this;setTimeout(function(){n.event("streamClosed").trigger(e)},1)}},_reset:function(){clearInterval(this._boshProps.heartbeat);this._opened=false;this._boshProps={};this._sendQ.empty();this._xhrs.empty()},willBeSerialized:function(){this._dehydrated=true;if(this._boshProps&&this._boshProps.networkAttempts){this._boshProps.networkAttempts--}if(this.isOpen()){clearInterval(this._boshProps.heartbeat)}var e;e=this._sendQ.empty();e=jabberwerx.$.map(e,function(){return this.xml});this._sendQ.enque(e);e=this._recvQ.empty();e=jabberwerx.$.map(e,function(){return this.xml});this._recvQ.empty();delete this._xhrs},wasUnserialized:function(){this._xhrs=new jabberwerx.Stream.Queue;var e;e=this._sendQ.empty();e=jabberwerx.$.map(e,function(){return jabberwerx.util.unserializeXML(String(this))});this._sendQ.enque(e);delete this._dehydrated;if(this.isOpen()){this._boshProps.resend=this._boshProps.requests.deque();this._boshProps.heartbeat=setInterval(this.invocation("_heartbeat"),jabberwerx.Stream.HEARTBEAT_INTERVAL)}},_opened:false,_boshProps:{},_xhrSetup:{},_xhrs:null,_sendQ:null,_recvQ:null},"jabberwerx.Stream");jabberwerx.Stream.Queue=jabberwerx.JWModel.extend({init:function(){this._super()},head:function(){return this._q||null},tail:function(){return this._q[this._q.length-1]||null},enque:function(e){for(var t=0;t<arguments.length;t++){e=arguments[t];var r=[this._q.length,0].concat(e);this._q.splice.apply(this._q,r)}return this.size()},deque:function(e){if(e!==undefined){var t=jabberwerx.$.inArray(e,this._q);if(t!=-1){this._q.splice(t,1)}else{e=null}}else{e=this._q.shift()||null}return e},find:function(e){if(!jabberwerx.$.isFunction(e)){throw new TypeError("comparator must be a function")}var t=null;jabberwerx.$.each(this._q,function(){t=e(this);return t!==undefined});return t},empty:function(){var e=this._q;this._q=[];return e},size:function(){return this._q.length},_q:[]},"jabberwerx.Stream.Queue");jabberwerx.Stream.DEFAULT_TIMEOUT=300;jabberwerx.Stream.DEFAULT_WAIT=30;jabberwerx.Stream.HEARTBEAT_INTERVAL=10;jabberwerx.Stream.NotOpenError=jabberwerx.util.Error.extend("Stream not open");jabberwerx.Stream.AlreadyOpenedError=jabberwerx.util.Error.extend("Stream is already open");jabberwerx.Stream.ErrorInfo=jabberwerx.JWModel.extend({init:function(e,t){this._super();this.condition=e||"{urn:ietf:params:xml:ns:xmpp-streams}undefined-condition";this.text=t||"";this.toString=this._toErrString},getNode:function(){var e=new jabberwerx.NodeBuilder("{http://etherx.jabber.org/streams}stream:error");e.element(this.condition);if(this.text){e.element("{urn:ietf:params:xml:ns:xmpp-streams}text").text(this.text)}return e.data},wasUnserialized:function(){this.toString=this._toErrString;
},_toErrString:function(){return this.condition},condition:"",text:""},"jabberwerx.Stream.ErrorInfo");jabberwerx.Stream.ErrorInfo.createWithNode=function(e){if(!jabberwerx.isElement(e)){throw new TypeError("node must be an Element")}e=jabberwerx.$(e);var t=e.children("[xmlns=urn:ietf:params:xml:ns:xmpp-streams]:not(text)").map(function(){return"{urn:ietf:params:xml:ns:xmpp-streams}"+this.nodeName}).get(0);var r=e.children("text[xmlns=urn:ietf:params:xml:ns:xmpp-streams]").text();return new jabberwerx.Stream.ErrorInfo(t,r)};jabberwerx.Stream.ERR_BAD_REQUEST=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}bad-request");jabberwerx.Stream.ERR_CONFLICT=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}conflict");jabberwerx.Stream.ERR_POLICY_VIOLATION=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}policy-violation");jabberwerx.Stream.ERR_REMOTE_CONNECTION_FAILED=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}remote-connection-failed");jabberwerx.Stream.ERR_REMOTE_SERVER_TIMEOUT=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}remote-server-timeout");jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}service-unavailable");jabberwerx.Stream.ERR_SYSTEM_SHUTDOWN=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}system-shutdown");jabberwerx.Stream.ERR_UNDEFINED_CONDITION=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}undefined-condition");jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}xml-not-well-formed")}if(jabberwerx){jabberwerx.ClientEntityCache=jabberwerx.EntitySet.extend({init:function(){this._super()},_batchCount:0,startBatch:function(){var e=this._batchCount;this._batchCount++;if(e==0){this.event("batchUpdateStarted").trigger()}return e!=0},endBatch:function(){var e=true;switch(this._batchCount){case 0:e=false;break;case 1:e=false;this.event("batchUpdateEnded").trigger();default:this._batchCount--;break}return e},register:function(e){if(!(e&&e instanceof jabberwerx.Entity)){throw new TypeError("entity is not an Entity")}var t=this.entity(e.jid,e.node);if(t&&t!==e){throw new jabberwerx.EntitySet.EntityAlreadyExistsError}else if(!t){this.event("entityCreated").trigger(e)}return this._super(e)},unregister:function(e){var t=this._super(e);if(t){this.event("entityDestroyed").trigger(e)}return t},localUser:function(e){var t=this.entity(e);if(!(t&&t instanceof jabberwerx.LocalUser)){t=new jabberwerx.LocalUser(e,this);this.register(t)}return t},server:function(e){var t=this.entity(e);if(!t||!(t instanceof jabberwerx.Server)){t=new jabberwerx.Server(e,this);this.register(t)}return t},temporaryEntity:function(e){var t=this.entity(e);if(!(t&&t instanceof jabberwerx.TemporaryEntity)){t=new jabberwerx.TemporaryEntity(e,this);this.register(t)}return t}},"jabberwerx.ClientEntityCache");jabberwerx.Client=jabberwerx.JWModel.extend({init:function(resourceName){this._super();this.applyEvent("clientStatusChanged");this.applyEvent("beforeIqSent");this.applyEvent("iqSent");this.applyEvent("beforeIqReceived");this.applyEvent("iqReceived");this.applyEvent("afterIqReceived");this.applyEvent("beforeMessageSent");this.applyEvent("messageSent");this.applyEvent("beforeMessageReceived");this.applyEvent("messageReceived");this.applyEvent("afterMessageReceived");this.applyEvent("beforePresenceSent");this.applyEvent("presenceSent");this.applyEvent("beforePresenceReceived");this.applyEvent("presenceReceived");this.applyEvent("afterPresenceReceived");this.applyEvent("reconnectCountdownStarted");this.applyEvent("reconnectCancelled");this.entitySet=new jabberwerx.ClientEntityCache;if(resourceName&&typeof resourceName=="string"){this.resourceName=resourceName}else{this._autoResourceName=true}this._stream=new jabberwerx.Stream;with(this.event("afterIqReceived")){bindWhen('iq[type="get"] *[xmlns="urn:xmpp:time"]',this.invocation("_handleEntityTime"));bindWhen('iq[type="get"] *[xmlns="jabber:iq:time"]',this.invocation("_handleIqTime"))}this.event("presenceReceived").bind(this.invocation("_handlePresenceIn"));var discoController=new jabberwerx.DiscoController(this);var capController=new jabberwerx.CapabilitiesController(this);if(jabberwerx._config.capabilityFeatures){for(var i=0;i<jabberwerx._config.capabilityFeatures.length;i++){capController.addFeature(jabberwerx._config.capabilityFeatures[i])}}if(jabberwerx._config.capabilityIdentity){capController.identity.category=jabberwerx._config.capabilityIdentity.category;capController.identity.type=jabberwerx._config.capabilityIdentity.type;capController.identity.name=jabberwerx._config.capabilityIdentity.name;capController.node=jabberwerx._config.capabilityIdentity.node}},destroy:function(){jabberwerx.$.each(this.controllers,function(){this.destroy()});this._super()},_setStreamHandler:function(e,t){this._clearStreamHandler(e);this._streamHandlers[e]=t;this._stream.event(e).bind(this.invocation(this._streamHandlers[e]))},_clearStreamHandler:function(e){if(this._streamHandlers[e]!==undefined){this._stream.event(e).unbind(this.invocation(this._streamHandlers[e]));delete this._streamHandlers[e]}},_clearStreamHandlers:function(){this._clearStreamHandler("streamOpened");this._clearStreamHandler("streamClosed");this._clearStreamHandler("streamElementsReceived");this._clearStreamHandler("streamElementsSent");this._streamHandlers={}},connect:function(e,t,r){var n=arguments.callee.inProgress||{};if(n[this]){jabberwerx.util.debug.log("client.connect already in progress!");return}n[this]=true;arguments.callee.inProgress=n;var i=function(e){var t;jabberwerx.$.each(e.entitySet.toArray(),function(){if(this instanceof jabberwerx.LocalUser){if(e._connectParams.jid.equals(this.jid)){t=this}else{this.remove()}}});e.connectedUser=t||e.entitySet.localUser(e._connectParams.jid);var r;jabberwerx.$.each(e.entitySet.toArray(),function(){if(this instanceof jabberwerx.Server){if(e._connectParams.jid.getDomain()==this.jid.getDomain()){r=this}else{this.remove()}}});e.connectedServer=r||e.entitySet.server(e._connectParams.jid.getDomain())};var a=function(e){var t=e._connectParams.arg.successCallback;var r=e._connectParams.arg.errorCallback;if(t||r){var n=function(i){var a=i.data.next==jabberwerx.Client.status_connected;var s=i.data.next==jabberwerx.Client.status_disconnected;if(a||s){e.event("clientStatusChanged").unbind(n);if(t&&a){t(e)}else if(r&&i.data.error&&s){r(i.data.error)}}};e.event("clientStatusChanged").bind(n)}};if(this.clientStatus!=jabberwerx.Client.status_disconnected){jabberwerx.util.debug.log("client not disconnected!");delete n[this];return}if(!r){r={}}this.cancelReconnect();this._clearStreamHandlers();this._stream.close();try{var s=jabberwerx.JID.asJID(e);if(!s.getNode()){r.register=true;s=new jabberwerx.JID({domain:s.getDomain(),node:"CAXL_"+jabberwerx.util.crypto.generateUUID()});if(!t){t=jabberwerx.util.crypto.b64_sha1(jabberwerx.util.crypto.generateUUID())}}this._connectParams={jid:s,password:t,username:s.getNode(),domain:s.getDomain(),resource:this.resourceName,httpBindingURL:r.httpBindingURL||jabberwerx._config.httpBindingURL,secure:r.unsecureAllowed||jabberwerx._config.unsecureAllowed||false,timeout:r.timeout||null,wait:r.wait||null,arg:r};this._openStream();i(this);a(this);if(this._connectParams.arg.reconnecting){this.setClientStatus(jabberwerx.Client.status_reconnecting);this._connectParams.arg.reconnecting=false}else{this.setClientStatus(jabberwerx.Client.status_connecting)}this._connectionAttempts++}catch(o){this._connectParams={};throw new jabberwerx.Client.ConnectionError(o.message||"invalid connection information")}finally{delete n[this]}},_openStream:function(){if(this._connectParams.arg.register){this._setStreamHandler("streamOpened","_handleRegistrationOpened")}else{this._setStreamHandler("streamOpened","_handleAuthOpened")}this._setStreamHandler("streamClosed","_handleClosed");var e={domain:this._connectParams.domain,timeout:this._connectParams.timeout,wait:this._connectParams.wait,secure:this._connectParams.secure,httpBindingURL:this._connectParams.httpBindingURL};try{this._stream.open(e)}catch(t){this._clearStreamHandlers();throw t}},_handleRegistrationOpened:function(){try{this._clearStreamHandler("streamOpened");var e=new jabberwerx.IQ;e.setType("set");e.setID("register");var t=new jabberwerx.NodeBuilder("{jabber:iq:register}query");t=t.element("username").text(this._connectParams.username).parent;t=t.element("password").text(this._connectParams.password).parent;e.setQuery(t.data);this._setStreamHandler("streamElementsReceived","_handleRegisterElements");this._stream.send(e.getNode())}catch(r){this._handleConnectionException(r)}},_handleRegisterElements:function(e){try{this._clearStreamHandler("streamElementsReceived");var t=jabberwerx.$(e.data).find("error");if(t&&t.length!=0){this._connectParams.arg.register=false;this._handleConnectionException(t)}else{this._stream.close()}}catch(r){this._handleConnectionException(r)}},_handleAuthOpened:function(e){try{this._clearStreamHandler("streamOpened");this._connectParams.feats=jabberwerx.$(e.data);var t=[];jabberwerx.$(e.data).find("mechanisms[xmlns='urn:ietf:params:xml:ns:xmpp-sasl']>mechanism").each(function(){t.push(jabberwerx.$(this).text().toUpperCase())});this._authMech=jabberwerx.sasl.createMechanismFor(this,t);if(!this._authMech){throw new jabberwerx.Client.ConnectionError("{urn:ietf:params:xml:ns:xmpp-sasl}mechanism-too-weak")}this._setStreamHandler("streamElementsReceived","_handleAuthElements");this._handleAuthElements()}catch(r){this._handleConnectionException(r)}},_handleAuthElements:function(e){try{e=e&&jabberwerx.$(e.data).get(0);e=this._authMech.evaluate(e);if(e){this._stream.send(e)}else{var t=this._authMech.complete;this._authMech=undefined;delete this._authMech;if(!t){throw new jabberwerx.SASLMechanism.SASLAuthFailure}else{this._setStreamHandler("streamOpened","_handleBindOpened");this._stream.reopen()}}}catch(r){this._handleConnectionException(r)}return true},_handleBindOpened:function(e){try{this._clearStreamHandler("streamOpened");this._connectParams.bindJID=null;e=jabberwerx.$(e.data);this._connectParams.feats=e;if(e.find("bind[xmlns='urn:ietf:params:xml:ns:xmpp-bind']").length>0){var t=new jabberwerx.IQ;t.setType("set");t.setID("resource-bind");var r=new jabberwerx.NodeBuilder("{urn:ietf:params:xml:ns:xmpp-bind}bind");if(this.resourceName){r=r.element("resource").text(this._connectParams.resource).parent}t.setQuery(r.data);this._setStreamHandler("streamElementsReceived","_handleBindElements");this._stream.send(t.getNode())}else{this._connected()}}catch(n){this._handleConnectionException(n)}},_handleBindElements:function(e){try{var t=jabberwerx.$(e.data);var r=t.find("bind>jid");if(r.length>0){this._connectParams.bindJID=jabberwerx.$(r).text();var n=jabberwerx.JID.asJID(this._connectParams.bindJID);this.resourceName=n.getResource();if(this._connectParams.feats.find("session[xmlns='urn:ietf:params:xml:ns:xmpp-session']").length>0){var i=new jabberwerx.IQ;i.setType("set");i.setID("session");i.setQuery(new jabberwerx.NodeBuilder("{urn:ietf:params:xml:ns:xmpp-session}session").data);this._setStreamHandler("streamElementsReceived","_handleSessionElements");this._stream.send(i.getNode())}else{this._connected()}}else{this._handleConnectionException(t.children("error").get(0))}}catch(a){this._handleConnectionException(a)}},_handleSessionElements:function(e){try{var t=jabberwerx.$(e.data);if(t.attr("type")=="result"){this._connected()}else{this._handleConnectionException(t.children("error").get(0))}}catch(r){this._handleConnectionException(r)}},_handleClosed:function(e){var t="closed: "+(e&&e.data?jabberwerx.util.serializeXML(e.data):"no error");jabberwerx.util.debug.log(t);if(this._connectParams.arg.register){this._connectParams.arg.register=false;this._openStream()}else{this._disconnected(e.data)}},_handleConnectionException:function(e){this._clearStreamHandlers();try{this._stream.close()}catch(t){}var r=this._exceptionToErrorNode(e);jabberwerx.util.debug.log("Exception during connection: "+jabberwerx.util.serializeXML(r));this._disconnected(r)},_exceptionToErrorNode:function(e){if(jabberwerx.isElement(e)){return e}var t=new jabberwerx.NodeBuilder("error");if(e instanceof jabberwerx.SASLMechanism.SASLAuthFailure){t.element(e.message)}else if(e instanceof TypeError){t.element("{urn:ietf:params:xml:ns:xmpp-stanzas}bad-request");if(e.message){t.element("text").text(e.message)}}else{var r=jabberwerx.$(e).find("conflict");if(r&&r.length!=0){var n=jabberwerx.$(r).attr("xmlns");t.element("{"+n+"}conflict")}else{var i=e&&e.message?e.message:"{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error";try{t.element(i)}catch(a){t.element("{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error");t.element("text").text(i)}}}return t.data},disconnect:function(){if(this.isConnected()){if(this._autoResourceName){this.resourceName=null}this.setClientStatus(jabberwerx.Client.status_disconnecting);this._stream.close();this._connectionAttempts=0}},isConnected:function(){return this.clientStatus==jabberwerx.Client.status_connected},setClientStatus:function(e,t){var r=this.clientStatus;this.clientStatus=e;if(r&&r!=e){var n={previous:r,next:e,error:t};this.event("clientStatusChanged").trigger(n)}jabberwerx.util.debug.log("client status: "+this.getClientStatusString(e),"clientStatus")},getClientStatusString:function(e){switch(e){case jabberwerx.Client.status_connected:return"Connected to "+(this.connectedServer?this.connectedServer.jid:"(unknown)")+" as "+(this.connectedUser?this.connectedUser.jid:"(unknown)");case jabberwerx.Client.status_connecting:return"Attempting to connect ...";case jabberwerx.Client.status_error:return"Connection error. ";case jabberwerx.Client.status_disconnected:return"Disconnected. ";case jabberwerx.Client.status_disconnecting:return"Disconnecting. ";case jabberwerx.Client.status_reconnecting:return"Reconnecting. "}},getCurrentPresence:function(e){var t=this.connectedUser;return t&&(e?t.getPrimaryPresence():t.getResourcePresence(this.resourceName))||null},sendStanza:function(e,t,r,n){var i;if(e instanceof jabberwerx.Stanza){i=e.clone()}else if(jabberwerx.isElement(e)){i=jabberwerx.Stanza.createWithNode(e)}else{i=new jabberwerx.Stanza(e);if(r){i.setTo(r.toString())}if(t){i.setType(t.toString())}if(n){if(typeof n=="string"){n=jabberwerx.util.unserializeXML(n)}new jabberwerx.NodeBuilder(i.getNode()).node(n)}i=jabberwerx.Stanza.createWithNode(i.getNode())}t=i.pType();this.event("before"+t+"Sent").trigger(i);this._stream.send(i.getNode());if(i instanceof jabberwerx.Presence){var a=i;var t=a.getType();if((!t||t=="unavailable")&&!a.getTo()){a=a.clone();a.setFrom(this.connectedUser.jid+"/"+this.resourceName);this.connectedUser.updatePresence(a)}}},sendMessage:function(to,body,subject,type,thread){this._assertConnected();var m=new jabberwerx.Message;if(to instanceof jabberwerx.Entity){to=to.jid.toString()}m.setTo(new jabberwerx.JID(to));m.setBody(body);if(subject){m.setSubject(subject)}if(thread){m.setThread(thread)}if(type){m.setType(type)}if(type==="undefined"||type=="chat"){with(new jabberwerx.NodeBuilder(m.getNode())){element("{http://jabber.org/protocol/xhtml-im}html").element("{http://www.w3.org/1999/xhtml}body").text(body)}}this.sendStanza(m)},_iqStamp:0,sendIQ:function(e,t,r,n,i){return this.sendIq.apply(this,arguments)},sendIq:function(e,t,r,n,i){if(n!==undefined&&!jabberwerx.$.isFunction(n)){throw new TypeError("callback must be a function")}var a=new jabberwerx.IQ;var s="iq"+(new Date).valueOf()+this._iqStamp++;if(e){a.setType(e)}if(t){a.setTo(t)}a.setID(s);if(r){if(typeof r=="string"){r=jabberwerx.util.unserializeXML(r)}new jabberwerx.NodeBuilder(a.getNode()).node(r)}if(n){var o=this;var l=undefined;var u=function(e){var t=e.data;if(jabberwerx.isDocument(t)){t=t.documentElement}else if(t instanceof jabberwerx.Stanza){t=t.getNode()}t=jabberwerx.$(t);if(t.attr("id")!=s){return}if(t.attr("type")!="result"&&t.attr("type")!="error"){return}n(t.get()[0]);e.notifier.unbind(arguments.callee);if(l){window.clearTimeout(l);l=undefined}};if(i instanceof Number&&i>0){var c=function(){if(l){o.event("beforeIqReceived").unbind(u);n()}};l=window.setTimeout(c,i*1e3)}var h='[id="'+s+'"]';this.event("beforeIqReceived").bind(u)}this.sendStanza(a);return s},sendPresence:function(e,t,r){var n=new jabberwerx.Presence;if(typeof e=="string"){n.setShow(e)}if(typeof t=="string"){n.setStatus(t)}if(r!=="undefined"){n.setTo(r)}this.sendStanza(n)},selectNodes:function(e,t){var r=e;jabberwerx.util.debug.log("running jquery with selector: "+t+" on doc:\n\n"+r.xml,"stanzaSelectors");var n=jabberwerx.$(t,r);var i=[];n.each(function(){i.push(this)});if(i.length==1){return i[0]}if(i.length==0){return null}return i},getAllPresenceForEntity:function(e){var t=[];if(!(e instanceof jabberwerx.JID)){e=new jabberwerx.JID(e)}var r=this.entitySet.entity(e.getBareJIDString());if(r){if(!e.getResource()){t=r.getAllPresence()}else{t=[r.getResourcePresence(e.getResource())]}}return t},getPrimaryPresenceForEntity:function(e){if(!(e instanceof jabberwerx.JID)){e=new jabberwerx.JID(e)}var t=this.entitySet.entity(e.getBareJIDString());if(t){if(e.getResource()){return t.getResourcePresence(e.getResource())}else{return t.getPrimaryPresence()}}return null},_handlePresenceIn:function(e){var t;var r=e.data;var n=r.getType();if(!n||n=="unavailable"){var i=r.getFromJID().getBareJIDString();if(i){if(r.getType()=="unavailable"){t=this.entitySet.entity(i);if(t){t.updatePresence(r)}}else{t=this._findOrCreateEntity(i);t.updatePresence(r)}}}},_findOrCreateEntity:function(e){var t=this.entitySet.entity(e);if(!t){t=this.entitySet.temporaryEntity(e)}return t},_removeAllTemporaryEntities:function(){var e=this.entitySet.toArray();jabberwerx.$.each(e,function(){if(this instanceof jabberwerx.TemporaryEntity){this.remove()}return true})},willBeSerialized:function(){if(this._connectParams&&this._connectParams.password){if(jabberwerx._config.baseReconnectCountdown==0){this._connectParams.password=""}else{this._connectParams.password=jabberwerx.util.encodeSerialization(this._connectParams.password)}}},wasUnserialized:function(){if(this._connectParams&&this._connectParams.password){this._connectParams.password=jabberwerx.util.decodeSerialization(this._connectParams.password)}},_assertConnected:function(){if(!this.isConnected()){throw new jabberwerx.Client.NotConnectedError}},_connected:function(){if(jabberwerx._config.baseReconnectCountdown==0){this._connectParams.password=""}this._clearStreamHandler("streamOpened");this._setStreamHandler("streamElementsReceived","_handleElementsReceived");this._setStreamHandler("streamElementsSent","_handleElementsSent");if(this._connectParams.bindJID){var e=jabberwerx.JID.asJID(this._connectParams.bindJID);if(!e.getBareJID().equals(this.connectedUser.jid)){this.entitySet._renameEntity(this.connectedUser,e)}this.resourceName=e.getResource()}this._connectParams.bindJID=null;this.setClientStatus(jabberwerx.Client.status_connected);if(!this.getCurrentPresence()){this.sendPresence()}},_handleDisconnect:function(){if(this.connectedUser){var e=new jabberwerx.Presence;e.setFrom(this.connectedUser.jid+"/"+this.resourceName);e.setType("unavailable");this.connectedUser.updatePresence(e)}this._disconnected()},_disconnected:function(e){if(jabberwerx._config.baseReconnectCountdown==0){this._connectParams.password="";delete this._connectParams.password}if(e&&this.clientStatus!=jabberwerx.Client.status_disconnecting&&this.clientStatus!=jabberwerx.Client.status_connecting&&jabberwerx.$("system-shutdown, conflict",e).length==0){this._startReconnectCountdown()}this._clearStreamHandlers();if(this.connectedUser){this.connectedUser.updatePresence()}this.connectedUser=null;this.connectedServer=null;this._authMech=undefined;delete this._authMech;this._removeAllTemporaryEntities();if(this._autoResourceName&&!this._countDownOn){this.resourceName=null}this.setClientStatus(jabberwerx.Client.status_disconnected,e)},_handleElementsReceived:function(e){var t=jabberwerx.$(e.data);for(var r=0;r<t.length;++r){this._handleElementIn(t.get(r))}},_handleElementsSent:function(e){var t=jabberwerx.$(e.data);for(var r=0;r<t.length;++r){this._handleElementOut(t.get(r))}},cancelReconnect:function(){if(this._reconnectTimerID!==null){clearTimeout(this._reconnectTimerID);this._reconnectTimerID=null;this._countDownOn=false;this.event("reconnectCancelled").trigger()}},isSecure:function(){return this._stream.isSecure()},_startReconnectCountdown:function(){var e=jabberwerx._config.baseReconnectCountdown;if(e>0){var t=e+Math.round((Math.random()-.5)*e/5);this._reconnectTimerID=setTimeout(this.invocation("_reconnectTimeoutHandler"),t*1e3);this._countDownOn=true;this.event("reconnectCountdownStarted").trigger(t)}},_reconnectTimeoutHandler:function(){this._countDownOn=false;this._reconnectTimerID=null;this._connectParams.arg.reconnecting=true;this.connect(this._connectParams.jid,this._connectParams.password,this._connectParams.arg)},_handleElementOut:function(e){e=jabberwerx.Stanza.createWithNode(e);var t=e.pType();this.event(t+"Sent").trigger(e)},_handleElementIn:function(e){e=jabberwerx.Stanza.createWithNode(e);e.setTo(e.getToJID());e.setFrom(e.getFromJID());var t=e.pType();var r=[this.event("before"+t+"Received"),this.event(t+"Received"),this.event("after"+t+"Received")];var n=jabberwerx.reduce(r,function(t,r){r=Boolean(r||false);if(!r){var n=t.trigger(e);if(n){for(var i=0;i<n.length;i++){r=r||Boolean(n[i])}}}return r});if(!n&&t=="iq"&&(e.getType()=="get"||e.getType()=="set")){e=e.errorReply(jabberwerx.Stanza.ERR_FEATURE_NOT_IMPLEMENTED);this.sendStanza(e)}},_handleIqTime:function(evt){var now=new Date;var tz;tz=now.toString();tz=tz.substring(tz.lastIndexOf(" ")+1);var iq=evt.data;iq=iq.reply();with(new jabberwerx.NodeBuilder(iq.getQuery())){element("display").text(now.toLocaleString());element("utc").text(jabberwerx.generateTimestamp(now,true));element("tz").text(tz)}this.sendStanza(iq);return true},_handleEntityTime:function(evt){var now=new Date;var tzo;with(now){var h,m;tzo=getTimezoneOffset();h=tzo/60;m=tzo%60;tzo=(tzo>0?"-":"+")+(h<10?"0"+h:h)+":"+(m<10?"0"+m:m)}var iq=evt.data;iq=iq.reply();with(new jabberwerx.NodeBuilder(iq.getChild())){element("tzo").text(tzo);element("utc").text(jabberwerx.generateTimestamp(now,false))}this.sendStanza(iq);return true},_generateUsername:function(){return hex_md5(this._guid+(this._connectionAttempts+(new Date).valueOf))},_generatePassword:function(e){return hex_md5(e+(window.innerHeight+window.innerWidth))},controllers:{},resourceName:null,connectedUser:null,_stream:null,_streamHandlers:[],clientStatus:3,connectedServer:null,entitySet:null,autoRegister:false,_connectionAttempts:0,_reconnectTimerID:null,_connectParams:{},_autoResourceName:false,_countDownOn:false},"jabberwerx.Client");jabberwerx.Client.status_connecting=1;jabberwerx.Client.status_connected=2;jabberwerx.Client.status_disconnected=3;jabberwerx.Client.status_disconnecting=4;jabberwerx.Client.status_reconnecting=5;jabberwerx.Client.NotConnectedError=jabberwerx.util.Error.extend("The client is not connected.");jabberwerx.Client.ConnectionError=jabberwerx.util.Error.extend();jabberwerx.Client.DisconnectError=jabberwerx.util.Error.extend()}if(jabberwerx){jabberwerx.MUCOccupant=jabberwerx.Entity.extend({init:function(e,t){if(!(e&&e instanceof jabberwerx.MUCRoom)){throw new TypeError("room must be a non-null instance of jabberwerx.MUCRoom")}if(!t){throw new TypeError("nick must be a non-empty string")}var r=new jabberwerx.JID({node:e.jid.getNode(),domain:e.jid.getDomain(),resource:t});this._super({jid:r},e.occupants);this.room=e;e.occupants.register(this)},getNickname:function(){return this.jid.getResource()},getDisplayName:function(){return this.getNickname()},setDisplayName:function(e){},updatePresence:function(e){if(!(e&&e instanceof jabberwerx.Presence)){throw new TypeError("must provide a valid non-subscription Presence")}if(e.getFrom()!=this.jid){throw new TypeError("presence not appropriate to this occupant")}var t=e.getType()||"";if(t&&t!="unavailable"){throw new TypeError("must provide a valid non-subscription Presence")}if(t=="unavailable"){this._presenceList.splice(0,1)}else if(this._presenceList.length){this._presenceList[0]=e}else{this._presenceList.push(e)}this.event("resourcePresenceChanged").trigger({fullJid:this.jid,presence:e,nowAvailable:false});this.event("primaryPresenceChanged").trigger({fullJid:this.jid,presence:e.getType()=="unavailable"?null:e});return true},isMe:function(){return this.room&&this.room.me==this},room:null},"jabberwerx.MUCOccupant");jabberwerx.MUCOccupantCache=jabberwerx.EntitySet.extend({init:function(e){if(!(e&&e instanceof jabberwerx.MUCRoom)){throw new TypeError("must provide a valid MUCRoom")}this._super();this.room=e},register:function(e){if(!(e&&e instanceof jabberwerx.MUCOccupant)){throw new TypeError("only MUCOccupants can be registered")}if(this._super(e)){this.event("entityCreated").trigger(e)}},unregister:function(e){if(!(e&&e instanceof jabberwerx.MUCOccupant)){throw new TypeError("only MUCOccupants can be registered")}if(this._super(e)){if(this.room.me===e){this.room.me=null}this.event("entityDestroyed").trigger(e)}},_clear:function(){var e=this;jabberwerx.$.each(this.toArray(),function(){e.unregister(this)})},rename:function(e,t){this._renameEntity(e,t,"")},occupant:function(e){if(!e){throw new TypeError("nickname must be a non-empty string")}var t=this.room.jid;t=new jabberwerx.JID({node:t.getNode(),domain:t.getDomain(),resource:e});return this.entity(t)},room:null},"jabberwerx.MUCOccupantCache");jabberwerx.MUCRoom=jabberwerx.Entity.extend({init:function(e,t){if(!(t&&t instanceof jabberwerx.MUCController)){throw new TypeError("MUCController must be provided")}this._super({jid:jabberwerx.JID.asJID(e).getBareJID()},t);this._state="offline";this.occupants=new jabberwerx.MUCOccupantCache(this);this.applyEvent("roomCreated");this.applyEvent("roomEntered");this.applyEvent("roomExited");this.applyEvent("errorEncountered");this.applyEvent("beforeRoomBroadcastSent");this.applyEvent("roomBroadcastSent");this.applyEvent("roomBroadcastReceived");this.applyEvent("beforeRoomSubjectChanging");this.applyEvent("roomSubjectChanging");this.applyEvent("roomSubjectChanged");if(this.controller.client){var r=this.controller.client;r.event("presenceReceived").bindWhen("presence[type=error][from^="+this.jid+"]",this.invocation("_handleRoomErrored"));r.event("messageReceived").bindWhen("message[from^="+this.jid+"]",this.invocation("_handleMessageReceived"));r.event("presenceSent").bindWhen("presence:not([to]):not([type])",this.invocation("_handlePresenceSent"))}},destroy:function(){this.exit();if(this.controller.client){var e=this.controller.client;e.event("presenceReceived").unbind(this.invocation("_handleRoomErrored"));e.event("messageReceived").unbind(this.invocation("_handleMessageReceived"));e.event("presenceSent").unbind(this.invocation("_handlePresenceSent"))}this._super()},getDisplayName:function(){return jabberwerx.JID.unescapeNode(this.jid.getNode())},setDisplayName:function(e){},enter:function(e,t){var r=t?jabberwerx.$.isFunction(t)?{successCallback:t,errorCallback:t}:t:{};if(t&&(r.successCallback&&!jabberwerx.$.isFunction(r.successCallback)||r.errorCallback&&!jabberwerx.$.isFunction(r.errorCallback)||r.configureCallback&&!jabberwerx.$.isFunction(r.configureCallback))){throw new TypeError("Defined callback must be a function")}if(!e||!jabberwerx.util.isString(e)){throw new TypeError("Nick must be a non-empty string")}if(!this.controller.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(this._state=="initializing"){throw new jabberwerx.MUCRoom.RoomActiveError}else if(this.isActive()){if(this.me&&this.me.getNickname()!=e){throw new jabberwerx.MUCRoom.RoomActiveError}if(r.successCallback){r.successCallback.call(this)}return}var n=this;this._state="initializing";var i=function(e){if(e.name=="roomcreated"){n._origApply=n.applyConfig;n.applyConfig=n._creationApply;if(r.configureCallback){r.configureCallback.call(n)}else{n.applyConfig(new jabberwerx.XDataForm("submit"))}}else{if(e.name=="errorencountered"){n._state="offline";n.exit();if(r.errorCallback){r.errorCallback.call(n,jabberwerx.Stanza.ErrorInfo.createWithNode(e.data.error),e.data.aborted)}}else if(e.name=="roomentered"&&r.successCallback){r.successCallback.call(n)}n.event("errorEncountered").unbind(arguments.callee);n.event("roomEntered").unbind(arguments.callee);n.event("roomCreated").unbind(arguments.callee)}};this.event("errorEncountered").bind(i);this.event("roomEntered").bind(i);this.event("roomCreated").bind(i);this.me=new jabberwerx.MUCOccupant(this,e);var a=this.controller.client.getCurrentPresence().clone();a.setTo(this.me.jid);var s=new jabberwerx.NodeBuilder(a.getNode());var o=s.element("{http://jabber.org/protocol/muc}x");if(t&&t.password){o.element("password").text(t.password)}this.controller.client.sendStanza(a)},exit:function(){if(this.isActive()&&this.controller.client.isConnected()){var e=new jabberwerx.Presence;e.setTo(this.me.jid);e.setType("unavailable");this.controller.client.sendStanza(e)}else if(this.me){if(this.isActive()){this._state="offline";this.event("roomExited").trigger()}this.me.remove()}},changeNickname:function(e,t){if(this.me&&this.me.getNickname()==e){return}if(!e){throw new TypeError("nickname must be a non-empty string")}if(t&&!jabberwerx.$.isFunction(t)){throw new TypeError("callback must be a function or undefined")}if(!this.isActive()){throw new jabberwerx.MUCRoom.RoomNotActiveError}var r=new jabberwerx.JID({node:this.jid.getNode(),domain:this.jid.getDomain(),resource:e});var n=this.controller.client.getCurrentPresence().clone();n.setTo(r);if(t){var i=this;var a=function(e){var r=e.name=="errorencountered"?e.data:undefined;if(r||e.name=="entityrenamed"&&e.data===i.me){t.call(i,r);i.event("errorEncountered").unbind(arguments.callee);i.occupants.event("entityRenamed").unbind(arguments.callee)}};this.event("errorEncountered").bind(a);this.occupants.event("entityRenamed").bind(a)}this.controller.client.sendStanza(n)},changeSubject:function(e,t){if(t&&!jabberwerx.$.isFunction(t)){throw new TypeError("callback must be a function or undefined")}if(!this.isActive()){throw new jabberwerx.MUCRoom.RoomNotActiveError}var r=new jabberwerx.Message;r.setTo(this.jid);r.setType("groupchat");r.setSubject(e||"");if(e!=null&&e!=""){r.setBody(jabberwerx.MUCRoom.DefaultSubjectChange+e)}if(t){var n=this;var i=function(e){var r=e.name=="errorencountered"?e.data:undefined;t.call(n,r);n.event("errorEncountered").unbind(arguments.callee);n.event("roomSubjectChanged").unbind(arguments.callee)};this.event("errorEncountered").bind(i);this.event("roomSubjectChanged").bind(i)}this.event("beforeRoomSubjectChanging").trigger(r);this.controller.client.sendStanza(r);this.event("roomSubjectChanging").trigger(r)},sendBroadcast:function(e){if(!e){return}if(!this.isActive()){throw new jabberwerx.MUCRoom.RoomNotActiveError}var t=new jabberwerx.Message;t.setTo(this.jid);t.setType("groupchat");if(jabberwerx.isElement(e)||jabberwerx.$.isArray(e)){t.setHTML(e)}else{t.setBody(e)}this.event("beforeRoomBroadcastSent").trigger(t);this.controller.client.sendStanza(t);this.event("roomBroadcastSent").trigger(t)},getPrimaryPresence:function(){if(this.me){return this.getResourcePresence(this.me.getNickname())}return null},isActive:function(){return Boolean(this._state=="active");return Boolean(this.getPrimaryPresence())},updatePresence:function(e){if(!(e&&e instanceof jabberwerx.Presence)){throw new TypeError("must provide a valid non-subscription Presence")}var t=e.getFromJID();if(t.getBareJIDString()!=this.jid){throw new TypeError("presence not appropriate to this room")}var r=e.getType()||"";if(r&&r!="unavailable"){throw new TypeError("must provide a valid non-subscription Presence")}var n=jabberwerx.$(e.getNode()).children("x[xmlns^=http://jabber.org/protocol/muc]");
var i=n.children("item");var a=n.children("status");var s=this.occupants.entity(t);var o=s&&s.isMe();this._removePresenceFromList(t);switch(r){case"":this._presenceList.push(e);if(!s){s=new jabberwerx.MUCOccupant(this,t.getResource())}var l=s.getAllPresence().length;s.updatePresence(e);if(s.isMe()&&l==0){if(n.children("status[code=201]").length==1){this.event("roomCreated").trigger();return}else{this._state="active";this.event("roomEntered").trigger()}}break;case"unavailable":if(s&&s.getPrimaryPresence()!==null){if(a.attr("code")=="303"){var u=i.attr("nick");var c=s.nick;var h=new jabberwerx.JID({node:this.jid.getNode(),domain:this.jid.getDomain(),resource:u});var f=e.clone();this.occupants.rename(s,h);o=false}else{var d=s.isMe();s.updatePresence(e);if(d){this._state="offline";this.event("roomExited").trigger();this.occupants._clear();this._presenceList=[]}s.destroy()}}break}this.event("resourcePresenceChanged").trigger({fullJid:t,presence:e,nowAvailable:false});if(o){this.event("primaryPresenceChanged").trigger({fullJid:r!="unavailable"?t:this.jid,presence:r!="unavailable"?e:null})}return o},invite:function(e,t,r){if(!this.isActive()){throw new jabberwerx.MUCRoom.RoomNotActiveError}var n=[];if(!t){t=jabberwerx.MUCRoom.DefaultInviteReason}if(!e){e=[]}else if(!jabberwerx.$.isArray(e)){e=[e]}var i=new jabberwerx.Message;var a=function(e){return i};if(r){i.setTo(this.jid);var s=new jabberwerx.NodeBuilder(i.getNode()).element("{http://jabber.org/protocol/muc#user}x").element("invite");s.element("reason").text(t);a=function(e){s.attribute("to",e.toString());return i}}else{new jabberwerx.NodeBuilder(i.getNode()).element("{jabber:x:conference}x").attribute("reason",t).attribute("jid",this.jid.getBareJID().toString());a=function(e){i.setTo(e);return i}}for(var o=0;o<e.length;o++){try{var l=jabberwerx.JID.asJID(e[o]).getBareJID();this.controller.client.sendStanza(a(l));n.push(l)}catch(u){if(!(u instanceof jabberwerx.JID.InvalidJIDError)){throw u}}}return n},fetchConfig:function(e){if(!jabberwerx.$.isFunction(e)){throw new TypeError("fetchConfig requires a callback function")}if(this._state=="offline"){throw new jabberwerx.MUCRoom.RoomNotActiveError}var t=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/muc#owner}query").data;this.controller.client.sendIQ("get",this.jid,t,function(t){if(!t){e(null,jabberwerx.Stanza.ERR_REMOTE_SERVER_TIMEOUT)}else{var r=new jabberwerx.IQ(t);if(r.isError()){e(null,r.getErrorInfo())}else{var n=jabberwerx.$("x",r.getNode()).get(0);if(!n){e(null,jabberwerx.Stanza.ERR_SERVICE_UNAVAILABLE)}else{e(new jabberwerx.XDataForm(null,n))}}}})},applyConfig:function(e,t){if(e&&!(e instanceof jabberwerx.XDataForm)){throw new TypeError("configForm must be null or an XDataForm")}if(t&&!jabberwerx.$.isFunction(t)){throw new TypeError("A defined configCallback must be a function")}if(this._state=="offline"){throw new jabberwerx.MUCRoom.RoomNotActiveError}var r=!e||e.getType()=="cancel";if(r&&t){t()}var n=this;var i=r?function(e){}:function(e){var r;if(!e){r=jabberwerx.Stanza.ERR_REMOTE_SERVER_TIMEOUT}else{r=new jabberwerx.IQ(e).getErrorInfo()}if(t){t(r)}};e=e?e:new jabberwerx.XDataForm("cancel");var a=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/muc#owner}query");a.node(e.getDOM().data);this.controller.client.sendIQ("set",this.jid,a.data,i)},_handlePresenceSent:function(e){if(this.isActive()){var t=e.data.clone();t.setTo(this.me.jid);this.controller.client.sendStanza(t)}},_handleRoomErrored:function(e){var t=e.data;var r=jabberwerx.$(t.getNode()).children("error").get(0);var n="";switch(t.pType()){case"message":if(t.getSubject()){n="changeSubject"}else if(t.getBody()){n="sendBroadcast"}break;case"presence":if(this.isActive()){n="changeNickname"}else{n="enter"}break}if(r){this.event("errorEncountered").trigger({operation:n,error:r})}return true},_handleMessageReceived:function(e){var t=e.data;switch(t.getType()){case"error":this._handleRoomErrored(e);break;case"groupchat":{var r=t.getSubject();if(r!==null){this.properties.subject=r;this.update();this.event("roomSubjectChanged").trigger(t)}else{var n=jabberwerx.$.trim(t.getBody());if(n){this.event("roomBroadcastReceived").trigger(t)}}}break;case"chat":if(this.controller.client){var i=this.occupants.entity(t.getFrom());var a=this.controller.client.controllers.chat;if(a){if(!a.getSession(i.jid)){var s=a.openSession(i.jid);s.event("chatReceived").trigger(t)}}}break;default:break}return true},_creationApply:function(e,t){if(!e||e.getType()=="cancel"){this.applyConfig=this._origApply;delete this._origApply;if(t){t()}this.applyConfig(e);var r=new jabberwerx.Presence;r.setTo(this.me.jid);r.setType("unavailable");this.controller.client.sendStanza(r);this.occupants._clear();this._presenceList=[];this.event("errorEncountered").trigger({operation:"enter",error:jabberwerx.Stanza.ERR_BAD_REQUEST.getNode(),aborted:true})}else{var n=this;this._origApply.call(this,e,function(e){if(t){t(e)}if(!e){n.applyConfig=n._origApply;delete n._origApply;n._state="active";n.event("roomEntered").trigger();n._presenceList[0];n.event("resourcePresenceChanged").trigger({fullJid:n.me.jid,presence:n._presenceList[0],nowAvailable:false});n.event("primaryPresenceChanged").trigger({fullJid:n.me.jid,presence:n._presenceList[0]})}})}},_state:"offline",occupants:null,me:null},"jabberwerx.MUCRoom");jabberwerx.MUCRoom.RoomActiveError=jabberwerx.util.Error.extend("room already active");jabberwerx.MUCRoom.RoomNotActiveError=jabberwerx.util.Error.extend("room is not active");jabberwerx.MUCRoom.DefaultInviteReason="You have been invited to a conference room.";jabberwerx.MUCRoom.DefaultSubjectChange="/me has changed the subject to: "}if(jabberwerx){jabberwerx.Server=jabberwerx.Entity.extend({init:function(e,t){this._super({jid:e},t)}},"jabberwerx.Server")}if(jabberwerx){jabberwerx.Contact=jabberwerx.User.extend({init:function(e,t){this._super(e,t)}},"jabberwerx.Contact");jabberwerx.RosterContact=jabberwerx.Contact.extend({init:function(e,t){if(!(t&&t instanceof jabberwerx.RosterController)){throw new TypeError("roster must be provided")}this._super(jabberwerx.$(e).attr("jid"),t);this._initializing=true;this.setItemNode(e);this._initializing=false},setItemNode:function(e){if(!(e&&jabberwerx.isElement(e))){throw new TypeError("node cannot be null")}if(this._node!==e){this._node=e;e=jabberwerx.$(e);var t=this.properties.subscription;this.properties.subscription=e.attr("subscription")||"";this.properties.ask=e.attr("ask")||"";this.properties.name=e.attr("name")||"";var r=this.properties.subscription;if(!(!t||t=="from"||t=="none")&&(!r||r=="from"||r=="none")){this.updatePresence()}else if(!(!r||r=="from"||r=="none")&&!this.getPrimaryPresence()){var n=new jabberwerx.Presence;n.setType("unavailable");var i=jabberwerx.JID.asJID(e.attr("jid")).getBareJID();n.setFrom(i);this.updatePresence(n)}this._displayName=this.properties.name;this._groups=e.children("group").map(function(){return jabberwerx.$(this).text()}).get()||[];if(!this._initializing&&this._eventing["updated"]){this._eventing["updated"].trigger(this)}}},getItemNode:function(){return this._node},getDisplayName:function(){return this.properties.name||this._super()},setDisplayName:function(e){if(e!=this._displayName){this.controller.updateContact(this.jid,e,this.getGroups())}},setGroups:function(e){this.controller.updateContact(this.jid,this.properties.name,e)},remove:function(){this.controller.deleteContact(this.jid)},_handleUnavailable:function(e){if(this.properties.subscription=="both"||this.properties.subscription=="to"||this.properties.temp_sub){var t=this.getPrimaryPresence();if(!t){this._insertPresence(e)}else if(t.getType()=="unavailable"){this._clearPresenceList();this._insertPresence(e)}}},_node:null},"jabberwerx.RosterContact")}(function(){if(jabberwerx){jabberwerx.TemporaryEntity=jabberwerx.Entity.extend({init:function(e,t){this._super({jid:e},t)}},"jabberwerx.TemporaryEntity")}})();if(jabberwerx){jabberwerx.ErrorReporter=jabberwerx.JWBase.extend({init:function(){this._super()},getMessage:function(e){if(e){if(jabberwerx.isElement(e)){var t;var r;for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeName=="text"){r=jabberwerx.$(i).text()}else{var a="{"+i.getAttribute("xmlns")+"}"+i.nodeName;t=this._errorMap[a];if(t){return t}}}if(r){return r}}else if(e.message){var t=this._errorMap[e.message];if(t){return t}}}return this._errorMap[""]},addMessage:function(e,t){if(!t||typeof t!="string"){throw new TypeError("value must be a string.")}if(e){this._errorMap[e]=t}},_errorMap:{"":"Operation failed","{urn:ietf:params:xml:ns:xmpp-streams}conflict":"This resource is logged in elsewhere.","{urn:ietf:params:xml:ns:xmpp-stanzas}bad-request":"The request was not valid.","{urn:ietf:params:xml:ns:xmpp-stanzas}conflict":"Conflicting names were encountered.","{urn:ietf:params:xml:ns:xmpp-stanzas}feature-not-implemented":"This feature is not yet implemented. Sorry for the inconvenience.","{urn:ietf:params:xml:ns:xmpp-stanzas}forbidden":"You are not authorized to perform this action.","{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error":"An unknown server error occurred. Contact your administrator.","{urn:ietf:params:xml:ns:xmpp-stanzas}item-not-found":"The requested item could not be found.","{urn:ietf:params:xml:ns:xmpp-stanzas}jid-malformed":"The JID is not valid.","{urn:ietf:params:xml:ns:xmpp-stanzas}not-acceptable":"The given information was not acceptable.","{urn:ietf:params:xml:ns:xmpp-stanzas}not-allowed":"You are not allowed to perform this action.","{urn:ietf:params:xml:ns:xmpp-stanzas}not-authorized":"You are not authorized to perform this action.","{urn:ietf:params:xml:ns:xmpp-stanzas}undefined-condition":"An unknown error occurred. Contact your administrator.","{urn:ietf:params:xml:ns:xmpp-stanzas}unexpected-request":"Did not expect the request at this time.","{urn:ietf:params:xml:ns:xmpp-stanzas}registration-required":"You must register with the service before continuing.","{urn:ietf:params:xml:ns:xmpp-stanzas}remote-server-not-found":"Could not find the requested server.","{urn:ietf:params:xml:ns:xmpp-stanzas}remote-server-timeout":"Unable to contact the server.","{urn:ietf:params:xml:ns:xmpp-stanzas}service-unavailable":"This service is not available. Try again later.","{urn:ietf:params:xml:ns:xmpp-sasl}temporary-auth-failure":"Unable to login. Check username and password.","{urn:ietf:params:xml:ns:xmpp-sasl}mechanism-too-weak":"You are not authorized to perform this action."}},"jabberwerx.ErrorReporter");jabberwerx.errorReporter=new jabberwerx.ErrorReporter}(function(){if(jabberwerx){jabberwerx.ChatSession=jabberwerx.JWModel.extend({init:function(e,t,r){this._super();this._statesReady=false;if(e instanceof jabberwerx.Client){this.client=e;this.controller=e.controllers.chat||new jabberwerx.ChatController(e)}else{throw new TypeError("client must be a jabberwerx.Client")}this.jid=jabberwerx.JID.asJID(t);if(!r){r=this._generateRandomThreadValue()}this.thread=r;this.applyEvent("beforeChatSent");this.applyEvent("chatSent");this.applyEvent("chatReceived");this.applyEvent("threadUpdated");this.applyEvent("chatStateChanged");this.applyEvent("lockedResourceChanged");this.privateMessage=this.controller.isPrivateMessage(this.jid);if(this.privateMessage){this._MUCController=e.controllers.muc||new jabberwerx.MUCController(e)}this._bindHandlers();var n=this.invocation("_entityChangedHandler");this._getEntitySet().event("entityCreated").bind(n);this._getEntitySet().event("entityDestroyed").bind(n);if(this.privateMessage){this._getEntitySet().event("entityRenamed").bind(this.invocation("_entityRenamedHandler"))}},_bindHandlers:function(){var e=this.privateMessage?this.jid.toString():this.jid.getBareJIDString();var t=this.invocation("_chatReceivedHandler");this.client.event("messageReceived").bindWhen("message[from^='"+e+"'][type!='groupchat']",t);this._handlerList.push({event:"messageReceived",handler:t});t=this.invocation("_remoteStateChangedHandler");this.client.event("messageReceived").bindWhen("message[from^='"+e+"'][type='chat'] *[xmlns='http://jabber.org/protocol/chatstates']",t);this._handlerList.push({event:"messageReceived",handler:t});t=this.invocation("_presenceChangeHandler");this.client.event("presenceReceived").bindWhen(this.invocation("_presenceReceivedFilter"),t);this._handlerList.push({event:"presenceReceived",handler:t})},_getEntitySet:function(){if(this.privateMessage){return this._MUCController.room(this.jid).occupants}else{return this.client.entitySet}},getEntity:function(){if(!this._entity){if(this.privateMessage){this._entity=this._getEntitySet().entity(this.jid)}else{var e=this.jid.getBareJID();this._entity=this._getEntitySet().entity(e)||new jabberwerx.TemporaryEntity(e,this._getEntitySet())}}return this._entity},_entityChangedHandler:function(e){if(this.privateMessage&&this.jid.toString()!=e.data.jid.toString()){return}if(this.jid.getBareJIDString()!=e.data.jid.getBareJIDString()){return}switch(e.name.substring("entity".length)){case"destroyed":this._entity=undefined;break;case"created":this._entity=e.data;break}},_entityRenamedHandler:function(e){if(e.data.jid&&e.data.jid==this.jid){this.jid=e.data.entity.jid;this._unbindHandlers();this._bindHandlers()}},sendMessage:function(e){if(!e){return}this._statesReady=true;var t=this._generateMessage("active",e);this.localState="active";this.event("chatStateChanged").trigger({jid:null,state:this.localState});this.event("beforeChatSent").trigger(t);this.client.sendStanza(t);this.event("chatSent").trigger(t)},setChatState:function(e){var t=false;if(this._setChatStateProperty(e)){t=true;var r=this._generateMessage(e);if(r&&this.client.isConnected()){this.client.sendStanza(r)}}return t},_setChatStateProperty:function(e){var t=false;if(jabberwerx.$.inArray(e,["active","composing","paused","inactive","gone"])>=0){if(e!=this.localState){this.localState=e;this.event("chatStateChanged").trigger({jid:null,state:this.localState});t=true}}else{var r=new jabberwerx.ChatSession.StateNotSupportedError("The chat state '"+e+"' is not supported. Should be one of 'active', 'composing',"+"'paused', 'inactive' or 'gone'");throw r}return t},destroy:function(){this._unbindHandlers();var e=this.invocation("_entityChangedHandler");this._getEntitySet().event("entityCreated").unbind(e);this._getEntitySet().event("entityDestroyed").unbind(e);if(this.privateMessage){this._getEntitySet().event("entityRenamed").unbind(this.invocation("_entityRenamedHandler"))}this.setChatState("gone");this.controller.closeSession(this);this._super()},_unbindHandlers:function(){var e=this.client;jabberwerx.$.each(this._handlerList,function(){e.event(this.event).unbind(this.handler)})},_generateMessage:function(e,t){if(!this._statesReady){return null}var r=null;if(t){r=new jabberwerx.Message;r.setThread(this.thread);if(jabberwerx.isElement(t)||jabberwerx.$.isArray(t)){r.setHTML(t)}else{r.setBody(t)}}if(this.controller.sendChatStates){r=r||new jabberwerx.Message;var n=new jabberwerx.NodeBuilder(r.getNode());n.element("{http://jabber.org/protocol/chatstates}"+e)}if(r){r.setType("chat");r.setTo(this.jid)}return r},_chatReceivedHandler:function(e){var t=e.data;this._updateLockedResource(t.getFromJID());this._updateThread(t.getThread());this._statesReady=!t.isError();if(t.getBody()||t.isError()){this.event("chatReceived").trigger(t)}return false},_updateLockedResource:function(e){if(this.privateMessage){return}if(e.getResource()!=this.jid.getResource()){this.jid=e;this.event("lockedResourceChanged").trigger(this.jid)}},_updateThread:function(e){if(e&&e!=this.thread){this.thread=e;this.event("threadUpdated").trigger({jid:this.jid,thread:this.thread})}},_remoteStateChangedHandler:function(e){var t=e.selected;if(this.remoteState!=t.nodeName){this.remoteState=t.nodeName;this.event("chatStateChanged").trigger({jid:this.jid,state:this.remoteState});if(this.remoteState=="gone"){this._updateLockedResource(e.data.getFromJID().getBareJID());this.thread=this._generateRandomThreadValue()}}return false},_presenceChangeHandler:function(e){this._updateLockedResource(e.data.getFromJID().getBareJID());return false},_generateRandomThreadValue:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var t=10;var r="";for(var n=0;n<t;n++){var i=Math.floor(Math.random()*e.length);r+=e.substring(i,i+1)}return"JW_"+r},_presenceReceivedFilter:function(e){var t=e.getType();var r=this.privateMessage?e.getFromJID().toString():e.getFromJID().getBareJIDString();var n=this.privateMessage?this.jid.toString():this.jid.getBareJIDString();if(r==n&&(!t||t=="unavailable")){return e}return false},jid:null,thread:null,localState:null,remoteState:null,client:null,controller:null,privateMessage:false,_handlerList:[]},"jabberwerx.ChatSession");jabberwerx.ChatSession.StateNotSupportedError=jabberwerx.util.Error.extend()}})();if(jabberwerx){jabberwerx.PrivacyList=jabberwerx.JWModel.extend({init:function(e,t){this._super();if(!jabberwerx.isElement(e)){throw new TypeError("listNode must be an Element")}this._DOM=jabberwerx.$(e);if(!(t&&t instanceof jabberwerx.PrivacyListController)){throw new TypeError("controller must be a PrivacyListController")}this.controller=t},destroy:function(){this.controller._remove(this.getName());this._super()},getName:function(){return this._DOM.attr("name")},getBlockedJids:function(){var e=function(){var e=jabberwerx.$(this);if(e.attr("type")!="jid"){return null}if(e.attr("action")!="deny"){return null}return jabberwerx.JID.asJID(e.attr("value"))};return this._DOM.children().map(e).get()},blockJid:function(e){e=jabberwerx.JID.asJID(e).getBareJIDString();var t=this._DOM.find("item[type=jid][value="+e+"]");if(!this._cleanDOM){this._cleanDOM=jabberwerx.$(this._DOM.get(0).cloneNode(true))}if(!t.length){t=new jabberwerx.NodeBuilder(this._DOM.get(0)).element("item").attribute("action","deny").attribute("type","jid").attribute("value",e);t=jabberwerx.$(t.data)}else{t.attr("action","deny");t.empty();t.remove()}this._DOM.prepend(t);this._updateDirty(e,this._blocked,this._unblocked)},unblockJid:function(e){e=jabberwerx.JID.asJID(e).getBareJIDString();var t=this._DOM.find("item[type=jid][value="+e+"]");if(t.length){if(!this._cleanDOM){this._cleanDOM=jabberwerx.$(this._DOM.get(0).cloneNode(true))}t.remove();this._updateDirty(e,this._unblocked,this._blocked)}},_update:function(e){this._DOM=jabberwerx.$(e);this._blocked=[];this._unblocked=[]},_updateDirty:function(e,t,r){var n=function(t){for(var r=0;r<t.length;r++){if(t[r]==e){return r}}return-1};var i;i=n(r);if(i!=-1){r.splice(i,0)}i=n(t);if(i==-1){t.push(e)}},update:function(e){if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}var t=this._DOM.children();if(!t.length){new jabberwerx.NodeBuilder(this._DOM.get(0)).element("item").attribute("action","allow");t=this._DOM.children()}t.each(function(e){jabberwerx.$(this).attr("order",e)});var r=this.controller;var n=r.client;var i=new jabberwerx.Presence;i.setType("unavailable");for(var a=0;a<this._blocked.length;a++){var s=this._blocked[a];var o=n.entitySet.entity(s);if(!o){continue}if(!o.getPrimaryPresence()){continue}i.setTo(s);n.sendStanza(i)}var l=this._blocked;var u=this._unblocked;var c=this;var h=function(t){var i=n.getCurrentPresence().clone();i.setFrom();i.setTo();switch(t.name){case"errorencountered":if(l.length){n.sendStanza(i)}if(e){e.call(c,t.data.error)}break;case"privacylistupdated":if(u.length){n.sendStanza(i)}if(e){e.call(c)}break}r.event("errorEncountered").unbind(arguments.callee);r.event("privacyListUpdated").unbind(arguments.callee)};r.event("errorEncountered").bindWhen(function(e){return e.target===c?c:null},h);r.event("privacyListUpdated").bindWhen(function(e){return e===c?c:null},h);var f=new jabberwerx.NodeBuilder("{jabber:iq:privacy}query");f=jabberwerx.$(f.data);f.append(this._DOM.get(0).cloneNode(true));n.sendIq("set",null,f.get(0),function(e){var t;if(!e){t=jabberwerx.Stanza.ERR_REMOTE_SERVER_TIMEOUT}else{t=new jabberwerx.IQ(e).getErrorInfo()}if(t&&c._cleanDOM){c._DOM=c._cleanDOM;r.event("errorEncountered").trigger({operation:"update",target:c,error:t.getNode()})}delete c._cleanDOM})},remove:function(e){if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}if(e){var t=this.controller;var r=this;var n=function(n){var i=n.name=="errorencountered"?n.data.error:undefined;e.call(r,i);t.event("errorEncountered").unbind(arguments.callee);t.event("privacyListRemoved").unbind(arguments.callee)};t.event("errorEncountered").bindWhen(function(e){return e.target===r?r:null},n);t.event("privacyListRemoved").bindWhen(function(e){return e===r?r:null},n)}var i=new jabberwerx.NodeBuilder("{jabber:iq:privacy}query").element("list").attribute("name",this.getName()).parent;this.controller.client.sendIq("set",null,i.data)},willBeSerialized:function(){if(this._DOM){this._serializedXML=this._DOM.get(0).xml;delete this._DOM}},wasUnserialized:function(){if(this._serializedXML){this._DOM=jabberwerx.$(jabberwerx.util.unserializeXML(this._serializedXML));delete this._serializedXML}},_blocked:[],_unblocked:[],_DOM:null},"jabberwerx.PrivacyList")}if(jabberwerx){jabberwerx.PubSubItem=jabberwerx.JWModel.extend({init:function(e){this._super();this._update(e)},destroy:function(){this._super()},willBeSerialized:function(){this.timestamp=this.timestamp.getTime()},wasUnserialized:function(){this.timestamp=new Date(this.timestamp)},_update:function(e){e=jabberwerx.$(e);var t;t=e.attr("publisher");this.publisher=t?jabberwerx.JID.asJID(t):null;t=e.attr("timestamp");this.timestamp=t?jabberwerx.parseTimestamp(t):new Date;this.id=e.attr("id");this.data=e.children().get(0)},id:null,publisher:null,timestamp:null,data:null},"jabberwerx.PubSubItem");jabberwerx.PubSubNode=jabberwerx.Entity.extend({init:function(e,t,r){if(!t||typeof t!="string"){throw new TypeError("node must be a non-empty string")}if(r instanceof jabberwerx.PubSubNode){this.delegate=r;r=r.controller}if(!(r instanceof jabberwerx.PubSubController)){throw new TypeError("ctrl must be a jabberwerx.PubSubController or jabberwerx.PubSubNode")}this._super({jid:e,node:t},r);this.properties.items=[];this.properties.delegated={};this.applyEvent("pubsubNodeCreated");this.applyEvent("pubsubNodeDeleted");this.applyEvent("pubsubItemsChanged");this.applyEvent("errorEncountered");if(!this.delegate){this.controller.client.event("beforeMessageReceived").bindWhen("event[xmlns=http://jabber.org/protocol/pubsub#event]>*[node="+this.node+"]",this.invocation("_handleNotify"))}},destroy:function(){if(!this.delegate){this.controller.client.event("beforeMessageReceived").unbind(this.invocation("_handleNotify"))}if(this.properties.delegated){var e=this.controller.client;for(var t in this.properties.delegated){var r=e.entitySet.entity(t,this.node);if(r){r.destroy()}}}this._super()},getItems:function(){return jabberwerx.$.extend([],this.properties.items)},getDelegatedFor:function(e){if(this.delegate){throw new jabberwerx.PubSubNode.DelegatedNodeError}e=jabberwerx.JID.asJID(e).getBareJID();if(e.equals(this.jid)){return this}var t=this.controller.node(this.node,e);t.delegate=this;this.properties.delegated[e.toString()]=true;return t},subscribe:function(e){var t=this.controller.client;if(!t.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}if(this.properties.subscription||this.delegate){if(e){e.call(this)}return}var r=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}pubsub");r.element("subscribe").attribute("node",this.node).attribute("jid",t.connectedUser.jid);var n=this;t.sendIq("set",this.jid,r.data,function(t){var r=n._checkError(t);if(r){n.event("errorEncountered").trigger({operation:"subscribe",error:r})}else{n.properties.subscription="explicit";if(n.autoRetrieve){n.retrieve()}}if(e){e.call(n,r)}})},unsubscribe:function(e){if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}if(this.delegate){if(e){e.call(this)}return}var t=this.controller.client;if(!t.isConnected()){throw new jabberwerx.Client.NotConnectedError}var r=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}pubsub");r.element("unsubscribe").attribute("node",this.node).attribute("jid",t.connectedUser.jid);var n=this;t.sendIq("set",this.jid,r.data,function(t){var r=n._checkError(t);if(r){var i=jabberwerx.$(r).children("not-subscribed[xmlns=http://jabber.org/protocol/pubsub#errors]");if(!i.length){n.event("errorEncountered").trigger({operation:"unsubscribe",error:r})}r=undefined}delete n.properties.subscription;n._cleanItems();if(e){e.call(n,r)}})},retrieve:function(e){var t=this.controller.client;if(!t.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}var r=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}pubsub");r.element("items").attribute("node",this.node);var n=this;t.sendIq("get",this.jid,r.data,function(t){var r=n._checkError(t);if(r){n.event("errorEncountered").trigger({operation:"retrieve",error:r})}else{var i=jabberwerx.$(t).find("pubsub[xmlns=http://jabber.org/protocol/pubsub]>items");n._cleanItems();n.properties.items=[];n._updateItems(i)}if(e){e.call(n,r)}})},publish:function(e,t,r){if(this.delegate){throw new jabberwerx.PubSubNode.DelegatedError}var n=this.controller.client;if(!n.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(r&&!jabberwerx.$.isFunction(r)){throw new TypeError("callback must be undefined or a function")}if(t&&!jabberwerx.isElement(t)){throw new TypeError("payload must be undefined or an element")}var i=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}pubsub");var a=i.element("publish").attribute("node",this.node).element("item");if(e){a.attribute("id",e)}if(t){a.node(t)}var s=this;n.sendIq("set",this.jid,i.data,function(e){var t=s._checkError(e);if(t){s.event("errorEncountered").trigger({operation:"publish",error:t})}if(r){r.call(s,t)}})},retract:function(e,t){if(this.delegate){throw new jabberwerx.PubSubNode.DelegatedError}var r=this.controller.client;if(!r.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(!(e&&typeof e=="string")){throw new TypeError("id must be a non-empty string")}if(t&&!jabberwerx.$.isFunction(t)){throw new TypeError("callback must be undefined or a function")}var n=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}pubsub");var i=n.element("retract").attribute("node",this.node).element("item");i.attribute("id",e);var a=this;r.sendIq("set",this.jid,n.data,function(e){var r=a._checkError(e);if(r){a.event("errorEncountered").trigger({operation:"retract",error:r})}if(t){t.call(a,r)}})},_purge:function(e){if(this.delegate){throw new jabberwerx.PubSubNode.DelegatedError}var t=this.controller.client;if(!t.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}var r=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}pubsub");r.element("purge").attribute("node",this.node);var n=this;t.sendIq("set",this.jid,r.data,function(t){var r=n._checkError(t);if(r){n.event("errorEncountered").trigger({operation:"purge",error:r})}if(e){e.call(n,r)}})},createNode:function(e){if(this.delegate){throw new jabberwerx.PubSubNode.DelegatedNodeError}var t=this.controller.client;if(!t.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}var r=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}pubsub");r.element("create").attribute("node",this.node);var n=this;t.sendIq("set",this.jid,r.data,function(t){var r=n._checkError(t);if(r){n.event("errorEncountered").trigger({operation:"createNode",error:r})}else{n.event("pubsubNodeCreated").trigger()}if(e){e.call(n,r)}})},deleteNode:function(e){if(this.delegate){throw new jabberwerx.PubSubNode.DelegatedNodeError}var t=this.controller.client;if(!t.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}var r=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub#owner}pubsub");r.element("delete").attribute("node",this.node);this._deletePending=true;var n=this;t.sendIq("set",this.jid,r.data,function(t){var r=n._checkError(t);if(r){n.event("errorEncountered").trigger({operation:"deleteNode",error:r})}else{n._cleanItems();n.event("pubsubNodeDeleted").trigger()}delete n._deletePending;if(e){e.call(n,r)}})},_cleanItems:function(){if(!this.properties.items.length){return}var e=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/pubsub}items");jabberwerx.$.each(this.properties.items,function(){e.element("retract").attribute("id",this.id)});this._updateItems(jabberwerx.$(e.data))},_checkError:function(e){return jabberwerx.$(e).children("error").get(0)},_handleNotify:function(e){var t=e.data.getFromJID().getBareJID();if(this.jid&&!this.jid.equals(t)){return false}var r=this.delegate?this:this.getDelegatedFor(t);if(r!==this){return r._handleNotify(e)}var n=e.selected;var i;var a=false;var s=jabberwerx.$(e.data.getNode()).children("addresses[xmlns=http://jabber.org/protocol/address]");var t=s.find("address[type=replyto]").attr("jid");switch(n.nodeName){case"items":this._updateItems(jabberwerx.$(n),t);break;case"delete":a=true;case"purge":this._cleanItems();break}if(a&&!this._deletePending){this.event("pubsubNodeDeleted").trigger()}return true},_updateItems:function(e,t){var r=this;var n=[],i=[],a=[];jabberwerx.$.each(e.children(),function(){var e=jabberwerx.$(this).attr("id");var s="item:"+e;var o;if(this.nodeName=="retract"){o=r.properties.items[s];if(o){a.push(o);var l=jabberwerx.$.inArray(o,r.properties.items);delete r.properties.items[s];r.properties.items.splice(l,1)}}else if(this.nodeName=="item"){if(t&&!jabberwerx.$(this).attr("publisher")){jabberwerx.$(this).attr("publisher",t)}o=r.properties.items[s];if(o){o._update(this);i.push(o)}else{o=new jabberwerx.PubSubItem(this);r.properties.items.push(o);r.properties.items[s]=o;n.push(o)}}});var s=this.delegate?this.delegate.event("pubsubItemsChanged"):undefined;if(n.length){this.event("pubsubItemsChanged").trigger({operation:"added",items:n},s)}if(i.length){this.event("pubsubItemsChanged").trigger({operation:"updated",items:i},s)}if(a.length){this.event("pubsubItemsChanged").trigger({operation:"removed",items:a},s)}this.update()},autoRetrieve:false},"jabberwerx.PubSubNode");jabberwerx.PubSubNode.DelegatedNodeError=jabberwerx.util.Error.extend.call(jabberwerx.util.NotSupportedError,"this operation is not supported by delegated nodes")}if(jabberwerx){jabberwerx.PEPNode=jabberwerx.PubSubNode.extend({init:function(e,t,r){this._super(e,t,r)},destroy:function(){this.unsubscribe();this._super()},subscribe:function(e){if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}if(!this.delegate){var t=this.controller.client.controllers.capabilities;if(this.jid){t.addFeatureToJid(this.jid,this.node+"+notify")}else{t.addFeature(this.node+"+notify")}this.properties.subscription="implicit"}if(this.autoRetrieve){this.retrieve()}if(e){e.call(this)}},unsubscribe:function(e){if(e&&!jabberwerx.$.isFunction(e)){throw new TypeError("callback must be undefined or a function")}if(this.delegate){if(e){e.call(this)}return}var t=this.controller.client.controllers.capabilities;if(this.jid){t.removeFeatureFromJid(this.jid,this.node+"+notify")}else{t.removeFeature(this.node+"+notify")}delete this.properties.subscription},createNode:function(e){throw new jabberwerx.util.NotSupportedError},deleteNode:function(e){throw new jabberwerx.util.NotSupportedError}},"jabberwerx.PEPNode");jabberwerx.PEPNode.CURRENT_ITEM="current"}if(jabberwerx){jabberwerx.XDataForm=jabberwerx.JWModel.extend({init:function(e,t){
this._super();if(t){if(jabberwerx.isElement(t)){t=jabberwerx.$(t);this._type=t.attr("type");this._title=t.children("title").text();this._instructions=t.children("instructions").text();var r=this;var n=t.children("field");var i;jabberwerx.$.each(n,function(){i=new jabberwerx.XDataFormField(null,null,this);r.addField(i)});var a=t.find("reported:first  > field");var s;jabberwerx.$.each(a,function(){s=new jabberwerx.XDataFormField(null,null,this);r.reported.push(s)});var o=t.find("item");var l;jabberwerx.$.each(o,function(){l=new jabberwerx.XDataFormItem(this);jabberwerx.$.each(r.reported,function(){var e=l.getFieldByVar(this.getVar());if(e){e.setType(this.getType());e.setOptions(this.getOptions());e.setDesc(this.getDesc())}});r.items.push(l)})}else{throw new TypeError("payload needs to be an Element")}}else{if(e){if(typeof e=="string"){this._type=e}else{throw new TypeError("string form type is required")}}else{this._type="form"}}},destroy:function(){this._super()},getType:function(){return this._type},getTitle:function(){return this._title},setTitle:function(e){this._title=e},getInstructions:function(){return this._instructions},setInstructions:function(e){this._instructions=e},getDOM:function(){var e=new jabberwerx.NodeBuilder("{jabber:x:data}x");if(this._type){e.attribute("type",this._type)}if(this._title){e.element("title").text(this._title)}if(this._instructions){e.element("instructions").text(this._instructions)}var t=this;jabberwerx.$.each(t.fields,function(){this.getDOM(e)});if(t.reported.length){var r=e.element("reported");jabberwerx.$.each(t.reported,function(){this.getDOM(r)})}if(t.items.length){var n=e.element("items");jabberwerx.$.each(t.items,function(){this.getDOM(n)})}return e},addField:function(e){if(!e instanceof jabberwerx.XDataFormField){throw new TypeError("field must be type jabberwerx.XDataFormField")}var t=this._indexOf(this.fields,e.getVar());if(t!=-1){this.fields.splice(t,1)}this.fields.push(e)},getFieldByVar:function(e){if(!e){return null}var t=this._indexOf(this.fields,e);if(t!=-1){return this.fields[t]}return null},setFORM_TYPE:function(e){this.getFieldByVar("FORM_TYPE").setValues(e)},getFORM_TYPE:function(){return this.getFieldByVar("FORM_TYPE").getValues()[0]},submit:function(e){var t=new jabberwerx.XDataForm("submit");var r,n;var i;var a;if(e){var s=this;jabberwerx.$.each(e,function(r){if(typeof r=="string"){i=[].concat(e[r]);n=new jabberwerx.XDataFormField(r,i);a=s._indexOf(s.fields,n.getVar());if(a!=-1){n.setType(s.fields[a].getType());n.setRequired(s.fields[a].getRequired())}t.addField(n)}})}for(var o=0;o<this.fields.length;o++){a=this._indexOf(t.fields,this.fields[o].getVar());if(a==-1&&(this.fields[o].getValues().length||this.fields[o].getRequired())){if(this.fields[o].getType()=="fixed"||this.fields[o].getType()=="hidden")continue;n=new jabberwerx.XDataFormField(this.fields[o].getVar(),this.fields[o].getValues());n.setType(this.fields[o].getType());n.setRequired(this.fields[o].getRequired());t.addField(n)}}t.validate();return t},cancel:function(){var e=new jabberwerx.XDataForm("cancel");return e},_indexOf:function(e,t){if(!t){return-1}for(var r=0;r<e.length;r++){if(e[r].getVar()==t){return r}}return-1},validate:function(){for(var e=0;e<this.fields.length;e++){var t=this.fields[e];t.validate()}this._validateReported();for(var e=0;e<this.items.length;e++){this._validateItem(this.items[e])}},_validateReported:function(){for(var e=0;e<this.reported.length;e++){if(!this.reported[e].getVar()){throw new TypeError("reported should have var")}if(!this.reported[e].getType()){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("reported field should have type",{field:this.reported[e].getVar()})}if(!this.reported[e].getLabel()){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("reported field should have label",{field:this.reported[e].getVar()})}if(this.reported[e].getValues().length>0){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("reported field should not have values",{field:this.reported[e].getVar()})}this.reported[e].validate()}},_validateItem:function(e){var t;var r=e.fields;for(var n=0;n<this.reported.length;n++){t=false;for(var i=0;i<r.length||t;i++){if(r[i].getVar()==this.reported[n].getVar()){t=true;r[i].setType(this.reported[n].getType());r[i].validate()}}if(!t){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("reported field is not found in one of the items",{field:this.reported[n].getVar()})}}},getFieldValue:function(e){if(!e){return null}var t=this._indexOf(this.fields,e);if(t==-1){return null}if(this.fields[t].getValues().length>0){return this.fields[t].getValues()[0]}return null},setFieldValue:function(e,t){if(!e){return}var r=this._indexOf(this.fields,e);if(r==-1){return}this.fields[r].setValues(t)},_type:null,_title:null,_instructions:null,fields:[],reported:[],items:[]},"jabberwerx.XDataForm")}if(jabberwerx){jabberwerx.XDataFormField=jabberwerx.JWModel.extend({init:function(e,t,r){this._super();if(r){if(jabberwerx.isElement(r)){var n=this;r=jabberwerx.$(r);this._var=r.attr("var");this._type=r.attr("type");this._label=r.attr("label");this._values=[];var t=r.children("value");jabberwerx.$.each(t,function(){n._values.push(jabberwerx.$(this).text())});this._desc=r.children("desc").text();this._required=r.children("required")[0]?true:false;this._options=[];var i=r.children("option");jabberwerx.$.each(i,function(){n._options.push({label:jabberwerx.$(this).attr("label"),value:jabberwerx.$(this).children("value").text()})})}else{throw new TypeError("fieldNode must be an Element")}}else{if(!e&&!t){throw new TypeError("one of the constructor parameters for XDataFormField should be not null")}if(e){this._var=e}this.setValues(t)}},destroy:function(){this._super()},getVar:function(){return this._var},setVar:function(e){this._var=e},getType:function(){return this._type},setType:function(e){this._type=e},getLabel:function(){return this._label},setLabel:function(e){this._label=e},getValues:function(){var e=[].concat(this._values);return e},setValues:function(e){this._values=[];if(e){if(typeof e=="string"||typeof e=="boolean"){this._values.push(e)}else if(e instanceof Array){for(var t=0;t<e.length;t++){this._values.push(e[t])}}else{throw new TypeError("values must be string, number or array")}}},getDesc:function(){return this._desc},setDesc:function(e){this._desc=e},getOptions:function(){var e=[].concat(this._options);return e},setOptions:function(e){this._options=[];var t=this;jabberwerx.$.each(e,function(){if(this.label&&this.value){t._options.push({label:this.label,value:this.value})}})},getRequired:function(){return this._required},setRequired:function(e){this._required=e},getDOM:function(e){var t=e.element("field");if(this._var){t.attribute("var",this._var)}if(this._type){t.attribute("type",this._type)}if(this._label){t.attribute("label",this.label)}for(var r=0;r<this._values.length;r++){t.element("value").text(this._values[r])}if(this._required){t.element("required")}if(this._desc){t.element("desc").text(this._desc)}var n=this;jabberwerx.$.each(this._options,function(){t.element("option").attribute("label",this.label).text(this.value)})},equals:function(e){if(e===this){return true}if(!e){return false}if(this.getVar()!=e.getVar()){return false}if(this.getType()!=e.getType()){return false}if(this.getLabel()!=e.getLabel()){return false}if(this.getDesc()!=e.getDesc()){return false}var t=e.getValues();for(var r=0;r<this._values.length;r++){if(typeof this._values[r]=="function"){continue}if(this._values[r]!=t[r]){return false}}var n=e.getOptions();for(var r=0;r<this._options.length;r++){if(typeof this._options[r]=="function"){continue}if(this._options[r].label!=n[r].label||this._options[r].value!=n[r].value){return false}}return true},validate:function(){if(this._type){if(this._type!="boolean"&&this._type!="fixed"&&this._type!="hidden"&&this._type!="jid-multi"&&this._type!="jid-single"&&this._type!="list-multi"&&this._type!="list-single"&&this._type!="text-multi"&&this._type!="text-private"&&this._type!="text-single"){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("field type should comply with XEP-0004",{field:this._var})}}if(this._type!="list-multi"&&this._type!="text-multi"&&this._type!="jid-multi"){if(this._values.length>1){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("field is not allowed to have multiple values",{field:this._var})}}if(this._required&&this._values.length==0){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("field is required to have a value",{field:this._var})}if(this._type=="boolean"&&this._values.length>0){if(this._values[0]=="true"||this._values[0]==true){this._values[0]="1"}if(this._values[0]=="false"||this._values[0]==false){this._values[0]="0"}if(this._values[0]!="0"&&this._values[0]!="1"){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("field of type boolean contains invalid value",{field:this._var})}}if(this._type=="jid-multi"||this._type=="jid-single"){var e;for(var t=0;t<this._values.length;t++){try{e=jabberwerx.JID.asJID(this._values[t])}catch(r){throw new jabberwerx.XDataFormField.InvalidXDataFieldError("field of type jid contains invalid jid type",{field:this._var})}}if(this._type=="jid-multi"){jabberwerx.unique(this._values)}}},_type:null,_label:null,_var:null,_values:[],_desc:null,_required:false,_options:[]},"jabberwerx.XDataFormField");jabberwerx.XDataFormField.InvalidXDataFieldError=jabberwerx.util.Error.extend.call(TypeError)}if(jabberwerx){jabberwerx.XDataFormItem=jabberwerx.JWModel.extend({init:function(e){this._super();this._DOM=e;if(e){if(jabberwerx.isElement(e)){var t=this;var r=jabberwerx.$(e).children("field");var n;jabberwerx.$.each(r,function(){n=new jabberwerx.XDataFormField(null,null,this);t.fields.push(n)})}else{throw new TypeError("itemNode must be an Element")}}},destroy:function(){this._super()},getDOM:function(){return _DOM},equals:function(e){if(e===this){return true}if(!e){return false}if(e.fields.length!=this.fields.length){return false}for(var t=0;t<this.fields.length;t++){if(!this.fields[t].equals(e.fields[t])){return false}}return true},getFieldByVar:function(e){if(!e){return null}var t=this._indexOf(this.fields,e);if(t!=-1){return this.fields[t]}return null},getFieldValues:function(e){var t=this.getFieldByVar(e);if(t){return t.getValues()}return null},_indexOf:function(e,t){if(!t){return-1}for(var r=0;r<e.length;r++){if(e[r].getVar()==t){return r}}return-1},fields:[]},"jabberwerx.XDataFormItem")}if(jabberwerx){jabberwerx.MUCInvite=jabberwerx.JWModel.extend({init:function(e,t,r,n,i){if(!e||!t){throw new TypeError("stanza and room parameters must be present")}this.setStanza(e);this.setRoom(t);this.setInvitor(r);this.setReason(n);this.setPassword(i)},getStanza:function(){return this._stanza||null},getRoom:function(){return this._room||null},getInvitor:function(){return this._invitor||null},getReason:function(){return this._reason||null},getPassword:function(){return this._password||null},setStanza:function(e){if(e){if(e instanceof jabberwerx.Stanza){this._stanza=e}else{throw new TypeError("stanza must be type jabberwerx.Stanza")}}},setRoom:function(e){if(e){try{this._room=jabberwerx.JID.asJID(e)}catch(t){throw new TypeError("room must be type jabberwerx.JID or convertible to a jabberwerx.JID")}}},setInvitor:function(e){if(e){try{this._invitor=jabberwerx.JID.asJID(e)}catch(t){throw new TypeError("invitor must be type jabberwerx.JID or convertible to a jabberwerx.JID")}}},setReason:function(e){if(e){if(typeof e=="string"||e instanceof String){this._reason=e}else{throw new TypeError("reason must be a string")}}},setPassword:function(e){if(e){if(typeof e=="string"||e instanceof String){this._password=e}else{throw new TypeError("password must be a string")}}}},"jabberwerx.MUCInvite")}if(jabberwerx){jabberwerx.Controller=jabberwerx.JWModel.extend({init:function(e,t){this._super();if(!t||typeof t!="string"){throw new TypeError("name must be a non-empty string")}if(!(e instanceof jabberwerx.Client)){throw new TypeError("client must be a jabberwerx.Client")}this.client=e;this.name=t;var r=e.controllers[t];if(r){r.destroy()}e.controllers[t]=this},destroy:function(){if(this.client&&this.client.controllers&&this.client.controllers[this.name]){delete this.client.controllers[this.name];delete this.client}this._super()},updateEntity:function(e){if(!(e&&e instanceof jabberwerx.Entity&&e.controller===this)){throw new TypeError("invalid entity to update")}this.client.entitySet.event("entityUpdated").trigger(e);return e},removeEntity:function(e){if(!(e&&e instanceof jabberwerx.Entity&&e.controller===this)){throw new TypeError("invalid entity to delete")}e.destroy();return e},client:null,name:""},"jabberwerx.Controller")}(function(){if(jabberwerx){jabberwerx.RosterController=jabberwerx.Controller.extend({init:function(e){this._super(e,"roster");this.applyEvent("errorEncountered");this.applyEvent("subscriptionReceived");this.applyEvent("unsubscriptionReceived");var t=this;var r=["autoaccept","autoaccept_in_domain","autoremove"];var n=jabberwerx._config.subscriptions;jabberwerx.$.each(r,function(){var e=this;if(n!==undefined&&n[e]!==undefined){t[e]=n[e]}return true});e.event("clientStatusChanged").bind(this.invocation("_handleStatusChange"));e.event("iqReceived").bindWhen("[type='set'] query[xmlns='jabber:iq:roster']",this.invocation("_handleRosterUpdate"));e.event("presenceReceived").bindWhen("[type='subscribe'], [type='subscribed'], [type='unsubscribe'], [type='unsubscribed']",this.invocation("_handleSubscription"))},destroy:function(){var e=this.client;e.event("clientStatusChanged").unbind(this.invocation("_handleStatusChange"));e.event("iqReceived").unbind(this.invocation("_handleRosterUpdate"));e.event("presenceReceived").unbind(this.invocation("_handleSubscription"));this._super()},updateEntity:function(e){if(!(e&&e instanceof jabberwerx.RosterContact)){throw new TypeError("entity must be a contact")}var t=e.getDisplayName();if(t==e.jid.toString()){t=""}var r=e.getGroups();this.updateContact(e.jid,t,r)},removeEntity:function(e){if(!(e&&e instanceof jabberwerx.RosterContact)){throw new TypeError("entity must be a contact")}this.deleteContact(e.jid)},fetch:function(e){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(e!==undefined&&!jabberwerx.$.isFunction(e)){throw new TypeError("The callback param must be a function")}var t=this;this._removeContactsFromEntitySet();this.client.sendIq("get",null,"<query xmlns='jabber:iq:roster'/>",function(r){var n=t._checkError(r);var i=jabberwerx.$("item",r);t.client.entitySet.startBatch();jabberwerx.$(i).each(function(){var e=jabberwerx.$(this).attr("jid");var r=new jabberwerx.RosterContact(this,t);var n=t.client.entitySet.entity(e);if(n){r.apply(n,false);n.remove()}t.client.entitySet.register(r)});t.client.entitySet.endBatch();if(n){t.event("errorEncountered").trigger({operation:"fetch",error:n})}if(e){e.call(t,n)}})},addContact:function(e,t,r,n){this._updateContact(e,t,r,n,true)},updateContact:function(e,t,r,n){this._updateContact(e,t,r,n,false)},_updateContact:function(jid,nickname,groups,callback,addContact){if(callback!==undefined&&!jabberwerx.$.isFunction(callback)){throw new TypeError("The callback param must be a function")}if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}var that=this;jid=jabberwerx.JID.asJID(jid).getBareJID();var entity=this.client.entitySet.entity(jid);if(groups&&(typeof groups=="string"||groups instanceof String)){groups=[groups.toString()]}else if(!(groups instanceof Array)||!groups.length||groups.length==1&&groups[0]==""){groups=this.defaultGroup&&[this.defaultGroup.toString()]||[]}var builder=new jabberwerx.NodeBuilder("{jabber:iq:roster}query");with(builder.element("item")){attribute("jid",jid.toString());if(nickname){attribute("name",nickname)}for(var i=0;i<groups.length;i++){element("group").text(groups[i])}}if(callback){this.client.sendIq("set",null,builder.data,function(e){if(e){var t=that._checkError(e);callback.call(that,t)}})}else{this.client.sendIq("set",null,builder.data)}if(addContact||this.autoSubscription){this.subscribe(jid)}},subscribe:function(e){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}e=jabberwerx.JID.asJID(e).getBareJID();var t=this.client.entitySet.entity(e);if(t&&t instanceof jabberwerx.RosterContact){if(t.properties.subscription=="to"||t.properties.subscription=="both"){return}}this.client.sendStanza("presence","subscribe",e)},unsubscribe:function(e){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}e=jabberwerx.JID.asJID(e).getBareJID();var t=this.client.entitySet.entity(e);if(t&&t instanceof jabberwerx.RosterContact){if(t.properties.subscription=="both"){this.client.sendStanza("presence","unsubscribe",e)}else if(t.properties.subscription=="to"||t.properties.subscription=="none"){this.deleteContact(e)}}},deleteContact:function(e,t){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(t!==undefined&&!jabberwerx.$.isFunction(t)){throw new TypeError("The callback param must be a function")}var r=this;var e=new jabberwerx.JID.asJID(e).getBareJID();var n=new jabberwerx.NodeBuilder("{jabber:iq:roster}query");n=n.element("item");n=n.attribute("jid",e.toString());n=n.attribute("subscription","remove");this.client.sendIq("set",null,n.document.xml,function(e){var n=r._checkError(e);if(t){t.call(r,n)}})},acceptSubscription:function(e,t,r){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}e=jabberwerx.JID.asJID(e).getBareJID();this.client.sendStanza("presence","subscribed",e);this.updateContact(e,t,r)},denySubscription:function(e){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}e=jabberwerx.JID.asJID(e).getBareJID();this.client.sendStanza("presence","unsubscribed",e);if(this.autoSubscription){var t=this.client.entitySet.entity(e);if(t&&t instanceof jabberwerx.RosterContact){this.deleteContact(e)}}},_removeContactsFromEntitySet:function(){var e=this.client.entitySet.toArray();var t=this;jabberwerx.$.each(e,function(){var e=this;if(e instanceof jabberwerx.RosterContact){e.destroy()}})},_checkError:function(e){var t=undefined;var r=jabberwerx.$(e).children("error")[0];if(r&&r.nodeName=="error"){t=r}return t},_autoAccept:function(e){var t=e.getFromJID();var r=this.client.entitySet.entity(t);var n=this.autoaccept==jabberwerx.RosterController.AUTOACCEPT_ALWAYS;if(!n&&this.autoaccept_in_domain&&t.getDomain()==this.client.connectedUser.jid.getDomain()){n=true}if(!n&&this.autoaccept==jabberwerx.RosterController.AUTOACCEPT_IN_ROSTER&&r){var i=r.properties;n=i["subscription"]=="to"||i["subscription"]=="none"||i["ask"]=="subscribe"}if(n){if(r){var a=r.getDisplayName();if(a==r.jid.toString()){a=""}var s=r.getGroups();this.acceptSubscription(t,a,s)}else{this.acceptSubscription(t)}}return n},_autoRemove:function(e){var t=e.getFromJID();this.client.sendStanza("presence","unsubscribed",t);var r=this.client.entitySet.entity(t.getBareJID());var n=this.autoSubscription&&this.autoremove||r.properties.subscription=="from"||r.properties.subscription=="none";if(n){this.deleteContact(t)}return n},_handleSubscription:function(e){var t=e.data;switch(t.getType()){case"subscribe":var r=this._autoAccept(t);this.event("subscriptionReceived").trigger({stanza:t,handled:r});break;case"subscribed":this.client.sendStanza("presence","subscribe",t.getFrom());break;case"unsubscribe":var r=this._autoRemove(t);this.event("unsubscriptionReceived").trigger({stanza:t,handled:r});break;case"unsubscribed":this.client.sendStanza("presence","unsubscribe",t.getFrom());break}return true},_handleRosterUpdate:function(e){var t=jabberwerx.$(e.selected);var r=t.children("item");var n=r.attr("jid");var i=r.attr("subscription");var a=this.client.entitySet.entity(n);if(i!="remove"){r=r.get()[0];if(a&&a instanceof jabberwerx.RosterContact){a.setItemNode(r)}else{var s=new jabberwerx.RosterContact(r,this);if(a){s.apply(a,false);a.remove()}this.client.entitySet.register(s)}}else if(a&&a instanceof jabberwerx.RosterContact){delete a.properties.subscription;delete a.properties.ask;a.destroy()}return true},_handleStatusChange:function(e){switch(e.data.next){case jabberwerx.Client.status_connected:this.fetch();break;case jabberwerx.Client.status_disconnected:this._removeContactsFromEntitySet();break}},autoSubscription:true,autoaccept:"in-roster",autoaccept_in_domain:true,autoremove:true,defaultGroup:""},"jabberwerx.RosterController");jabberwerx.RosterController.AUTOACCEPT_NEVER="never";jabberwerx.RosterController.AUTOACCEPT_IN_ROSTER="in-roster";jabberwerx.RosterController.AUTOACCEPT_ALWAYS="always"}})();(function(){if(jabberwerx){jabberwerx.CapabilitiesController=jabberwerx.Controller.extend({init:function(e){this._super(e,"capabilities");this.client.event("beforePresenceSent").bind(this.invocation("_beforePresenceHandler"));this.client.event("presenceSent").bind(this.invocation("_resendCaps"));this.client.event("iqReceived").bindWhen("*[type='get'] query[xmlns='http://jabber.org/protocol/disco#info']",this.invocation("_discoInfoHandler"));jabberwerx.globalEvents.bind("resourcePresenceChanged",this.invocation("_handleResourcePresenceUpdate"));this.addFeature("http://jabber.org/protocol/caps");this.addFeature("http://jabber.org/protocol/disco#info")},destroy:function(){this.client.event("beforePresenceSent").unbind(this.invocation("_beforePresenceHandler"));this.client.event("presenceSent").unbind(this.invocation("_resendCaps"));this.client.event("iqReceived").unbind(this.invocation("_discoInfoHandler"));jabberwerx.globalEvents.unbind("resourcePresenceChanged",this.invocation("_handleResourcePresenceUpdate"));this._super()},_updatePresence:function(e){if(this.client.isConnected()){var t=this.client.getCurrentPresence().clone();jabberwerx.$(t.getNode()).find("c[xmlns=http://jabber.org/protocol/caps]").remove();if(e){t.setTo(e)}this.client.sendStanza(t)}},addFeature:function(e){var t=false;if(typeof e=="string"){if(!this.containsFeature(e)){this._featureSet.push(e);this._featureSet.sort();t=true}}if(t){this._updatePresence()}return t},removeFeature:function(e){var t=false;if(typeof e=="string"||e instanceof String){var r=jabberwerx.$.inArray(e,this._featureSet);if(r>=0){this._featureSet.splice(r,1);t=true}}if(t){this._updatePresence()}return t},addFeatureToJid:function(e,t){if(!(e&&e instanceof jabberwerx.JID)){throw new TypeError("jid must be a jabberwerx.JID")}if(!(t&&typeof t=="string")){throw new TypeError("feature must be non empty string")}var r=jabberwerx.JID.asJID(e).getBareJID();if(!this._featureSetPerJid[r]){this._featureSetPerJid[r]=new jabberwerx.CapabilitiesController.JidFeatureSet(this)}var n=this._featureSetPerJid[r].addFeature(t);if(n){this._updatePresence(e)}return n},containsFeatureForJid:function(e,t){if(!(e&&e instanceof jabberwerx.JID)){throw new TypeError("jid must be a jabberwerx.JID")}if(!(t&&typeof t=="string")){throw new TypeError("feature must be non empty string")}var r=jabberwerx.JID.asJID(e).getBareJID();if(this._featureSetPerJid[r]){return this._featureSetPerJid[r].containsFeature(t)}else{return false}},removeFeatureFromJid:function(e,t){var r=false;if(!(e&&e instanceof jabberwerx.JID)){throw new TypeError("jid must be a jabberwerx.JID")}if(!(t&&typeof t=="string")){throw new TypeError("feature must be non empty string")}var n=jabberwerx.JID.asJID(e).getBareJID();if(this._featureSetPerJid[n]){r=this._featureSetPerJid[n].removeFeature(t);if(this._featureSetPerJid[n].extraFeatures.length==0){delete this._featureSetPerJid[n]}}if(r){this._updatePresence(e)}return r},_resendCaps:function(e){var t=e.data;if(!(t.getTo()||t.getType()||t.getShow()=="unavailable")){for(var r in this._featureSetPerJid){var n=t.clone();jabberwerx.$(n.getNode()).find("c[xmlns=http://jabber.org/protocol/caps]").remove();n.setTo(r);this.client.sendStanza(n)}}},attachCapabilitiesToPresence:function(e){if(!(e&&e instanceof jabberwerx.Presence)){throw new TypeError("presence must be a jabberwerx.Presence")}var t=jabberwerx.$(e.getNode()).find("c[xmlns=http://jabber.org/protocol/caps]").map(function(){return new jabberwerx.NodeBuilder(this)})[0];var r=jabberwerx.$(e.getNode()).find("c[ver]").map(function(){return new jabberwerx.NodeBuilder(this)})[0];if(!r){var n=null;if(!t){t=new jabberwerx.NodeBuilder(e.getNode()).element("{http://jabber.org/protocol/caps}c")}if(e.getTo()){var i=new jabberwerx.JID(e.getTo());n=this.getVerificationStringForJid(i)}if(!n){n=this.generateVerificationString()}t.attribute("hash","sha-1");t.attribute("node",this.node);t.attribute("ver",n)}},getVerificationStringForJid:function(e){var t=null;if(!(e&&e instanceof jabberwerx.JID)){throw new TypeError("jid must be a jabberwerx.JID")}var r=jabberwerx.JID.asJID(e).getBareJID();if(this._featureSetPerJid[r]){t=this._featureSetPerJid[r].ver}return t},getVerificationString:function(e){var t=null;if(e==this.node+"#"+this.generateVerificationString()){t=this.generateVerificationString()}else{for(var r in this._featureSetPerJid){if(e==this.node+"#"+this._featureSetPerJid[r].ver){t=this._featureSetPerJid[r].ver;break}}}return t},getFeaturesForVerificationString:function(e){var t=[];if(!(e&&typeof e=="string")){throw new TypeError("version must be non empty string")}if(e==this.generateVerificationString()){t=this.getFeatureSet()}else{for(var r in this._featureSetPerJid){if(e==this._featureSetPerJid[r].ver){t=jabberwerx.unique(this.getFeatureSet().concat(this._featureSetPerJid[r].extraFeatures));t.sort()}}}return t},getFeatureSet:function(){return this._featureSet},containsFeature:function(e){var t=false;for(var r=0;r<this._featureSet.length;r++){if(this._featureSet[r]==e){t=true;break}}return t},generateVerificationString:function(e){var t=e?jabberwerx.unique(this._featureSet.concat(e)):this._featureSet;return jabberwerx.CapabilitiesController._generateVerificationString([this._getIdentity()],t,[])},_getIdentity:function(){return(this.identity.category?this.identity.category:"")+"/"+(this.identity.type?this.identity.type:"")+"//"+(this.identity.name?this.identity.name:"")},_beforePresenceHandler:function(e){var t=e.data;if(!(t.getType()||t.getShow()=="unavailable")){this.attachCapabilitiesToPresence(t)}return false},_discoInfoHandler:function(e){jabberwerx.util.debug.log("received disco#info request...");var t=e.data;var r=this._createDiscoInfoResponse(t);this.client.sendStanza(r);return true},_createDiscoInfoResponse:function(e){var t=null;var r=jabberwerx.$(e.getQuery()).attr("node");var n=null;if(r){n=this.getVerificationString(r)}if(!r||n){var i=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/disco#info}query");if(n){i.attribute("node",this.node+"#"+n)}var a={category:this.identity.category,type:this.identity.type};if(this.identity.name){a.name=this.identity.name}i.element("identity",a);var s=null;if(!r){s=this._featureSet}else{s=this.getFeaturesForVerificationString(n)}jabberwerx.$.each(s,function(){i.element("feature",{"var":this});return true});t=e.reply(i.data)}else{t=e.errorReply(jabberwerx.Stanza.ERR_ITEM_NOT_FOUND)}return t},_findCapsInfo:function(e){var t=[];for(var r in this._capsCache){var n=this._capsCache[r];if(n.getReferences(e).length>0){t.push(n)}}return t},_firstCapsInfo:function(e){var t=this._findCapsInfo(e);if(t.length>0){return t[0]}return null},isSupportedFeature:function(e,t){if(!jabberwerx.util.isString(t)){throw new TypeError("Feature must be a non empty string")}e=jabberwerx.JID.asJID(e);var r=_findCapsInfo(e);for(var n in r){if(jabberwerx.$.inArray(t,n.features)!=-1){return true}}return false},getSupportedResources:function(e,t){if(!jabberwerx.util.isString(t)||t==""){throw new TypeError("Feature must be a non empty string")}e=jabberwerx.JID.asJID(e).getBareJID();var r=this._findCapsInfo(e);var n={};for(var i=0;i<r.length;++i){var a=r[i];if(jabberwerx.$.inArray(t,a.features)!=-1){var s=a.getReferences(e);for(var o=0;o<s.length;++o){n[s[o].toString()]=s[o]}}}var l=[];jabberwerx.$.each(n,function(e,t){l.push(n[e])});return l},getFeatures:function(e){e=jabberwerx.JID.asJID(e);var t=[];var r=this._findCapsInfo(e);for(var n=0;n<r.length;++n){t=t.concat(r[n].features)}return jabberwerx.unique(t)},getIdentities:function(e){e=jabberwerx.JID.asJID(e);var t=[];var r=this._findCapsInfo(e);for(var n=0;n<r.length;++n){t=t.concat(r[n].identities)}return jabberwerx.$.map(jabberwerx.unique(t),function(e,t){var r=e.split("/");return{category:r[0],type:r[1],xmlLang:r[2],name:r[3]}})},_newCapsInfo:function(e,t,r){var n=new jabberwerx.CapabilitiesController.CapsInfo(this,r,t);n.addReference(e);this._capsCache[t]=n;this.client.controllers.disco.fetchInfo(e,n.id,function(e,t,r,i){if(i){n.validate()}else{n._populate(e,t,r)}n._capsController._updateRefs(n.ver)})},_updateRefs:function(e){var t=[];var r=this._capsCache[e];for(var n=0;n<r.items.length;++n){var i=jabberwerx.JID.asJID(r.items[n]).getBareJIDString();if(jabberwerx.$.inArray(i,t)==-1){t.push(i)}}for(var n=0;n<t.length;++n){var a=this.client.entitySet.entity(t[n]);if(a){this.client.entitySet.event("entityUpdated").trigger(a)}}},_clearRefs:function(){for(var e in this._capsCache){this._capsCache[e].clearReferences()}},_removeInvalid:function(){for(var e in this._capsCache){var t=this._capsCache[e];if(t.status!="valid"){delete this._capsCache[e]}}},_handleResourcePresenceUpdate:function(e){if(!this._handle115Receiving){return false}if(!this.client.connectedUser){return false}var t=jabberwerx.JID.asJID(this.client.connectedUser.jid+"/"+this.client.resourceName);var r=e.data.presence;var n=r?jabberwerx.$(r.getNode()).find("c[xmlns=http://jabber.org/protocol/caps]"):null;if(!n||n.length==0){return false}var i=e.data.fullJid;var a=n.attr("ver");var s=n.attr("node");if(i.equals(t)&&!this._capsCache[a]){var o=new jabberwerx.CapabilitiesController.CapsInfo(this,s,a);o._populate(this._getIdentity(),this._featureSet,[]);o.addReference(t);this._capsCache[a]=o;return false}var l=this.client.entitySet.entity(i.getBareJID());if(!l){return false}var u=this._firstCapsInfo(i);if(r&&r.getType()!="unavailable"){o=this._capsCache[a];if(u&&u===o){return false}else if(u){u.removeReference(i)}if(o){o.addReference(i)}else{this._newCapsInfo(i,a,s);return false}}else if(u){u.removeReference(i)}this.client.entitySet.event("entityUpdated").trigger(l);return false},identity:{category:"client",name:"Cisco AJAX XMPP Library",type:"pc",toString:function(){return(this.category?this.category:"")+"/"+(this.type?this.type:"")+"//"+(this.name?this.name:"")}},node:"http://jabber.cisco.com/caxl",_featureSet:["http://jabber.org/protocol/disco#info"],_featureSetPerJid:{},_capsCache:{},_handle115Receiving:true,_updateCaps:false},"jabberwerx.CapabilitiesController");jabberwerx.CapabilitiesController.JidFeatureSet=jabberwerx.JWModel.extend({init:function(e){this._super();this._capsController=e},_capsController:{},extraFeatures:[],ver:null,addFeature:function(e){var t=false;if(!(e&&typeof e=="string")){throw new TypeError("feature must be non empty string")}if(!this.containsFeature(e)){this.extraFeatures.push(e);this.extraFeatures.sort();this.ver=this._capsController.generateVerificationString(this.extraFeatures);t=true}return t},containsFeature:function(e){var t=false;if(!(e&&typeof e=="string")){throw new TypeError("feature must be non empty string")}var r=jabberwerx.$.inArray(e,this.extraFeatures);if(r>=0){t=true}return t},removeFeature:function(e){var t=false;if(!(e&&typeof e=="string")){throw new TypeError("feature must be non empty string")}var r=jabberwerx.$.inArray(e,this.extraFeatures);if(r>=0){this.extraFeatures.splice(r,1);this.ver=this._capsController.generateVerificationString(this.extraFeatures);t=true}return t}},"jabberwerx.CapabilitiesController.JidFeatureSet")}jabberwerx.CapabilitiesController.CapsInfo=jabberwerx.JWModel.extend({init:function(e,t,r){this._super();if(!e||!(e instanceof jabberwerx.CapabilitiesController)){throw new TypeError("CapsInfo must be created with a valid CapabilitiesController")}this._capsController=e;
this._node=t;this.ver=r?r:"";this._lockedVer=this.ver!="";this.id=this._node+"#"+this.ver},validate:function(){this.status="invalid";this.id=this._node+"#"+this.ver;var e=[].concat(this.identities);if(jabberwerx.unique(e).length!=this.identities.length){jabberwerx.util.debug.log("Duplicate identifier found validating caps for "+this.id);return false}var t=[].concat(this.features);if(jabberwerx.unique(t).length!=this.features.length){jabberwerx.util.debug.log("Duplicate feature found validating caps for "+this.id);return false}for(var r=0;r<this._rawforms.length;++r){var n=this._rawforms[r].getFieldByVar("FORM_TYPE");var i=this._rawforms[r].getFORM_TYPE();ftvals=n.getValues();for(var a=0;a<ftvals.length;++a){if(ftvals[a]!=i){return false}}if(this.forms[i]!=null){return false}this.forms[i]=this._rawforms[r]}var s=this._generateVerString();if(!this._lockedVer){this.ver=s}if(s==this.ver){this.status="valid";this.id=this.ver}return this.status=="valid"},_generateVerString:function(){var e=[];for(var t in this.forms){e.push(this.forms[t])}return jabberwerx.CapabilitiesController._generateVerificationString(this.identities,this.features,e)},_populate:function(e,t,r){this.identities=[];this.features=[];this.forms={};this._rawforms=[];this.status="invalid";this.id=this._node+"#"+this.ver;if(e){this.identities=this.identities.concat(e)}if(t){this.features=this.features.concat(t)}if(r){for(var n=0;n<r.length;++n){var i=r[n].getFieldByVar("FORM_TYPE");if(i&&i.getType()=="hidden"){this._rawforms.push(r[n])}}}this.identities.sort();this.features.sort();return this.validate()},addReference:function(e){if(this.indexOfReference(e,true)==-1){this.items.push(e.toString())}},removeReference:function(e){var t=this.indexOfReference(e,true);if(t!=-1){this.items.splice(t,1)}},hasReference:function(e){return this.indexOfReference(e)!=-1},indexOfReference:function(e,t){var r=jabberwerx.JID.asJID(e);t=t||r.getResource()!="";if(!t){r=r.getBareJID()}for(var n=0;n<this.items.length;++n){var i=jabberwerx.JID.asJID(this.items[n]);if(t&&r.equals(i)||!t&&r.equals(i.getBareJID())){return n}}return-1},getReferences:function(e){var t=[];var r=jabberwerx.JID.asJID(e);var n=r.getResource()!="";for(var i=0;i<this.items.length;++i){var a=jabberwerx.JID.asJID(this.items[i]);if(n&&a.equals(r)){return[a]}if(!n&&a.getBareJID().equals(r)){t.push(a)}}return t},_clearReferences:function(){this.items=[]},_capsController:{},_node:"",_rawforms:[],ver:"",status:"invalid",identities:[],features:[],forms:{},items:[]},"jabberwerx.CapabilitiesController.CapsInfo");jabberwerx.CapabilitiesController._generateVerificationString=function(e,t,r,n){var i=function(e){var t=e.getFORM_TYPE()+"<";var r=jabberwerx.$.map(e.fields,function(e){var t=e.getVar();if(t=="FORM_TYPE"){return null}fa=[].concat(e.getValues());fa.sort();return t+"<"+fa.join("<")});r.sort();t+=r.join("<")+"<";return t};var a="";if(e&&e.length>0){e.sort();a+=e.join("<")+"<"}if(t&&t.length>0){t.sort();a+=t.join("<")+"<"}if(r&&r.length){var s=[];for(var o=0;o<r.length;++o){s.push(i(r[o]))}s.sort();a+=s.join("")}if(!n){return jabberwerx.util.crypto.b64_sha1(jabberwerx.util.crypto.utf8Encode(a))}return a}})();(function(){if(jabberwerx){jabberwerx.ChatController=jabberwerx.Controller.extend({init:function(e){this._super(e,"chat");var t=e.controllers.capabilities||new jabberwerx.CapabilitiesController(e);t.addFeature("http://jabber.org/protocol/chatstates");t.addFeature("http://jabber.org/protocol/xhtml-im");this.applyEvent("chatSessionOpened");this.applyEvent("chatSessionClosed");this.client.event("afterMessageReceived").bindWhen('message[type!="groupchat"]'+'[type!="error"] body',this.invocation("_messageHandler"))},openSession:function(e,t){var r=null;if(!(e instanceof jabberwerx.JID)){e=new jabberwerx.JID(e)}if(this._getChatSessionIndex(e)<0){r=new jabberwerx.ChatSession(this.client,e,t);this._chatSessions.push(r);this.event("chatSessionOpened").trigger({chatSession:r,userCreated:true})}return r},closeSession:function(e){var t=this._getChatSessionIndex(e);if(t>=0){var r=this._chatSessions[t];this._chatSessions.splice(t,1);this.event("chatSessionClosed").trigger(r);r.destroy();delete r;return true}return false},getSession:function(e){var t=this._getChatSessionIndex(e);return t>=0?this._chatSessions[t]:null},_messageHandler:function(e){var t=e.data;var r=t.getFromJID();if(this._getChatSessionIndex(r)<0){var n=new jabberwerx.ChatSession(this.client,r,t.getThread());this._chatSessions.push(n);this.event("chatSessionOpened").trigger({chatSession:n,userCreated:false});n._chatReceivedHandler(e);return true}return false},_getChatSessionIndex:function(e){var t=-1;var r;if(e instanceof jabberwerx.ChatSession){r=e.jid}else if(e instanceof jabberwerx.JID){r=e}else{try{r=new jabberwerx.JID(e)}catch(n){return t}}if(!r){return t}var i=this.isPrivateMessage(r);var a=i?r.toString():r.getBareJIDString();for(var s=0;s<this._chatSessions.length;s++){var o=i?this._chatSessions[s].jid.toString():this._chatSessions[s].jid.getBareJIDString();if(o==a){t=s;break}}return t},isPrivateMessage:function(e){if(!(e instanceof jabberwerx.JID)){throw new TypeError("jid must be of type jabberwerx.JID")}var t=e.getBareJID();var r=this.client.entitySet.entity(t);return r&&r instanceof jabberwerx.MUCRoom},sendChatStates:true,_chatSessions:[]},"jabberwerx.ChatController")}})();if(jabberwerx){jabberwerx.MUCController=jabberwerx.Controller.extend({init:function(e){this._super(e,"muc");var t=e.controllers.capabilities||jabberwerx.CapabilitiesController(e);t.addFeature("http://jabber.org/protocol/muc");t.addFeature("http://jabber.org/protocol/muc#user");t.addFeature("jabber:x:conference");t.addFeature("http://jabber.org/protocol/xhtml-im");this.applyEvent("mucInviteReceived");this.client.event("clientStatusChanged").bind(this.invocation("_handleStatusChange"));this.client.event("messageReceived").bindWhen("message:not([type]) x[xmlns='jabber:x:conference']",this.invocation("_handleDirectInvite"));this.client.event("messageReceived").bindWhen("message:not([type]) x[xmlns='http://jabber.org/protocol/muc#user']>invite",this.invocation("_handleMediatedInvite"))},destroy:function(){this._removeRoomsFromEntitySet();this._super()},updateEntity:function(e){if(!(e&&e instanceof jabberwerx.MUCRoom)){throw new TypeError("entity must be a MUCRoom")}this.client.entitySet.event("entityUpdated").trigger(e)},removeEntity:function(e){if(!(e&&e instanceof jabberwerx.MUCRoom)){throw new TypeError("entity must be a MUCRoom")}if(e.isActive()&&this.client.isConnected()){e.event("roomExited").bind(function(t){e.event("roomExited").unbind(arguments.callee);e.destroy()});e.exit()}else{e.destroy()}},room:function(e){e=jabberwerx.JID.asJID(e).getBareJID();var t=this.client.entitySet.entity(e);if(!(t&&t instanceof jabberwerx.MUCRoom)){var r=t;t=new jabberwerx.MUCRoom(e,this);if(r){t.apply(r);r.remove()}this.client.entitySet.register(t)}return t},_removeRoomsFromEntitySet:function(){this.client.entitySet.each(function(e){if(e instanceof jabberwerx.MUCRoom){e.remove()}})},_handleStatusChange:function(e){switch(e.data.next){case jabberwerx.Client.status_disconnected:this._removeRoomsFromEntitySet();break}},_handleDirectInvite:function(e){var t=e.data;if(jabberwerx.$("message:not([type]) x[xmlns='http://jabber.org/protocol/muc#user']>invite",t.getDoc()).length==0){var r=t.getFromJID();var n=jabberwerx.$(e.selected);var i=n.attr("jid");var a=n.attr("reason");this._handleInvite(t,i,r,a);return true}return false},_handleMediatedInvite:function(e){var t=e.data;var r=e.selected;var n=jabberwerx.$(r).attr("from");var i=t.getFromJID();var a=jabberwerx.$("reason",r).text()||null;var s=jabberwerx.$("password",e.data.getDoc()).text()||null;this._handleInvite(t,i,n,a,s);return true},_handleInvite:function(e,t,r,n,i){var a=new jabberwerx.MUCInvite(e,t,r,n,i);var s=this.client.entitySet.entity(a.getRoom());if(!(s&&s instanceof jabberwerx.MUCRoom&&s.isActive())){this.event("mucInviteReceived").trigger(a)}},_sendSearchIq:function(e,t,r){var n="{jabber:iq:search}query";var i=new jabberwerx.NodeBuilder(n);var a="get";if(r){if(this.escapeSearch){try{var s=jabberwerx.$.trim(r.getFieldValue("room-name"));r.setFieldValue("room-name",jabberwerx.JID.escapeNode(s))}catch(o){t(null,o);return}}i.node(r.getDOM().data);a="set"}this.client.sendIQ(a,e,i.data,function(e){if(!e){t(null,jabberwerx.Stanza.ERR_REMOTE_SERVER_TIMEOUT);return}var r=new jabberwerx.IQ(e);if(r.isError()){t(null,r.getErrorInfo())}else{var n=jabberwerx.$("x",r.getNode()).get(0);if(!n){t(null,jabberwerx.Stanza.ERR_SERVICE_UNAVAILABLE)}else{t(new jabberwerx.XDataForm(null,n))}}})},startSearch:function(e,t){e=jabberwerx.JID.asJID(e).getDomain();if(!jabberwerx.$.isFunction(t)){throw new TypeError("The variable 'callback' must be a function.")}this._sendSearchIq(e,t)},submitSearch:function(e,t,r){e=jabberwerx.JID.asJID(e).getDomain();if(!jabberwerx.$.isFunction(r)){throw new TypeError("The variable 'callback' must be a function.")}if(!(t&&t instanceof jabberwerx.XDataForm)){throw new TypeError("form must be an XDataForm")}this._sendSearchIq(e,r,t)},escapeSearch:true},"jabberwerx.MUCController")}if(jabberwerx){jabberwerx.PrivacyListController=jabberwerx.Controller.extend({init:function(e){this._super(e,"privacyList");this.applyEvent("errorEncountered");this.applyEvent("privacyListApplied");this.applyEvent("privacyListUpdated");this.applyEvent("privacyListRemoved");this.client.event("afterIqReceived").bindWhen("[type=set] query[xmlns=jabber:iq:privacy] list",this.invocation("_handlePrivacyListUpdate"))},destroy:function(){this.client.event("afterIqReceived").unbind(this.invocation("_handlePrivacyListUpdate"));this._super()},fetch:function(e,t){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(t!==undefined&&!jabberwerx.$.isFunction(t)){throw new TypeError("The callback param must be a function")}if(!e||typeof e!="string"){throw new TypeError("Privacy list name should be non empty string.")}this._doFetch(e,true,t)},_doFetch:function(e,t,r){var n=this;var i=false;var a=false;this.client.sendIq("get",null,"<query xmlns='jabber:iq:privacy'><list name='"+e+"'/></query>",function(e){var s=n._checkError(e);var o=jabberwerx.$(e).find("list").get(0);var l=o.getAttribute("name");var u=n._privacyLists[l];if(s){var c=jabberwerx.$(s).find("item-not-found").get(0);if(c){if(!t){if(n._privacyLists[l]){n.event("privacyListRemoved").trigger(n._privacyLists[l]);n._privacyLists[l].destroy();a=true}}else{s=null}}else{i=true}}if(i){n.event("errorEncountered").trigger({operation:"fetch",error:s,target:n._privacyLists[l]})}else{if(!a){if(n._privacyLists[l]){n._privacyLists[l]._update(o)}else{u=n._privacyLists[l]=new jabberwerx.PrivacyList(o,n)}n.event("privacyListUpdated").trigger(n._privacyLists[l])}}if(r){r.call(n,u,s)}})},_remove:function(e){if(this._privacyLists[e]){delete this._privacyLists[e]}},_checkError:function(e){return jabberwerx.$(e).children("error")[0]},apply:function(e,t){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(t!==undefined&&!jabberwerx.$.isFunction(t)){throw new TypeError("The callback param must be a function")}var r;if(e){if(typeof e=="string"){r=e}else if(e instanceof jabberwerx.PrivacyList){r=e.getName()}else{throw new TypeError("Privacy list name should be string or PrivacyList or empty.")}}var n=new jabberwerx.NodeBuilder("{jabber:iq:privacy}query").attribute("type","set");var i=n.element("active");if(e){i.attribute("name",r)}var a=this;this.client.sendIq("set",null,n.data,function(e){var n=a._checkError(e);if(n){a.event("errorEncountered").trigger({operation:"apply",error:n})}else{a.event("privacyListApplied").trigger({list:r})}if(t){t.call(a,n)}})},_handlePrivacyListUpdate:function(e){var t=jabberwerx.$(e.selected).attr("name");var r=new jabberwerx.IQ;r.setTo(e.data.getFrom());r.setFrom();r.setType("result");r.setID(e.data.getID());this.client.sendStanza(r);this._doFetch(t);return true},_privacyLists:{}},"jabberwerx.PrivacyListController")}if(jabberwerx){jabberwerx.PrivateStorageController=jabberwerx.Controller.extend({init:function(e){this._super(e,"privateStorage")},destroy:function(){this._super()},fetch:function(e,t){if(!this.client.isConnected()){throw new jabberwerx.Client.NotConnectedError}if(!jabberwerx.$.isFunction(t)){throw new TypeError("The callback param must be a function")}if(!e){throw new TypeError("Private storage element name should not be empty.")}var r=new jabberwerx.NodeBuilder("{jabber:iq:private}query");var n=r.element(e);var i=this;this.client.sendIq("get",null,r.data,function(e){var r=i._checkError(e);var a=jabberwerx.$(e).find(n.data.tagName+"[xmlns="+n.data.getAttribute("xmlns")+"]").get(0);if(t){t.call(i,a,r)}})},update:function(e){if(!jabberwerx.isElement(e)){throw new TypeError("Private storage should be an element.")}var t=new jabberwerx.NodeBuilder("{jabber:iq:private}query").node(e).parent;this.client.sendIq("set",null,t.data)},remove:function(e){if(!e){throw new TypeError("Private storage element name should not be empty.")}var t=new jabberwerx.NodeBuilder("{jabber:iq:private}query").element(e).parent;this.client.sendIq("set",null,t.data)},_checkError:function(e){return jabberwerx.$(e).children("error")[0]}},"jabberwerx.PrivateStorageController")}if(jabberwerx){jabberwerx.DiscoController=jabberwerx.Controller.extend({init:function(e){this._super(e,"disco");this.applyEvent("discoInitialized");this.client.event("clientStatusChanged").bind(this.invocation("_handleStatusChange"))},destroy:function(){this.client.event("clientStatusChanged").unbind(this.invocation("_handleStatusChange"));this._super()},_handleStatusChange:function(e){switch(e.data.next){case jabberwerx.Client.status_connected:this._walkDisco();break;case jabberwerx.Client.status_disconnected:this._cleanUp();this._initialized=false;break}},_walkDisco:function(){var e=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/disco#info}query");this.client.sendIq("get",this.client.connectedServer.jid,e.data,this.invocation("_handleDiscoInfo"));var t=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/disco#items}query");this.client.sendIq("get",this.client.connectedServer.jid,t.data,this.invocation("_handleDiscoItems"))},_handleDiscoInfo:function(e){var t=e.getAttribute("from");var r=this.client.entitySet.entity(t);if(!r){r=new jabberwerx.Server(t,this);this.client.entitySet.register(r)}var n=jabberwerx.$(e).find("identity");r.identities=[];jabberwerx.$.each(n,function(){r.identities.push(this.getAttribute("category")+"/"+this.getAttribute("type"))});var i=jabberwerx.$(e).find("feature");r.features=[];jabberwerx.$.each(i,function(){r.features.push(this.getAttribute("var"))});if(r.controller===this&&n.get(0).getAttribute("name")){r.setDisplayName(n.get(0).getAttribute("name"))}else{r.update()}if(t!=this.client.connectedServer.jid){var a=-1;for(var s=0;s<this._pendingJids.length;s++){if(this._pendingJids[s]==t){a=s;break}}if(a>=0){this._pendingJids.splice(a,1)}if(this._pendingJids.length==0){this._initialized=true;this.event("discoInitialized").trigger()}}},_handleDiscoItems:function(e){var t=jabberwerx.$(e).find("item");if(t.length==0||jabberwerx.$(e).children("error")[0]){this._initialized=true;this.event("discoInitialized").trigger();return}var r=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/disco#info}query");var n=this;jabberwerx.$.each(t,function(){var e=n.client.entitySet.entity(this.getAttribute("jid"));if(!e){e=new jabberwerx.Server(this.getAttribute("jid"),n);n.client.entitySet.register(e)}n._pendingJids.push(this.getAttribute("jid"));n.client.sendIq("get",this.getAttribute("jid"),r.data,n.invocation("_handleDiscoInfo"))})},_cleanUp:function(){var e=this;this._pendingJids=[];this.client.entitySet.each(function(){if(this.controller===e){this.remove()}})},findByIdentity:function(e){if(!this._initialized){throw new TypeError("Disco controller has not been initialized.")}var t=[];this.client.entitySet.each(function(r){if(r.hasIdentity(e)){t.push(r)}});return t},fetchInfo:function(e,t,r){e=jabberwerx.JID.asJID(e);if(!jabberwerx.$.isFunction(r)){throw new TypeError("cb must be a function.")}var n=new jabberwerx.NodeBuilder(this._DISCO_INFO);if(t){if(typeof t=="string"){n.attribute("node",t)}else{throw new TypeError("If node is defined, it must be a string.")}}var a=this._fetchInfoMap[this._jwesAsKey(e,t)];if(!a){this._fetchInfoMap[this._jwesAsKey(e,t)]=[r]}else{a.push(r);return}var s=this;this.client.sendIq("get",e,n.data,function(r){var n=[];var a=[];var o=[];var l=null;if(r){var u=new jabberwerx.IQ(r);if(u.isError()){l=u.getErrorInfo()}else{var c=jabberwerx.$(u.getQuery()).contents();for(index=0;index<c.length;index++){var h=c[index];switch(h.nodeName){case"identity":h=jabberwerx.$(h);var f=h.attr("category")+"/";f=f+(h.attr("type")?h.attr("type"):"")+"/";f=f+(h.attr("xml:lang")?h.attr("xml:lang"):"")+"/";f=f+(h.attr("name")?h.attr("name"):"");n.push(f);break;case"feature":a.push(jabberwerx.$(h).attr("var"));break;case"x":if(h.getAttribute("xmlns")=="jabber:x:data"){o.push(new jabberwerx.XDataForm(null,h))}break}}}}else{l=jabberwerx.Stanza.ERR_INTERNAL_SERVER_ERROR}var d=s._fetchInfoMap[s._jwesAsKey(e,t)];for(i=0;i<d.length;i++){d[i](n,a,o,l)}delete s._fetchInfoMap[s._jwesAsKey(e,t)]},this.timeout)},_jwesAsKey:function(e,t){return"["+(e||"")+"]:["+(t||"")+"]"},_fetchInfoMap:{},_DISCO_INFO:"{http://jabber.org/protocol/disco#info}query",timeout:30,findByFeature:function(e){if(!this._initialized){throw new TypeError("Disco controller has not been initialized.")}var t=[];this.client.entitySet.each(function(r){if(r.hasFeature(e)){t.push(r)}});return t},_initialized:false,_pendingJids:[]},"jabberwerx.DiscoController")}if(jabberwerx){jabberwerx.PubSubController=jabberwerx.Controller.extend({init:function(e,t){this._super(e,t||"pubsub");this._cleanupMode=jabberwerx.PubSubController.CLEANUP_ALL;this.client.event("clientStatusChanged").bind(this.invocation("_handleStatusChange"))},destroy:function(){this._removeNodesFromEntitySet(jabberwerx.PubSubController.CLEANUP_ALL);this.client.event("clientStatusChanged").unbind(this.invocation("_handleStatusChange"));this._super()},node:function(e,t){if(!(e&&typeof e=="string")){throw new TypeError("node must be a non-empty string")}t=this._prepareJid(t);var r=this._getNodeClass();var n=this.client.entitySet.entity(t,e);if(!(n&&n instanceof r)){var i=n;n=new r(t,e,this);if(i){n.apply(i);i.remove()}this.client.entitySet.register(n)}return n},_prepareJid:function(e){return jabberwerx.JID.asJID(e).getBareJID()},_getNodeClass:function(){return jabberwerx.PubSubNode},_removeNodesFromEntitySet:function(e){if(!e){e=this._cleanupMode}var t=this;var r;if(e==jabberwerx.PubSubController.CLEANUP_ALL){r=function(e){e.remove()}}else if(e==jabberwerx.PubSubController.CLEANUP_DELEGATES){r=function(e){if(e.delegate){e.remove()}else{e.properties.delegates={}}}}else{r=function(e){}}this.client.entitySet.each(function(e){if(e.controller===t){r(e)}})},_handleStatusChange:function(e){switch(e.data.next){case jabberwerx.Client.status_disconnected:this._removeNodesFromEntitySet();break}},_cleanupMode:null},"jabberwerx.PubSubController");jabberwerx.PubSubController.CLEANUP_ALL="all";jabberwerx.PubSubController.CLEANUP_DELEGATES="delegates"}if(jabberwerx){jabberwerx.PEPController=jabberwerx.PubSubController.extend({init:function(e){this._super(e,"pep");this._cleanupMode=jabberwerx.PubSubController.CLEANUP_DELEGATES},destroy:function(){this._super()},node:function(e,t){return this._super(e,t)},_prepareJid:function(e){return e?this._super(e):undefined},_getNodeClass:function(){return jabberwerx.PEPNode}},"jabberwerx.PEPController")}